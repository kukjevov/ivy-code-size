/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { forwardRef, Directive } from '@angular/core';
import { NgSelectComponent } from '../components/select/select.component';
import { valueChange, setValue, onFocus, setReadonly, getValue } from '../extensions';
/**
 * Provider for control value accessor
 * \@internal
 * @type {?}
 */
export var NG_SELECT_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return NgSelectControlValueAccessor; })),
    multi: true
};
/**
 * Control value accessor for NgSelectComponent
 * @template TValue
 */
var NgSelectControlValueAccessor = /** @class */ (function () {
    //######################### constructor #########################
    function NgSelectControlValueAccessor(_select) {
        this._select = _select;
        /**
         * Subscription that looks for changes of select
         */
        this._changeSubscription = null;
        /**
         * Subscription that looks for changes of select
         */
        this._focusSubscription = null;
    }
    //######################### public methods - implementation of ControlValueAccessor #########################
    /**
     * Sets value to select
     */
    //######################### public methods - implementation of ControlValueAccessor #########################
    /**
     * Sets value to select
     * @param {?} value
     * @return {?}
     */
    NgSelectControlValueAccessor.prototype.writeValue = 
    //######################### public methods - implementation of ControlValueAccessor #########################
    /**
     * Sets value to select
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        this._value = value;
        if (this._select.isInitialized) {
            this._select.execute(setValue(value));
            return;
        }
        if (this._initializedSubscription) {
            this._initializedSubscription.unsubscribe();
            this._initializedSubscription = null;
        }
        this._initializedSubscription = this._select.initialized.subscribe((/**
         * @param {?} initialized
         * @return {?}
         */
        function (initialized) {
            if (initialized) {
                _this._initializedSubscription.unsubscribe();
                _this._initializedSubscription = null;
                _this._select.execute(setValue(value));
            }
        }));
    };
    /**
     * Registers callback that is called when value of select changes
     */
    /**
     * Registers callback that is called when value of select changes
     * @param {?} fn
     * @return {?}
     */
    NgSelectControlValueAccessor.prototype.registerOnChange = /**
     * Registers callback that is called when value of select changes
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        var _this = this;
        this._changeInitializedSubscription = this._select.initialized.subscribe((/**
         * @param {?} initialized
         * @return {?}
         */
        function (initialized) {
            if (initialized) {
                if (_this._changeSubscription) {
                    _this._changeSubscription.unsubscribe();
                    _this._changeSubscription = null;
                }
                _this._changeSubscription = _this._select.executeAndReturn(valueChange(fn));
                /** @type {?} */
                var value = _this._select.executeAndReturn(getValue());
                if (_this._value != value) {
                    _this._value = value;
                    fn(value);
                }
            }
        }));
    };
    /**
     * Registers callback that is called when select is closed
     */
    /**
     * Registers callback that is called when select is closed
     * @param {?} fn
     * @return {?}
     */
    NgSelectControlValueAccessor.prototype.registerOnTouched = /**
     * Registers callback that is called when select is closed
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        var _this = this;
        this._touchInitializedSubscription = this._select.initialized.subscribe((/**
         * @param {?} initialized
         * @return {?}
         */
        function (initialized) {
            if (initialized) {
                if (_this._focusSubscription) {
                    _this._focusSubscription.unsubscribe();
                    _this._focusSubscription = null;
                }
                _this._focusSubscription = _this._select.executeAndReturn(onFocus(fn));
            }
        }));
    };
    /**
     * Sets NgSelect as disabled/readonly
     * @param isDisabled Indication whether is control disabled or not
     */
    /**
     * Sets NgSelect as disabled/readonly
     * @param {?} isDisabled Indication whether is control disabled or not
     * @return {?}
     */
    NgSelectControlValueAccessor.prototype.setDisabledState = /**
     * Sets NgSelect as disabled/readonly
     * @param {?} isDisabled Indication whether is control disabled or not
     * @return {?}
     */
    function (isDisabled) {
        var _this = this;
        if (this._select.isInitialized) {
            this._select.execute(setReadonly(isDisabled));
            return;
        }
        if (this._disabledInitializedSubscription) {
            this._disabledInitializedSubscription.unsubscribe();
            this._disabledInitializedSubscription = null;
        }
        this._disabledInitializedSubscription = this._select.initialized.subscribe((/**
         * @param {?} initialized
         * @return {?}
         */
        function (initialized) {
            if (initialized) {
                _this._disabledInitializedSubscription.unsubscribe();
                _this._disabledInitializedSubscription = null;
                _this._select.execute(setReadonly(isDisabled));
            }
        }));
    };
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     */
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    NgSelectControlValueAccessor.prototype.ngOnDestroy = 
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    function () {
        if (this._changeSubscription) {
            this._changeSubscription.unsubscribe();
            this._changeSubscription = null;
        }
        if (this._initializedSubscription) {
            this._initializedSubscription.unsubscribe();
            this._initializedSubscription = null;
        }
        if (this._changeInitializedSubscription) {
            this._changeInitializedSubscription.unsubscribe();
            this._changeInitializedSubscription = null;
        }
        if (this._touchInitializedSubscription) {
            this._touchInitializedSubscription.unsubscribe();
            this._touchInitializedSubscription = null;
        }
        if (this._focusSubscription) {
            this._focusSubscription.unsubscribe();
            this._focusSubscription = null;
        }
        if (this._disabledInitializedSubscription) {
            this._disabledInitializedSubscription.unsubscribe();
            this._disabledInitializedSubscription = null;
        }
    };
    NgSelectControlValueAccessor.decorators = [
        { type: Directive, args: [{
                    selector: 'ng-select[formControlName],ng-select[formControl],ng-select[ngModel]',
                    providers: [NG_SELECT_VALUE_ACCESSOR]
                },] }
    ];
    /** @nocollapse */
    NgSelectControlValueAccessor.ctorParameters = function () { return [
        { type: NgSelectComponent }
    ]; };
    return NgSelectControlValueAccessor;
}());
export { NgSelectControlValueAccessor };
if (false) {
    /**
     * Subscription for initialized status of NgSelect, used for writeValue
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._initializedSubscription;
    /**
     * Subscription for initialized status of NgSelect, used for registerOnChange
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._changeInitializedSubscription;
    /**
     * Subscription for initialized status of NgSelect, used for registerOnTouched
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._touchInitializedSubscription;
    /**
     * Subscription for initialized status of NgSelect, used for setDisabledState
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._disabledInitializedSubscription;
    /**
     * Subscription that looks for changes of select
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._changeSubscription;
    /**
     * Subscription that looks for changes of select
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._focusSubscription;
    /**
     * Last set value to this control
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._value;
    /**
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._select;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmdTZWxlY3RDb250cm9sVmFsdWVBY2Nlc3Nvci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbWlzYy9uZ1NlbGVjdENvbnRyb2xWYWx1ZUFjY2Vzc29yLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLGlCQUFpQixFQUF1QixNQUFNLGdCQUFnQixDQUFDO0FBQ3ZFLE9BQU8sRUFBQyxVQUFVLEVBQW9CLFNBQVMsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUdqRixPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSx1Q0FBdUMsQ0FBQztBQUN4RSxPQUFPLEVBQUMsV0FBVyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBQyxNQUFNLGVBQWUsQ0FBQzs7Ozs7O0FBTXBGLE1BQU0sS0FBTyx3QkFBd0IsR0FDckM7SUFDSSxPQUFPLEVBQUUsaUJBQWlCO0lBQzFCLFdBQVcsRUFBRSxVQUFVOzs7SUFBQyxjQUFNLE9BQUEsNEJBQTRCLEVBQTVCLENBQTRCLEVBQUM7SUFDM0QsS0FBSyxFQUFFLElBQUk7Q0FDZDs7Ozs7QUFLRDtJQTRDSSxpRUFBaUU7SUFDakUsc0NBQW9CLE9BQWtDO1FBQWxDLFlBQU8sR0FBUCxPQUFPLENBQTJCOzs7O1FBYjlDLHdCQUFtQixHQUFpQixJQUFJLENBQUM7Ozs7UUFLekMsdUJBQWtCLEdBQWlCLElBQUksQ0FBQztJQVVoRCxDQUFDO0lBRUQsNkdBQTZHO0lBRTdHOztPQUVHOzs7Ozs7O0lBQ0ksaURBQVU7Ozs7Ozs7SUFBakIsVUFBa0IsS0FBMkI7UUFBN0MsaUJBMkJDO1FBekJHLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBRXBCLElBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQzdCO1lBQ0ksSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFFdEMsT0FBTztTQUNWO1FBRUQsSUFBRyxJQUFJLENBQUMsd0JBQXdCLEVBQ2hDO1lBQ0ksSUFBSSxDQUFDLHdCQUF3QixDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzVDLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxJQUFJLENBQUM7U0FDeEM7UUFFRCxJQUFJLENBQUMsd0JBQXdCLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsU0FBUzs7OztRQUFDLFVBQUEsV0FBVztZQUUxRSxJQUFHLFdBQVcsRUFDZDtnQkFDSSxLQUFJLENBQUMsd0JBQXdCLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQzVDLEtBQUksQ0FBQyx3QkFBd0IsR0FBRyxJQUFJLENBQUM7Z0JBRXJDLEtBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2FBQ3pDO1FBQ0wsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQ7O09BRUc7Ozs7OztJQUNJLHVEQUFnQjs7Ozs7SUFBdkIsVUFBd0IsRUFBd0M7UUFBaEUsaUJBc0JDO1FBcEJHLElBQUksQ0FBQyw4QkFBOEIsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxTQUFTOzs7O1FBQUMsVUFBQSxXQUFXO1lBRWhGLElBQUcsV0FBVyxFQUNkO2dCQUNJLElBQUcsS0FBSSxDQUFDLG1CQUFtQixFQUMzQjtvQkFDSSxLQUFJLENBQUMsbUJBQW1CLENBQUMsV0FBVyxFQUFFLENBQUM7b0JBQ3ZDLEtBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7aUJBQ25DO2dCQUVELEtBQUksQ0FBQyxtQkFBbUIsR0FBRyxLQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDOztvQkFDdEUsS0FBSyxHQUFHLEtBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBRXJELElBQUcsS0FBSSxDQUFDLE1BQU0sSUFBSSxLQUFLLEVBQ3ZCO29CQUNJLEtBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO29CQUNwQixFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ2I7YUFDSjtRQUNMLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQztJQUVEOztPQUVHOzs7Ozs7SUFDSSx3REFBaUI7Ozs7O0lBQXhCLFVBQXlCLEVBQWM7UUFBdkMsaUJBZUM7UUFiRyxJQUFJLENBQUMsNkJBQTZCLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsU0FBUzs7OztRQUFDLFVBQUEsV0FBVztZQUUvRSxJQUFHLFdBQVcsRUFDZDtnQkFDSSxJQUFHLEtBQUksQ0FBQyxrQkFBa0IsRUFDMUI7b0JBQ0ksS0FBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsRUFBRSxDQUFDO29CQUN0QyxLQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDO2lCQUNsQztnQkFFRCxLQUFJLENBQUMsa0JBQWtCLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQzthQUN4RTtRQUNMLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQztJQUVEOzs7T0FHRzs7Ozs7O0lBQ0ksdURBQWdCOzs7OztJQUF2QixVQUF3QixVQUFtQjtRQUEzQyxpQkF5QkM7UUF2QkcsSUFBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFDN0I7WUFDSSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUU5QyxPQUFPO1NBQ1Y7UUFFRCxJQUFHLElBQUksQ0FBQyxnQ0FBZ0MsRUFDeEM7WUFDSSxJQUFJLENBQUMsZ0NBQWdDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDcEQsSUFBSSxDQUFDLGdDQUFnQyxHQUFHLElBQUksQ0FBQztTQUNoRDtRQUVELElBQUksQ0FBQyxnQ0FBZ0MsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxTQUFTOzs7O1FBQUMsVUFBQSxXQUFXO1lBRWxGLElBQUcsV0FBVyxFQUNkO2dCQUNJLEtBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDcEQsS0FBSSxDQUFDLGdDQUFnQyxHQUFHLElBQUksQ0FBQztnQkFFN0MsS0FBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7YUFDakQ7UUFDTCxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxrR0FBa0c7SUFFbEc7O09BRUc7Ozs7OztJQUNJLGtEQUFXOzs7Ozs7SUFBbEI7UUFFSSxJQUFHLElBQUksQ0FBQyxtQkFBbUIsRUFDM0I7WUFDSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdkMsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztTQUNuQztRQUVELElBQUcsSUFBSSxDQUFDLHdCQUF3QixFQUNoQztZQUNJLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM1QyxJQUFJLENBQUMsd0JBQXdCLEdBQUcsSUFBSSxDQUFDO1NBQ3hDO1FBRUQsSUFBRyxJQUFJLENBQUMsOEJBQThCLEVBQ3RDO1lBQ0ksSUFBSSxDQUFDLDhCQUE4QixDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2xELElBQUksQ0FBQyw4QkFBOEIsR0FBRyxJQUFJLENBQUM7U0FDOUM7UUFFRCxJQUFHLElBQUksQ0FBQyw2QkFBNkIsRUFDckM7WUFDSSxJQUFJLENBQUMsNkJBQTZCLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDakQsSUFBSSxDQUFDLDZCQUE2QixHQUFHLElBQUksQ0FBQztTQUM3QztRQUVELElBQUcsSUFBSSxDQUFDLGtCQUFrQixFQUMxQjtZQUNJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN0QyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDO1NBQ2xDO1FBRUQsSUFBRyxJQUFJLENBQUMsZ0NBQWdDLEVBQ3hDO1lBQ0ksSUFBSSxDQUFDLGdDQUFnQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3BELElBQUksQ0FBQyxnQ0FBZ0MsR0FBRyxJQUFJLENBQUM7U0FDaEQ7SUFDTCxDQUFDOztnQkEzTUosU0FBUyxTQUNWO29CQUNJLFFBQVEsRUFBRSxzRUFBc0U7b0JBQ2hGLFNBQVMsRUFBRSxDQUFDLHdCQUF3QixDQUFDO2lCQUN4Qzs7OztnQkFyQk8saUJBQWlCOztJQTZOekIsbUNBQUM7Q0FBQSxBQTVNRCxJQTRNQztTQXZNWSw0QkFBNEI7Ozs7Ozs7SUFPckMsZ0VBQStDOzs7Ozs7SUFLL0Msc0VBQXFEOzs7Ozs7SUFLckQscUVBQW9EOzs7Ozs7SUFLcEQsd0VBQXVEOzs7Ozs7SUFLdkQsMkRBQWlEOzs7Ozs7SUFLakQsMERBQWdEOzs7Ozs7SUFLaEQsOENBQWdDOzs7OztJQUdwQiwrQ0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge05HX1ZBTFVFX0FDQ0VTU09SLCBDb250cm9sVmFsdWVBY2Nlc3Nvcn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQge2ZvcndhcmRSZWYsIEV4aXN0aW5nUHJvdmlkZXIsIERpcmVjdGl2ZSwgT25EZXN0cm95fSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtTdWJzY3JpcHRpb259IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHtOZ1NlbGVjdENvbXBvbmVudH0gZnJvbSAnLi4vY29tcG9uZW50cy9zZWxlY3Qvc2VsZWN0LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7dmFsdWVDaGFuZ2UsIHNldFZhbHVlLCBvbkZvY3VzLCBzZXRSZWFkb25seSwgZ2V0VmFsdWV9IGZyb20gJy4uL2V4dGVuc2lvbnMnO1xyXG5cclxuLyoqXHJcbiAqIFByb3ZpZGVyIGZvciBjb250cm9sIHZhbHVlIGFjY2Vzc29yXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IE5HX1NFTEVDVF9WQUxVRV9BQ0NFU1NPUjogRXhpc3RpbmdQcm92aWRlciA9XHJcbntcclxuICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTmdTZWxlY3RDb250cm9sVmFsdWVBY2Nlc3NvciksXHJcbiAgICBtdWx0aTogdHJ1ZVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIENvbnRyb2wgdmFsdWUgYWNjZXNzb3IgZm9yIE5nU2VsZWN0Q29tcG9uZW50XHJcbiAqL1xyXG5ARGlyZWN0aXZlKFxyXG57XHJcbiAgICBzZWxlY3RvcjogJ25nLXNlbGVjdFtmb3JtQ29udHJvbE5hbWVdLG5nLXNlbGVjdFtmb3JtQ29udHJvbF0sbmctc2VsZWN0W25nTW9kZWxdJyxcclxuICAgIHByb3ZpZGVyczogW05HX1NFTEVDVF9WQUxVRV9BQ0NFU1NPUl1cclxufSlcclxuZXhwb3J0IGNsYXNzIE5nU2VsZWN0Q29udHJvbFZhbHVlQWNjZXNzb3I8VFZhbHVlPiBpbXBsZW1lbnRzIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBPbkRlc3Ryb3lcclxue1xyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHByaXZhdGUgZmllbGRzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmlwdGlvbiBmb3IgaW5pdGlhbGl6ZWQgc3RhdHVzIG9mIE5nU2VsZWN0LCB1c2VkIGZvciB3cml0ZVZhbHVlXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX2luaXRpYWxpemVkU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpcHRpb24gZm9yIGluaXRpYWxpemVkIHN0YXR1cyBvZiBOZ1NlbGVjdCwgdXNlZCBmb3IgcmVnaXN0ZXJPbkNoYW5nZVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9jaGFuZ2VJbml0aWFsaXplZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaXB0aW9uIGZvciBpbml0aWFsaXplZCBzdGF0dXMgb2YgTmdTZWxlY3QsIHVzZWQgZm9yIHJlZ2lzdGVyT25Ub3VjaGVkXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX3RvdWNoSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmlwdGlvbiBmb3IgaW5pdGlhbGl6ZWQgc3RhdHVzIG9mIE5nU2VsZWN0LCB1c2VkIGZvciBzZXREaXNhYmxlZFN0YXRlXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX2Rpc2FibGVkSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmlwdGlvbiB0aGF0IGxvb2tzIGZvciBjaGFuZ2VzIG9mIHNlbGVjdFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9jaGFuZ2VTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpcHRpb24gdGhhdCBsb29rcyBmb3IgY2hhbmdlcyBvZiBzZWxlY3RcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfZm9jdXNTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBMYXN0IHNldCB2YWx1ZSB0byB0aGlzIGNvbnRyb2xcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfdmFsdWU6IFRWYWx1ZXxUVmFsdWVbXTtcclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgY29uc3RydWN0b3IgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfc2VsZWN0OiBOZ1NlbGVjdENvbXBvbmVudDxUVmFsdWU+KVxyXG4gICAge1xyXG4gICAgfVxyXG5cclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBwdWJsaWMgbWV0aG9kcyAtIGltcGxlbWVudGF0aW9uIG9mIENvbnRyb2xWYWx1ZUFjY2Vzc29yICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldHMgdmFsdWUgdG8gc2VsZWN0XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB3cml0ZVZhbHVlKHZhbHVlOiBUVmFsdWV8QXJyYXk8VFZhbHVlPik6IHZvaWRcclxuICAgIHtcclxuICAgICAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xyXG5cclxuICAgICAgICBpZih0aGlzLl9zZWxlY3QuaXNJbml0aWFsaXplZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdC5leGVjdXRlKHNldFZhbHVlKHZhbHVlKSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLl9pbml0aWFsaXplZFN1YnNjcmlwdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2luaXRpYWxpemVkU3Vic2NyaXB0aW9uID0gdGhpcy5fc2VsZWN0LmluaXRpYWxpemVkLnN1YnNjcmliZShpbml0aWFsaXplZCA9PlxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYoaW5pdGlhbGl6ZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdC5leGVjdXRlKHNldFZhbHVlKHZhbHVlKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVycyBjYWxsYmFjayB0aGF0IGlzIGNhbGxlZCB3aGVuIHZhbHVlIG9mIHNlbGVjdCBjaGFuZ2VzXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyByZWdpc3Rlck9uQ2hhbmdlKGZuOiAoZGF0YTogVFZhbHVlfEFycmF5PFRWYWx1ZT4pID0+IHZvaWQpOiB2b2lkXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5fY2hhbmdlSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24gPSB0aGlzLl9zZWxlY3QuaW5pdGlhbGl6ZWQuc3Vic2NyaWJlKGluaXRpYWxpemVkID0+XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZihpbml0aWFsaXplZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5fY2hhbmdlU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlU3Vic2NyaXB0aW9uID0gdGhpcy5fc2VsZWN0LmV4ZWN1dGVBbmRSZXR1cm4odmFsdWVDaGFuZ2UoZm4pKTtcclxuICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuX3NlbGVjdC5leGVjdXRlQW5kUmV0dXJuKGdldFZhbHVlKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuX3ZhbHVlICE9IHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZm4odmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWdpc3RlcnMgY2FsbGJhY2sgdGhhdCBpcyBjYWxsZWQgd2hlbiBzZWxlY3QgaXMgY2xvc2VkXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4gdm9pZCk6IHZvaWRcclxuICAgIHtcclxuICAgICAgICB0aGlzLl90b3VjaEluaXRpYWxpemVkU3Vic2NyaXB0aW9uID0gdGhpcy5fc2VsZWN0LmluaXRpYWxpemVkLnN1YnNjcmliZShpbml0aWFsaXplZCA9PlxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYoaW5pdGlhbGl6ZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuX2ZvY3VzU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZvY3VzU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2ZvY3VzU3Vic2NyaXB0aW9uID0gdGhpcy5fc2VsZWN0LmV4ZWN1dGVBbmRSZXR1cm4ob25Gb2N1cyhmbikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXRzIE5nU2VsZWN0IGFzIGRpc2FibGVkL3JlYWRvbmx5XHJcbiAgICAgKiBAcGFyYW0gaXNEaXNhYmxlZCBJbmRpY2F0aW9uIHdoZXRoZXIgaXMgY29udHJvbCBkaXNhYmxlZCBvciBub3RcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQgXHJcbiAgICB7XHJcbiAgICAgICAgaWYodGhpcy5fc2VsZWN0LmlzSW5pdGlhbGl6ZWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWxlY3QuZXhlY3V0ZShzZXRSZWFkb25seShpc0Rpc2FibGVkKSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLl9kaXNhYmxlZEluaXRpYWxpemVkU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fZGlzYWJsZWRJbml0aWFsaXplZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9kaXNhYmxlZEluaXRpYWxpemVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2Rpc2FibGVkSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24gPSB0aGlzLl9zZWxlY3QuaW5pdGlhbGl6ZWQuc3Vic2NyaWJlKGluaXRpYWxpemVkID0+XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZihpbml0aWFsaXplZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZGlzYWJsZWRJbml0aWFsaXplZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZGlzYWJsZWRJbml0aWFsaXplZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0LmV4ZWN1dGUoc2V0UmVhZG9ubHkoaXNEaXNhYmxlZCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBtZXRob2RzIC0gaW1wbGVtZW50YXRpb24gb2YgT25EZXN0cm95ICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIENhbGxlZCB3aGVuIGNvbXBvbmVudCBpcyBkZXN0cm95ZWRcclxuICAgICAqL1xyXG4gICAgcHVibGljIG5nT25EZXN0cm95KClcclxuICAgIHtcclxuICAgICAgICBpZih0aGlzLl9jaGFuZ2VTdWJzY3JpcHRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9jaGFuZ2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fY2hhbmdlU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX2luaXRpYWxpemVkU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5fY2hhbmdlSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9jaGFuZ2VJbml0aWFsaXplZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9jaGFuZ2VJbml0aWFsaXplZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLl90b3VjaEluaXRpYWxpemVkU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fdG91Y2hJbml0aWFsaXplZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl90b3VjaEluaXRpYWxpemVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX2ZvY3VzU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fZm9jdXNTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fZm9jdXNTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5fZGlzYWJsZWRJbml0aWFsaXplZFN1YnNjcmlwdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVkSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fZGlzYWJsZWRJbml0aWFsaXplZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19