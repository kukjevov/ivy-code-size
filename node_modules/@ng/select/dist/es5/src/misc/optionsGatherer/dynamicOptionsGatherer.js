var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter } from "@angular/core";
import { isPresent, isBlank } from "@asseco/common";
import { debounceTime } from "rxjs/operators";
import { LIVE_SEARCH } from "../../plugins/liveSearch/types";
/**
 * Class that is used as for options gathering in dynamic way, for example from external source when writing
 * @template TValue
 */
var /**
 * Class that is used as for options gathering in dynamic way, for example from external source when writing
 * @template TValue
 */
DynamicOptionsGatherer = /** @class */ (function () {
    //######################### constructor #########################
    function DynamicOptionsGatherer(_options) {
        this._options = _options;
        /**
         * Minimal number of characters required for searching
         */
        this._minLength = 2;
        //######################### public properties - implementation of OptionsGatherer #########################
        /**
         * Array of provided options for select
         */
        this.options = [];
        /**
         * Occurs when array of provided options has changed
         */
        this.optionsChange = new EventEmitter();
        if (!this._options) {
            throw new Error("Options can not be null!");
        }
        if (this._options && isPresent(this._options.minLength)) {
            this._minLength = this._options.minLength;
        }
    }
    Object.defineProperty(DynamicOptionsGatherer.prototype, "availableOptions", {
        /**
         * Array of visible, displayed options for select
         */
        get: /**
         * Array of visible, displayed options for select
         * @return {?}
         */
        function () {
            return this.options;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DynamicOptionsGatherer.prototype, "availableOptionsChange", {
        /**
         * Occurs when array of visible, displayed options has changed
         */
        get: /**
         * Occurs when array of visible, displayed options has changed
         * @return {?}
         */
        function () {
            return this.optionsChange;
        },
        enumerable: true,
        configurable: true
    });
    //######################### public methods - implementation of OptionsGatherer #########################
    /**
     * Initialize gatherer during initialization phase
     */
    //######################### public methods - implementation of OptionsGatherer #########################
    /**
     * Initialize gatherer during initialization phase
     * @return {?}
     */
    DynamicOptionsGatherer.prototype.initializeGatherer = 
    //######################### public methods - implementation of OptionsGatherer #########################
    /**
     * Initialize gatherer during initialization phase
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var liveSearch = (/** @type {?} */ (this.ngSelectPlugins[LIVE_SEARCH]));
        if (this._liveSearch && this._liveSearch != liveSearch) {
            this._searchValueChangeSubscription.unsubscribe();
            this._searchValueChangeSubscription = null;
            this._liveSearch = null;
        }
        if (!this._liveSearch) {
            this._liveSearch = liveSearch;
            /** @type {?} */
            var searchValueChange = this._liveSearch.searchValueChange;
            if (this._options.delay) {
                searchValueChange = searchValueChange.pipe(debounceTime(this._options.delay));
            }
            this._searchValueChangeSubscription = searchValueChange.subscribe((/**
             * @return {?}
             */
            function () { return __awaiter(_this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            if (isBlank(this._liveSearch.searchValue) || this._liveSearch.searchValue.length < this._minLength) {
                                this.options = [];
                                this.optionsChange.emit();
                                return [2 /*return*/];
                            }
                            _a = this;
                            return [4 /*yield*/, this._options.dynamicOptionsCallback(this._liveSearch.searchValue)];
                        case 1:
                            _a.options = _b.sent();
                            this.optionsChange.emit();
                            return [2 /*return*/];
                    }
                });
            }); }));
        }
    };
    /**
     * Called when gatherer needs to be destroyed
     */
    /**
     * Called when gatherer needs to be destroyed
     * @return {?}
     */
    DynamicOptionsGatherer.prototype.destroyGatherer = /**
     * Called when gatherer needs to be destroyed
     * @return {?}
     */
    function () {
        if (this._searchValueChangeSubscription) {
            this._searchValueChangeSubscription.unsubscribe();
            this._searchValueChangeSubscription = null;
        }
    };
    return DynamicOptionsGatherer;
}());
/**
 * Class that is used as for options gathering in dynamic way, for example from external source when writing
 * @template TValue
 */
export { DynamicOptionsGatherer };
if (false) {
    /**
     * Live search plugin currently used in NgSelect
     * @type {?}
     * @protected
     */
    DynamicOptionsGatherer.prototype._liveSearch;
    /**
     * Subscription for changes of live search value
     * @type {?}
     * @protected
     */
    DynamicOptionsGatherer.prototype._searchValueChangeSubscription;
    /**
     * Minimal number of characters required for searching
     * @type {?}
     * @protected
     */
    DynamicOptionsGatherer.prototype._minLength;
    /**
     * Array of provided options for select
     * @type {?}
     */
    DynamicOptionsGatherer.prototype.options;
    /**
     * Occurs when array of provided options has changed
     * @type {?}
     */
    DynamicOptionsGatherer.prototype.optionsChange;
    /**
     * NgSelect plugin instances available for gatherer
     * @type {?}
     */
    DynamicOptionsGatherer.prototype.ngSelectPlugins;
    /**
     * @type {?}
     * @protected
     */
    DynamicOptionsGatherer.prototype._options;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pY09wdGlvbnNHYXRoZXJlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9taXNjL29wdGlvbnNHYXRoZXJlci9keW5hbWljT3B0aW9uc0dhdGhlcmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFDLFNBQVMsRUFBRSxPQUFPLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUVsRCxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFPNUMsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLGdDQUFnQyxDQUFDOzs7OztBQUszRDs7Ozs7SUFvREksaUVBQWlFO0lBQ2pFLGdDQUFzQixRQUErQztRQUEvQyxhQUFRLEdBQVIsUUFBUSxDQUF1Qzs7OztRQXBDM0QsZUFBVSxHQUFXLENBQUMsQ0FBQzs7Ozs7UUFPMUIsWUFBTyxHQUE2QixFQUFFLENBQUM7Ozs7UUFLdkMsa0JBQWEsR0FBdUIsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQTBCaEUsSUFBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQ2pCO1lBQ0ksTUFBTSxJQUFJLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1NBQy9DO1FBRUQsSUFBRyxJQUFJLENBQUMsUUFBUSxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUN0RDtZQUNJLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUM7U0FDN0M7SUFDTCxDQUFDO0lBOUJELHNCQUFXLG9EQUFnQjtRQUgzQjs7V0FFRzs7Ozs7UUFDSDtZQUVJLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUN4QixDQUFDOzs7T0FBQTtJQUtELHNCQUFXLDBEQUFzQjtRQUhqQzs7V0FFRzs7Ozs7UUFDSDtZQUVJLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztRQUM5QixDQUFDOzs7T0FBQTtJQXFCRCx3R0FBd0c7SUFFeEc7O09BRUc7Ozs7OztJQUNJLG1EQUFrQjs7Ozs7O0lBQXpCO1FBQUEsaUJBcUNDOztZQW5DTyxVQUFVLEdBQUcsbUJBQUEsSUFBSSxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsRUFBYztRQUVoRSxJQUFHLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLFdBQVcsSUFBSSxVQUFVLEVBQ3JEO1lBQ0ksSUFBSSxDQUFDLDhCQUE4QixDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2xELElBQUksQ0FBQyw4QkFBOEIsR0FBRyxJQUFJLENBQUM7WUFFM0MsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7U0FDM0I7UUFFRCxJQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFDcEI7WUFDSSxJQUFJLENBQUMsV0FBVyxHQUFHLFVBQVUsQ0FBQzs7Z0JBRTFCLGlCQUFpQixHQUFxQixJQUFJLENBQUMsV0FBVyxDQUFDLGlCQUFpQjtZQUU1RSxJQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUN0QjtnQkFDSSxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzthQUNqRjtZQUVELElBQUksQ0FBQyw4QkFBOEIsR0FBRyxpQkFBaUIsQ0FBQyxTQUFTOzs7WUFBQzs7Ozs7NEJBRTlELElBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQ2pHO2dDQUNJLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO2dDQUNsQixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDO2dDQUUxQixzQkFBTzs2QkFDVjs0QkFFRCxLQUFBLElBQUksQ0FBQTs0QkFBVyxxQkFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLEVBQUE7OzRCQUF2RixHQUFLLE9BQU8sR0FBRyxTQUF3RSxDQUFDOzRCQUN4RixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDOzs7O2lCQUM3QixFQUFDLENBQUM7U0FDTjtJQUNMLENBQUM7SUFFRDs7T0FFRzs7Ozs7SUFDSSxnREFBZTs7OztJQUF0QjtRQUVJLElBQUcsSUFBSSxDQUFDLDhCQUE4QixFQUN0QztZQUNJLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNsRCxJQUFJLENBQUMsOEJBQThCLEdBQUcsSUFBSSxDQUFDO1NBQzlDO0lBQ0wsQ0FBQztJQUNMLDZCQUFDO0FBQUQsQ0FBQyxBQXpIRCxJQXlIQzs7Ozs7Ozs7Ozs7O0lBbEhHLDZDQUFrQzs7Ozs7O0lBS2xDLGdFQUF1RDs7Ozs7O0lBS3ZELDRDQUFpQzs7Ozs7SUFPakMseUNBQThDOzs7OztJQUs5QywrQ0FBb0U7Ozs7O0lBcUJwRSxpREFBZ0Q7Ozs7O0lBR3BDLDBDQUF5RCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RXZlbnRFbWl0dGVyfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQge2lzUHJlc2VudCwgaXNCbGFua30gZnJvbSBcIkBhc3NlY28vY29tbW9uXCI7XHJcbmltcG9ydCB7U3Vic2NyaXB0aW9uLCBPYnNlcnZhYmxlfSBmcm9tIFwicnhqc1wiO1xyXG5pbXBvcnQge2RlYm91bmNlVGltZX0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XHJcblxyXG5pbXBvcnQge09wdGlvbnNHYXRoZXJlcn0gZnJvbSBcIi4vb3B0aW9uc0dhdGhlcmVyLmludGVyZmFjZVwiO1xyXG5pbXBvcnQge05nU2VsZWN0UGx1Z2luSW5zdGFuY2VzfSBmcm9tIFwiLi4vLi4vY29tcG9uZW50cy9zZWxlY3RcIjtcclxuaW1wb3J0IHtOZ1NlbGVjdE9wdGlvbn0gZnJvbSBcIi4uLy4uL2NvbXBvbmVudHMvb3B0aW9uXCI7XHJcbmltcG9ydCB7RHluYW1pY09wdGlvbnNHYXRoZXJlck9wdGlvbnN9IGZyb20gXCIuL2R5bmFtaWNPcHRpb25zR2F0aGVyZXIuaW50ZXJmYWNlXCI7XHJcbmltcG9ydCB7TGl2ZVNlYXJjaH0gZnJvbSBcIi4uLy4uL3BsdWdpbnMvbGl2ZVNlYXJjaFwiO1xyXG5pbXBvcnQge0xJVkVfU0VBUkNIfSBmcm9tIFwiLi4vLi4vcGx1Z2lucy9saXZlU2VhcmNoL3R5cGVzXCI7XHJcblxyXG4vKipcclxuICogQ2xhc3MgdGhhdCBpcyB1c2VkIGFzIGZvciBvcHRpb25zIGdhdGhlcmluZyBpbiBkeW5hbWljIHdheSwgZm9yIGV4YW1wbGUgZnJvbSBleHRlcm5hbCBzb3VyY2Ugd2hlbiB3cml0aW5nXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRHluYW1pY09wdGlvbnNHYXRoZXJlcjxUVmFsdWU+IGltcGxlbWVudHMgT3B0aW9uc0dhdGhlcmVyPFRWYWx1ZT5cclxue1xyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHByb3RlY3RlZCBmaWVsZHMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogTGl2ZSBzZWFyY2ggcGx1Z2luIGN1cnJlbnRseSB1c2VkIGluIE5nU2VsZWN0XHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfbGl2ZVNlYXJjaDogTGl2ZVNlYXJjaDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmlwdGlvbiBmb3IgY2hhbmdlcyBvZiBsaXZlIHNlYXJjaCB2YWx1ZVxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX3NlYXJjaFZhbHVlQ2hhbmdlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNaW5pbWFsIG51bWJlciBvZiBjaGFyYWN0ZXJzIHJlcXVpcmVkIGZvciBzZWFyY2hpbmdcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9taW5MZW5ndGg6IG51bWJlciA9IDI7XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBwcm9wZXJ0aWVzIC0gaW1wbGVtZW50YXRpb24gb2YgT3B0aW9uc0dhdGhlcmVyICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIEFycmF5IG9mIHByb3ZpZGVkIG9wdGlvbnMgZm9yIHNlbGVjdFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3B0aW9uczogTmdTZWxlY3RPcHRpb248VFZhbHVlPltdID0gW107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBPY2N1cnMgd2hlbiBhcnJheSBvZiBwcm92aWRlZCBvcHRpb25zIGhhcyBjaGFuZ2VkXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcHRpb25zQ2hhbmdlOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBcnJheSBvZiB2aXNpYmxlLCBkaXNwbGF5ZWQgb3B0aW9ucyBmb3Igc2VsZWN0XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXQgYXZhaWxhYmxlT3B0aW9ucygpOiBOZ1NlbGVjdE9wdGlvbjxUVmFsdWU+W11cclxuICAgIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogT2NjdXJzIHdoZW4gYXJyYXkgb2YgdmlzaWJsZSwgZGlzcGxheWVkIG9wdGlvbnMgaGFzIGNoYW5nZWRcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldCBhdmFpbGFibGVPcHRpb25zQ2hhbmdlKCk6IEV2ZW50RW1pdHRlcjx2b2lkPlxyXG4gICAge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnNDaGFuZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBOZ1NlbGVjdCBwbHVnaW4gaW5zdGFuY2VzIGF2YWlsYWJsZSBmb3IgZ2F0aGVyZXJcclxuICAgICAqL1xyXG4gICAgcHVibGljIG5nU2VsZWN0UGx1Z2luczogTmdTZWxlY3RQbHVnaW5JbnN0YW5jZXM7XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIGNvbnN0cnVjdG9yICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBfb3B0aW9uczogRHluYW1pY09wdGlvbnNHYXRoZXJlck9wdGlvbnM8VFZhbHVlPilcclxuICAgIHtcclxuICAgICAgICBpZighdGhpcy5fb3B0aW9ucylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk9wdGlvbnMgY2FuIG5vdCBiZSBudWxsIVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX29wdGlvbnMgJiYgaXNQcmVzZW50KHRoaXMuX29wdGlvbnMubWluTGVuZ3RoKSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX21pbkxlbmd0aCA9IHRoaXMuX29wdGlvbnMubWluTGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHVibGljIG1ldGhvZHMgLSBpbXBsZW1lbnRhdGlvbiBvZiBPcHRpb25zR2F0aGVyZXIgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGl6ZSBnYXRoZXJlciBkdXJpbmcgaW5pdGlhbGl6YXRpb24gcGhhc2VcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluaXRpYWxpemVHYXRoZXJlcigpOiB2b2lkXHJcbiAgICB7XHJcbiAgICAgICAgbGV0IGxpdmVTZWFyY2ggPSB0aGlzLm5nU2VsZWN0UGx1Z2luc1tMSVZFX1NFQVJDSF0gYXMgTGl2ZVNlYXJjaDtcclxuXHJcbiAgICAgICAgaWYodGhpcy5fbGl2ZVNlYXJjaCAmJiB0aGlzLl9saXZlU2VhcmNoICE9IGxpdmVTZWFyY2gpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWFyY2hWYWx1ZUNoYW5nZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9zZWFyY2hWYWx1ZUNoYW5nZVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9saXZlU2VhcmNoID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKCF0aGlzLl9saXZlU2VhcmNoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fbGl2ZVNlYXJjaCA9IGxpdmVTZWFyY2g7XHJcblxyXG4gICAgICAgICAgICBsZXQgc2VhcmNoVmFsdWVDaGFuZ2U6IE9ic2VydmFibGU8dm9pZD4gPSB0aGlzLl9saXZlU2VhcmNoLnNlYXJjaFZhbHVlQ2hhbmdlO1xyXG5cclxuICAgICAgICAgICAgaWYodGhpcy5fb3B0aW9ucy5kZWxheSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoVmFsdWVDaGFuZ2UgPSBzZWFyY2hWYWx1ZUNoYW5nZS5waXBlKGRlYm91bmNlVGltZSh0aGlzLl9vcHRpb25zLmRlbGF5KSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFZhbHVlQ2hhbmdlU3Vic2NyaXB0aW9uID0gc2VhcmNoVmFsdWVDaGFuZ2Uuc3Vic2NyaWJlKGFzeW5jICgpID0+XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmKGlzQmxhbmsodGhpcy5fbGl2ZVNlYXJjaC5zZWFyY2hWYWx1ZSkgfHwgdGhpcy5fbGl2ZVNlYXJjaC5zZWFyY2hWYWx1ZS5sZW5ndGggPCB0aGlzLl9taW5MZW5ndGgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zQ2hhbmdlLmVtaXQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IGF3YWl0IHRoaXMuX29wdGlvbnMuZHluYW1pY09wdGlvbnNDYWxsYmFjayh0aGlzLl9saXZlU2VhcmNoLnNlYXJjaFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc0NoYW5nZS5lbWl0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENhbGxlZCB3aGVuIGdhdGhlcmVyIG5lZWRzIHRvIGJlIGRlc3Ryb3llZFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZGVzdHJveUdhdGhlcmVyKCk6IHZvaWRcclxuICAgIHtcclxuICAgICAgICBpZih0aGlzLl9zZWFyY2hWYWx1ZUNoYW5nZVN1YnNjcmlwdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFZhbHVlQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlYXJjaFZhbHVlQ2hhbmdlU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=