/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ChangeDetectionStrategy, Inject, Optional, ElementRef, PLATFORM_ID } from '@angular/core';
import { DOCUMENT, isPlatformBrowser } from '@angular/common';
import { extend } from '@asseco/common';
import * as positions from 'positions';
import { NG_SELECT_PLUGIN_INSTANCES } from '../../../components/select/types';
import { POSITIONER_OPTIONS } from '../types';
import { POPUP } from '../../popup/types';
/**
 * Default options for positioner
 * \@internal
 * @type {?}
 */
var defaultOptions = {
    optionsCoordinates: 'top left',
    selectCoordinates: 'bottom left'
};
/**
 * Component used for positioning popup element
 */
var BasicPositionerComponent = /** @class */ (function () {
    //######################### constructor #########################
    function BasicPositionerComponent(ngSelectPlugins, pluginElement, options, _document, _platformId) {
        var _this = this;
        this.ngSelectPlugins = ngSelectPlugins;
        this.pluginElement = pluginElement;
        this._document = _document;
        this._platformId = _platformId;
        /**
         * Indication whether is code running in browser
         */
        this._isBrowser = isPlatformBrowser(this._platformId);
        //######################### protected methods #########################
        /**
         * Handles resize and scroll event
         */
        this._handleResizeAndScroll = (/**
         * @return {?}
         */
        function () {
            _this._calculatePositionAndDimensions();
        });
        this._options = extend(true, {}, defaultOptions, options);
    }
    Object.defineProperty(BasicPositionerComponent.prototype, "options", {
        //######################### public properties - implementation of BasicPositioner #########################
        /**
         * Options for NgSelect plugin
         */
        get: 
        //######################### public properties - implementation of BasicPositioner #########################
        /**
         * Options for NgSelect plugin
         * @return {?}
         */
        function () {
            return this._options;
        },
        set: /**
         * @param {?} options
         * @return {?}
         */
        function (options) {
            this._options = extend(true, this._options, options);
        },
        enumerable: true,
        configurable: true
    });
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     */
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    BasicPositionerComponent.prototype.ngOnDestroy = 
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    function () {
        if (this._visibilitySubscription) {
            this._visibilitySubscription.unsubscribe();
            this._visibilitySubscription = null;
        }
        if (this._optionsChangeSubscription) {
            this._optionsChangeSubscription.unsubscribe();
            this._optionsChangeSubscription = null;
        }
        if (this._isBrowser) {
            window.removeEventListener('resize', this._handleResizeAndScroll);
            window.removeEventListener('scroll', this._handleResizeAndScroll);
        }
    };
    //######################### public methods - implementation of BasicPositioner #########################
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     */
    //######################### public methods - implementation of BasicPositioner #########################
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     * @return {?}
     */
    BasicPositionerComponent.prototype.initialize = 
    //######################### public methods - implementation of BasicPositioner #########################
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     * @return {?}
     */
    function () {
        var _this = this;
        if (this._optionsGatherer && this._optionsGatherer != this.optionsGatherer) {
            this._optionsChangeSubscription.unsubscribe();
            this._optionsChangeSubscription = null;
            this._optionsGatherer = null;
        }
        if (!this._optionsGatherer) {
            this._optionsGatherer = this.optionsGatherer;
            this._optionsChangeSubscription = this._optionsGatherer.availableOptionsChange.subscribe((/**
             * @return {?}
             */
            function () {
                if (_this._popup.popupElement && _this.optionsGatherer.availableOptions && _this.optionsGatherer.availableOptions.length) {
                    _this._handlePosition();
                }
            }));
        }
        /** @type {?} */
        var popup = (/** @type {?} */ (this.ngSelectPlugins[POPUP]));
        if (this._popup && this._popup != popup) {
            this._visibilitySubscription.unsubscribe();
            this._visibilitySubscription = null;
            this._popup = null;
        }
        if (!this._popup) {
            this._popup = popup;
            this._visibilitySubscription = this._popup.visibilityChange.subscribe((/**
             * @return {?}
             */
            function () { return _this._handlePosition(); }));
        }
        this._handlePosition();
    };
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     */
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    BasicPositionerComponent.prototype.initOptions = /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    function () {
    };
    /**
     * Explicitly runs invalidation of content (change detection)
     */
    /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    BasicPositionerComponent.prototype.invalidateVisuals = /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    function () {
    };
    /**
     * Handles position of popup
     */
    /**
     * Handles position of popup
     * @protected
     * @return {?}
     */
    BasicPositionerComponent.prototype._handlePosition = /**
     * Handles position of popup
     * @protected
     * @return {?}
     */
    function () {
        this._popupElement = this._popup.popupElement;
        if (this._isBrowser) {
            //register events and handle position of opened popup
            if (this._popupElement) {
                window.addEventListener('resize', this._handleResizeAndScroll);
                window.addEventListener('scroll', this._handleResizeAndScroll);
                this._handleResizeAndScroll();
            }
            //unregister events
            else {
                window.removeEventListener('resize', this._handleResizeAndScroll);
                window.removeEventListener('scroll', this._handleResizeAndScroll);
            }
        }
    };
    /**
     * Calculates positions and dimensions of popup
     */
    /**
     * Calculates positions and dimensions of popup
     * @protected
     * @return {?}
     */
    BasicPositionerComponent.prototype._calculatePositionAndDimensions = /**
     * Calculates positions and dimensions of popup
     * @protected
     * @return {?}
     */
    function () {
        var _a;
        //set to default position
        /** @type {?} */
        var popupCoordinates = positions(this._popupElement, this.options.optionsCoordinates, this.selectElement, this.options.selectCoordinates);
        this._popupElement.style.left = popupCoordinates.left + "px";
        this._popupElement.style.top = popupCoordinates.top + "px";
        this._popupElement.style.maxHeight = '';
        //flip if collision with viewport
        /** @type {?} */
        var optionsCoordinates;
        /** @type {?} */
        var selectCoordinates;
        _a = this._flipIfCollision(this._popupElement), popupCoordinates = _a[0], optionsCoordinates = _a[1], selectCoordinates = _a[2];
        this._popupElement.style.left = popupCoordinates.left + "px";
        this._popupElement.style.top = popupCoordinates.top + "px";
        //set maxHeight if there is not more place
        this._updateHeight(this._popupElement);
        popupCoordinates = positions(this._popupElement, optionsCoordinates, this.selectElement, selectCoordinates);
        this._popupElement.style.left = popupCoordinates.left + "px";
        this._popupElement.style.top = popupCoordinates.top + "px";
    };
    /**
     * Updates height of element
     * @param popupElement Html element for popup div
     */
    /**
     * Updates height of element
     * @protected
     * @param {?} popupElement Html element for popup div
     * @return {?}
     */
    BasicPositionerComponent.prototype._updateHeight = /**
     * Updates height of element
     * @protected
     * @param {?} popupElement Html element for popup div
     * @return {?}
     */
    function (popupElement) {
        /** @type {?} */
        var rect = popupElement.getBoundingClientRect();
        /** @type {?} */
        var selectRect = this.selectElement.getBoundingClientRect();
        /** @type {?} */
        var h = Math.max(this._document.documentElement.clientHeight, window.innerHeight || 0);
        //popup is above
        if (rect.top < selectRect.top) {
            //space above is not enough
            popupElement.style.maxHeight = selectRect.top - 6 + "px";
        }
        //popup is below
        else {
            //space below is not enough
            popupElement.style.maxHeight = h - selectRect.bottom - 6 + "px";
        }
    };
    /**
     * Flips html element position if collision occur
     * @param popupElement Html element to be flipped if collisions occur
     */
    /**
     * Flips html element position if collision occur
     * @protected
     * @param {?} popupElement Html element to be flipped if collisions occur
     * @return {?}
     */
    BasicPositionerComponent.prototype._flipIfCollision = /**
     * Flips html element position if collision occur
     * @protected
     * @param {?} popupElement Html element to be flipped if collisions occur
     * @return {?}
     */
    function (popupElement) {
        /** @type {?} */
        var w = Math.max(this._document.documentElement.clientWidth, window.innerWidth || 0);
        /** @type {?} */
        var h = Math.max(this._document.documentElement.clientHeight, window.innerHeight || 0);
        /** @type {?} */
        var rect = popupElement.getBoundingClientRect();
        /** @type {?} */
        var selectRect = this.selectElement.getBoundingClientRect();
        /** @type {?} */
        var spaceAbove = selectRect.top;
        /** @type {?} */
        var spaceUnder = h - selectRect.bottom;
        /** @type {?} */
        var spaceBefore = selectRect.left;
        /** @type {?} */
        var spaceAfter = w - selectRect.right;
        /** @type {?} */
        var optionsCoordinates = this.options.optionsCoordinates;
        /** @type {?} */
        var selectCoordinates = this.options.selectCoordinates;
        //vertical overflow
        if ((h < rect.bottom &&
            spaceUnder < spaceAbove) ||
            (rect.top < 0 &&
                spaceAbove < spaceUnder)) {
            optionsCoordinates = this._flipVertiacal(optionsCoordinates);
            selectCoordinates = this._flipVertiacal(selectCoordinates);
        }
        //horizontal overflow
        if ((w < (rect.left + rect.width) &&
            spaceAfter < spaceBefore) ||
            (rect.left < 0 &&
                spaceBefore < spaceAfter)) {
            optionsCoordinates = this._flipHorizontal(optionsCoordinates);
            selectCoordinates = this._flipHorizontal(selectCoordinates);
        }
        return [positions(popupElement, optionsCoordinates, this.selectElement, selectCoordinates), optionsCoordinates, selectCoordinates];
    };
    /**
     * Flips vertical position
     * @param position Position to be flipped vertically
     */
    /**
     * Flips vertical position
     * @protected
     * @param {?} position Position to be flipped vertically
     * @return {?}
     */
    BasicPositionerComponent.prototype._flipVertiacal = /**
     * Flips vertical position
     * @protected
     * @param {?} position Position to be flipped vertically
     * @return {?}
     */
    function (position) {
        if (position.indexOf('top') >= 0) {
            return (/** @type {?} */ (position.replace('top', 'bottom')));
        }
        else if (position.indexOf('bottom') >= 0) {
            return (/** @type {?} */ (position.replace('bottom', 'top')));
        }
        return position;
    };
    /**
     * Flips horizontal position
     * @param position Position to be flipped horizontally
     */
    /**
     * Flips horizontal position
     * @protected
     * @param {?} position Position to be flipped horizontally
     * @return {?}
     */
    BasicPositionerComponent.prototype._flipHorizontal = /**
     * Flips horizontal position
     * @protected
     * @param {?} position Position to be flipped horizontally
     * @return {?}
     */
    function (position) {
        if (position.indexOf('right') >= 0) {
            return (/** @type {?} */ (position.replace('right', 'left')));
        }
        else if (position.indexOf('left') >= 0) {
            return (/** @type {?} */ (position.replace('left', 'right')));
        }
        return position;
    };
    BasicPositionerComponent.decorators = [
        { type: Component, args: [{
                    selector: "ng-basic-positioner",
                    template: '',
                    changeDetection: ChangeDetectionStrategy.OnPush
                }] }
    ];
    /** @nocollapse */
    BasicPositionerComponent.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [NG_SELECT_PLUGIN_INSTANCES,] }, { type: Optional }] },
        { type: ElementRef },
        { type: undefined, decorators: [{ type: Inject, args: [POSITIONER_OPTIONS,] }, { type: Optional }] },
        { type: HTMLDocument, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
        { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    return BasicPositionerComponent;
}());
export { BasicPositionerComponent };
if (false) {
    /**
     * Instance of previous options gatherer, that is used for obtaining available options
     * @type {?}
     * @protected
     */
    BasicPositionerComponent.prototype._optionsGatherer;
    /**
     * Options for NgSelect plugin
     * @type {?}
     * @protected
     */
    BasicPositionerComponent.prototype._options;
    /**
     * Subscription for visibility change of popup
     * @type {?}
     * @protected
     */
    BasicPositionerComponent.prototype._visibilitySubscription;
    /**
     * Subscription for changes of options in options gatherer
     * @type {?}
     * @protected
     */
    BasicPositionerComponent.prototype._optionsChangeSubscription;
    /**
     * Popup that is displayed
     * @type {?}
     * @protected
     */
    BasicPositionerComponent.prototype._popup;
    /**
     * Html element of popup plugin
     * @type {?}
     * @protected
     */
    BasicPositionerComponent.prototype._popupElement;
    /**
     * Indication whether is code running in browser
     * @type {?}
     * @protected
     */
    BasicPositionerComponent.prototype._isBrowser;
    /**
     * HTML element that represents select itself
     * @type {?}
     */
    BasicPositionerComponent.prototype.selectElement;
    /**
     * Instance of options gatherer, that is used for obtaining available options
     * @type {?}
     */
    BasicPositionerComponent.prototype.optionsGatherer;
    /**
     * Handles resize and scroll event
     * @type {?}
     * @protected
     */
    BasicPositionerComponent.prototype._handleResizeAndScroll;
    /** @type {?} */
    BasicPositionerComponent.prototype.ngSelectPlugins;
    /** @type {?} */
    BasicPositionerComponent.prototype.pluginElement;
    /**
     * @type {?}
     * @protected
     */
    BasicPositionerComponent.prototype._document;
    /**
     * @type {?}
     * @protected
     */
    BasicPositionerComponent.prototype._platformId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzaWNQb3NpdGlvbmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9wbHVnaW5zL3Bvc2l0aW9uZXIvYmFzaWMvYmFzaWNQb3NpdGlvbmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSx1QkFBdUIsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBYSxXQUFXLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDdkgsT0FBTyxFQUFDLFFBQVEsRUFBRSxpQkFBaUIsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQzVELE9BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUV0QyxPQUFPLEtBQUssU0FBUyxNQUFNLFdBQVcsQ0FBQztBQUt2QyxPQUFPLEVBQUMsMEJBQTBCLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQztBQUM1RSxPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFFNUMsT0FBTyxFQUFDLEtBQUssRUFBQyxNQUFNLG1CQUFtQixDQUFDOzs7Ozs7SUFNbEMsY0FBYyxHQUNwQjtJQUNJLGtCQUFrQixFQUFFLFVBQVU7SUFDOUIsaUJBQWlCLEVBQUUsYUFBYTtDQUNuQzs7OztBQUtEO0lBcUVJLGlFQUFpRTtJQUNqRSxrQ0FBbUUsZUFBd0MsRUFDeEYsYUFBeUIsRUFDUSxPQUFnQyxFQUM1QyxTQUF3QixFQUNyQixXQUFvQjtRQUovRCxpQkFPQztRQVBrRSxvQkFBZSxHQUFmLGVBQWUsQ0FBeUI7UUFDeEYsa0JBQWEsR0FBYixhQUFhLENBQVk7UUFFSixjQUFTLEdBQVQsU0FBUyxDQUFlO1FBQ3JCLGdCQUFXLEdBQVgsV0FBVyxDQUFTOzs7O1FBL0JyRCxlQUFVLEdBQVksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDOzs7OztRQWlJMUQsMkJBQXNCOzs7UUFB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MENBQXdCOzs7Ozs7SUFLeEIsaURBQXFDOzs7Ozs7SUFLckMsOENBQW9FOzs7OztJQW1CcEUsaURBQWtDOzs7OztJQUtsQyxtREFBNkM7Ozs7OztJQXlHN0MsMERBR0U7O0lBekdVLG1EQUErRjs7SUFDL0YsaURBQWdDOzs7OztJQUVoQyw2Q0FBb0Q7Ozs7O0lBQ3BELCtDQUFtRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgSW5qZWN0LCBPcHRpb25hbCwgRWxlbWVudFJlZiwgT25EZXN0cm95LCBQTEFURk9STV9JRH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7RE9DVU1FTlQsIGlzUGxhdGZvcm1Ccm93c2VyfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5pbXBvcnQge2V4dGVuZH0gZnJvbSAnQGFzc2Vjby9jb21tb24nO1xyXG5pbXBvcnQge1N1YnNjcmlwdGlvbn0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCAqIGFzIHBvc2l0aW9ucyBmcm9tICdwb3NpdGlvbnMnO1xyXG5cclxuaW1wb3J0IHtCYXNpY1Bvc2l0aW9uZXJPcHRpb25zLCBCYXNpY1Bvc2l0aW9uZXJ9IGZyb20gJy4vYmFzaWNQb3NpdGlvbmVyLmludGVyZmFjZSc7XHJcbmltcG9ydCB7TmdTZWxlY3RQbHVnaW5HZW5lcmljLCBPcHRpb25zR2F0aGVyZXJ9IGZyb20gJy4uLy4uLy4uL21pc2MnO1xyXG5pbXBvcnQge05nU2VsZWN0UGx1Z2luSW5zdGFuY2VzfSBmcm9tICcuLi8uLi8uLi9jb21wb25lbnRzL3NlbGVjdCc7XHJcbmltcG9ydCB7TkdfU0VMRUNUX1BMVUdJTl9JTlNUQU5DRVN9IGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudHMvc2VsZWN0L3R5cGVzJztcclxuaW1wb3J0IHtQT1NJVElPTkVSX09QVElPTlN9IGZyb20gJy4uL3R5cGVzJztcclxuaW1wb3J0IHtQb3B1cH0gZnJvbSAnLi4vLi4vcG9wdXAnO1xyXG5pbXBvcnQge1BPUFVQfSBmcm9tICcuLi8uLi9wb3B1cC90eXBlcyc7XHJcblxyXG4vKipcclxuICogRGVmYXVsdCBvcHRpb25zIGZvciBwb3NpdGlvbmVyXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuY29uc3QgZGVmYXVsdE9wdGlvbnM6IEJhc2ljUG9zaXRpb25lck9wdGlvbnMgPVxyXG57XHJcbiAgICBvcHRpb25zQ29vcmRpbmF0ZXM6ICd0b3AgbGVmdCcsXHJcbiAgICBzZWxlY3RDb29yZGluYXRlczogJ2JvdHRvbSBsZWZ0J1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENvbXBvbmVudCB1c2VkIGZvciBwb3NpdGlvbmluZyBwb3B1cCBlbGVtZW50XHJcbiAqL1xyXG5AQ29tcG9uZW50KFxyXG57XHJcbiAgICBzZWxlY3RvcjogXCJuZy1iYXNpYy1wb3NpdGlvbmVyXCIsXHJcbiAgICB0ZW1wbGF0ZTogJycsXHJcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQmFzaWNQb3NpdGlvbmVyQ29tcG9uZW50IGltcGxlbWVudHMgQmFzaWNQb3NpdGlvbmVyLCBOZ1NlbGVjdFBsdWdpbkdlbmVyaWM8QmFzaWNQb3NpdGlvbmVyT3B0aW9ucz4sIE9uRGVzdHJveVxyXG57XHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHJvdGVjdGVkIGZpZWxkcyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbnN0YW5jZSBvZiBwcmV2aW91cyBvcHRpb25zIGdhdGhlcmVyLCB0aGF0IGlzIHVzZWQgZm9yIG9idGFpbmluZyBhdmFpbGFibGUgb3B0aW9uc1xyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX29wdGlvbnNHYXRoZXJlcjogT3B0aW9uc0dhdGhlcmVyPGFueT47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBPcHRpb25zIGZvciBOZ1NlbGVjdCBwbHVnaW5cclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9vcHRpb25zOiBCYXNpY1Bvc2l0aW9uZXJPcHRpb25zO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaXB0aW9uIGZvciB2aXNpYmlsaXR5IGNoYW5nZSBvZiBwb3B1cFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX3Zpc2liaWxpdHlTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmlwdGlvbiBmb3IgY2hhbmdlcyBvZiBvcHRpb25zIGluIG9wdGlvbnMgZ2F0aGVyZXJcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9vcHRpb25zQ2hhbmdlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQb3B1cCB0aGF0IGlzIGRpc3BsYXllZFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX3BvcHVwOiBQb3B1cDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEh0bWwgZWxlbWVudCBvZiBwb3B1cCBwbHVnaW5cclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9wb3B1cEVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5kaWNhdGlvbiB3aGV0aGVyIGlzIGNvZGUgcnVubmluZyBpbiBicm93c2VyXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfaXNCcm93c2VyOiBib29sZWFuID0gaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5fcGxhdGZvcm1JZCk7XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBwcm9wZXJ0aWVzIC0gaW1wbGVtZW50YXRpb24gb2YgQmFzaWNQb3NpdGlvbmVyICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wdGlvbnMgZm9yIE5nU2VsZWN0IHBsdWdpblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0IG9wdGlvbnMoKTogQmFzaWNQb3NpdGlvbmVyT3B0aW9uc1xyXG4gICAge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHNldCBvcHRpb25zKG9wdGlvbnM6IEJhc2ljUG9zaXRpb25lck9wdGlvbnMpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IGV4dGVuZCh0cnVlLCB0aGlzLl9vcHRpb25zLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhUTUwgZWxlbWVudCB0aGF0IHJlcHJlc2VudHMgc2VsZWN0IGl0c2VsZlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2VsZWN0RWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbnN0YW5jZSBvZiBvcHRpb25zIGdhdGhlcmVyLCB0aGF0IGlzIHVzZWQgZm9yIG9idGFpbmluZyBhdmFpbGFibGUgb3B0aW9uc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3B0aW9uc0dhdGhlcmVyOiBPcHRpb25zR2F0aGVyZXI8YW55PjtcclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgY29uc3RydWN0b3IgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4gICAgY29uc3RydWN0b3IoQEluamVjdChOR19TRUxFQ1RfUExVR0lOX0lOU1RBTkNFUykgQE9wdGlvbmFsKCkgcHVibGljIG5nU2VsZWN0UGx1Z2luczogTmdTZWxlY3RQbHVnaW5JbnN0YW5jZXMsXHJcbiAgICAgICAgICAgICAgICBwdWJsaWMgcGx1Z2luRWxlbWVudDogRWxlbWVudFJlZixcclxuICAgICAgICAgICAgICAgIEBJbmplY3QoUE9TSVRJT05FUl9PUFRJT05TKSBAT3B0aW9uYWwoKSBvcHRpb25zPzogQmFzaWNQb3NpdGlvbmVyT3B0aW9ucyxcclxuICAgICAgICAgICAgICAgIEBJbmplY3QoRE9DVU1FTlQpIHByb3RlY3RlZCBfZG9jdW1lbnQ/OiBIVE1MRG9jdW1lbnQsXHJcbiAgICAgICAgICAgICAgICBASW5qZWN0KFBMQVRGT1JNX0lEKSBwcm90ZWN0ZWQgX3BsYXRmb3JtSWQ/OiBPYmplY3QpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IGV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBwdWJsaWMgbWV0aG9kcyAtIGltcGxlbWVudGF0aW9uIG9mIE9uRGVzdHJveSAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgd2hlbiBjb21wb25lbnQgaXMgZGVzdHJveWVkXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpXHJcbiAgICB7XHJcbiAgICAgICAgaWYodGhpcy5fdmlzaWJpbGl0eVN1YnNjcmlwdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Zpc2liaWxpdHlTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlzaWJpbGl0eVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLl9vcHRpb25zQ2hhbmdlU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uc0NoYW5nZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zQ2hhbmdlU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX2lzQnJvd3NlcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLl9oYW5kbGVSZXNpemVBbmRTY3JvbGwpO1xyXG4gICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5faGFuZGxlUmVzaXplQW5kU2Nyb2xsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBtZXRob2RzIC0gaW1wbGVtZW50YXRpb24gb2YgQmFzaWNQb3NpdGlvbmVyICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIEluaXRpYWxpemUgcGx1Z2luLCB0byBiZSByZWFkeSB0byB1c2UsIGluaXRpYWxpemUgY29tbXVuaWNhdGlvbiB3aXRoIG90aGVyIHBsdWdpbnNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluaXRpYWxpemUoKVxyXG4gICAge1xyXG4gICAgICAgIGlmKHRoaXMuX29wdGlvbnNHYXRoZXJlciAmJiB0aGlzLl9vcHRpb25zR2F0aGVyZXIgIT0gdGhpcy5vcHRpb25zR2F0aGVyZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnNDaGFuZ2VTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uc0dhdGhlcmVyID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKCF0aGlzLl9vcHRpb25zR2F0aGVyZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zR2F0aGVyZXIgPSB0aGlzLm9wdGlvbnNHYXRoZXJlcjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnNDaGFuZ2VTdWJzY3JpcHRpb24gPSB0aGlzLl9vcHRpb25zR2F0aGVyZXIuYXZhaWxhYmxlT3B0aW9uc0NoYW5nZS5zdWJzY3JpYmUoKCkgPT5cclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5fcG9wdXAucG9wdXBFbGVtZW50ICYmIHRoaXMub3B0aW9uc0dhdGhlcmVyLmF2YWlsYWJsZU9wdGlvbnMgJiYgdGhpcy5vcHRpb25zR2F0aGVyZXIuYXZhaWxhYmxlT3B0aW9ucy5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgcG9wdXA6IFBvcHVwID0gdGhpcy5uZ1NlbGVjdFBsdWdpbnNbUE9QVVBdIGFzIFBvcHVwO1xyXG5cclxuICAgICAgICBpZih0aGlzLl9wb3B1cCAmJiB0aGlzLl9wb3B1cCAhPSBwb3B1cClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Zpc2liaWxpdHlTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlzaWJpbGl0eVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZighdGhpcy5fcG9wdXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cCA9IHBvcHVwO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fdmlzaWJpbGl0eVN1YnNjcmlwdGlvbiA9IHRoaXMuX3BvcHVwLnZpc2liaWxpdHlDaGFuZ2Uuc3Vic2NyaWJlKCgpID0+IHRoaXMuX2hhbmRsZVBvc2l0aW9uKCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5faGFuZGxlUG9zaXRpb24oKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEluaXRpYWxpemUgcGx1Z2luIG9wdGlvbnMsIGFsbCBvcGVyYXRpb25zIHJlcXVpcmVkIHRvIGJlIGRvbmUgd2l0aCBwbHVnaW4gb3B0aW9ucyBhcmUgaGFuZGxlZCBoZXJlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbml0T3B0aW9ucygpXHJcbiAgICB7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeHBsaWNpdGx5IHJ1bnMgaW52YWxpZGF0aW9uIG9mIGNvbnRlbnQgKGNoYW5nZSBkZXRlY3Rpb24pXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbnZhbGlkYXRlVmlzdWFscygpOiB2b2lkXHJcbiAgICB7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHByb3RlY3RlZCBtZXRob2RzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIEhhbmRsZXMgcmVzaXplIGFuZCBzY3JvbGwgZXZlbnRcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9oYW5kbGVSZXNpemVBbmRTY3JvbGwgPSAoKSA9PlxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX2NhbGN1bGF0ZVBvc2l0aW9uQW5kRGltZW5zaW9ucygpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEhhbmRsZXMgcG9zaXRpb24gb2YgcG9wdXBcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9oYW5kbGVQb3NpdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gdGhpcy5fcG9wdXAucG9wdXBFbGVtZW50O1xyXG5cclxuICAgICAgICBpZih0aGlzLl9pc0Jyb3dzZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3JlZ2lzdGVyIGV2ZW50cyBhbmQgaGFuZGxlIHBvc2l0aW9uIG9mIG9wZW5lZCBwb3B1cFxyXG4gICAgICAgICAgICBpZih0aGlzLl9wb3B1cEVsZW1lbnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLl9oYW5kbGVSZXNpemVBbmRTY3JvbGwpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuX2hhbmRsZVJlc2l6ZUFuZFNjcm9sbCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZVJlc2l6ZUFuZFNjcm9sbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vdW5yZWdpc3RlciBldmVudHNcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5faGFuZGxlUmVzaXplQW5kU2Nyb2xsKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLl9oYW5kbGVSZXNpemVBbmRTY3JvbGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2FsY3VsYXRlcyBwb3NpdGlvbnMgYW5kIGRpbWVuc2lvbnMgb2YgcG9wdXBcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9jYWxjdWxhdGVQb3NpdGlvbkFuZERpbWVuc2lvbnMoKVxyXG4gICAge1xyXG4gICAgICAgIC8vc2V0IHRvIGRlZmF1bHQgcG9zaXRpb25cclxuICAgICAgICBsZXQgcG9wdXBDb29yZGluYXRlcyA9IHBvc2l0aW9ucyh0aGlzLl9wb3B1cEVsZW1lbnQsIHRoaXMub3B0aW9ucy5vcHRpb25zQ29vcmRpbmF0ZXMsIHRoaXMuc2VsZWN0RWxlbWVudCwgdGhpcy5vcHRpb25zLnNlbGVjdENvb3JkaW5hdGVzKTtcclxuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuc3R5bGUubGVmdCA9IGAke3BvcHVwQ29vcmRpbmF0ZXMubGVmdH1weGA7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LnN0eWxlLnRvcCA9IGAke3BvcHVwQ29vcmRpbmF0ZXMudG9wfXB4YDtcclxuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuc3R5bGUubWF4SGVpZ2h0ID0gJyc7XHJcblxyXG4gICAgICAgIC8vZmxpcCBpZiBjb2xsaXNpb24gd2l0aCB2aWV3cG9ydFxyXG4gICAgICAgIGxldCBvcHRpb25zQ29vcmRpbmF0ZXM6IFBvc2l0aW9ucy5Qb3NpdGlvbnNDb29yZGluYXRlcztcclxuICAgICAgICBsZXQgc2VsZWN0Q29vcmRpbmF0ZXM6IFBvc2l0aW9ucy5Qb3NpdGlvbnNDb29yZGluYXRlcztcclxuICAgICAgICBbcG9wdXBDb29yZGluYXRlcywgb3B0aW9uc0Nvb3JkaW5hdGVzLCBzZWxlY3RDb29yZGluYXRlc10gPSB0aGlzLl9mbGlwSWZDb2xsaXNpb24odGhpcy5fcG9wdXBFbGVtZW50KTtcclxuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuc3R5bGUubGVmdCA9IGAke3BvcHVwQ29vcmRpbmF0ZXMubGVmdH1weGA7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LnN0eWxlLnRvcCA9IGAke3BvcHVwQ29vcmRpbmF0ZXMudG9wfXB4YDtcclxuXHJcbiAgICAgICAgLy9zZXQgbWF4SGVpZ2h0IGlmIHRoZXJlIGlzIG5vdCBtb3JlIHBsYWNlXHJcbiAgICAgICAgdGhpcy5fdXBkYXRlSGVpZ2h0KHRoaXMuX3BvcHVwRWxlbWVudCk7XHJcbiAgICAgICAgcG9wdXBDb29yZGluYXRlcyA9IHBvc2l0aW9ucyh0aGlzLl9wb3B1cEVsZW1lbnQsIG9wdGlvbnNDb29yZGluYXRlcywgdGhpcy5zZWxlY3RFbGVtZW50LCBzZWxlY3RDb29yZGluYXRlcyk7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LnN0eWxlLmxlZnQgPSBgJHtwb3B1cENvb3JkaW5hdGVzLmxlZnR9cHhgO1xyXG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5zdHlsZS50b3AgPSBgJHtwb3B1cENvb3JkaW5hdGVzLnRvcH1weGA7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBVcGRhdGVzIGhlaWdodCBvZiBlbGVtZW50XHJcbiAgICAgKiBAcGFyYW0gcG9wdXBFbGVtZW50IEh0bWwgZWxlbWVudCBmb3IgcG9wdXAgZGl2XHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfdXBkYXRlSGVpZ2h0KHBvcHVwRWxlbWVudDogSFRNTEVsZW1lbnQpOiB2b2lkXHJcbiAgICB7XHJcbiAgICAgICAgbGV0IHJlY3QgPSBwb3B1cEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXHJcbiAgICAgICAgICAgIHNlbGVjdFJlY3QgPSB0aGlzLnNlbGVjdEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXHJcbiAgICAgICAgICAgIGggPSBNYXRoLm1heCh0aGlzLl9kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LCB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgMCk7XHJcblxyXG4gICAgICAgIC8vcG9wdXAgaXMgYWJvdmVcclxuICAgICAgICBpZihyZWN0LnRvcCA8IHNlbGVjdFJlY3QudG9wKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9zcGFjZSBhYm92ZSBpcyBub3QgZW5vdWdoXHJcbiAgICAgICAgICAgIHBvcHVwRWxlbWVudC5zdHlsZS5tYXhIZWlnaHQgPSBgJHtzZWxlY3RSZWN0LnRvcCAtIDZ9cHhgO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL3BvcHVwIGlzIGJlbG93XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9zcGFjZSBiZWxvdyBpcyBub3QgZW5vdWdoXHJcbiAgICAgICAgICAgIHBvcHVwRWxlbWVudC5zdHlsZS5tYXhIZWlnaHQgPSBgJHtoIC0gc2VsZWN0UmVjdC5ib3R0b20gLSA2fXB4YDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGbGlwcyBodG1sIGVsZW1lbnQgcG9zaXRpb24gaWYgY29sbGlzaW9uIG9jY3VyXHJcbiAgICAgKiBAcGFyYW0gcG9wdXBFbGVtZW50IEh0bWwgZWxlbWVudCB0byBiZSBmbGlwcGVkIGlmIGNvbGxpc2lvbnMgb2NjdXJcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9mbGlwSWZDb2xsaXNpb24ocG9wdXBFbGVtZW50OiBIVE1MRWxlbWVudCk6IFtQb3NpdGlvbnMuUG9zaXRpb25zQ3NzLCBQb3NpdGlvbnMuUG9zaXRpb25zQ29vcmRpbmF0ZXMsIFBvc2l0aW9ucy5Qb3NpdGlvbnNDb29yZGluYXRlc11cclxuICAgIHtcclxuICAgICAgICBsZXQgdyA9IE1hdGgubWF4KHRoaXMuX2RvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwgd2luZG93LmlubmVyV2lkdGggfHwgMCksXHJcbiAgICAgICAgICAgIGggPSBNYXRoLm1heCh0aGlzLl9kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LCB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgMCksXHJcbiAgICAgICAgICAgIHJlY3QgPSBwb3B1cEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXHJcbiAgICAgICAgICAgIHNlbGVjdFJlY3QgPSB0aGlzLnNlbGVjdEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXHJcbiAgICAgICAgICAgIHNwYWNlQWJvdmUgPSBzZWxlY3RSZWN0LnRvcCxcclxuICAgICAgICAgICAgc3BhY2VVbmRlciA9IGggLSBzZWxlY3RSZWN0LmJvdHRvbSxcclxuICAgICAgICAgICAgc3BhY2VCZWZvcmUgPSBzZWxlY3RSZWN0LmxlZnQsXHJcbiAgICAgICAgICAgIHNwYWNlQWZ0ZXIgPSB3IC0gc2VsZWN0UmVjdC5yaWdodCxcclxuICAgICAgICAgICAgb3B0aW9uc0Nvb3JkaW5hdGVzID0gdGhpcy5vcHRpb25zLm9wdGlvbnNDb29yZGluYXRlcyxcclxuICAgICAgICAgICAgc2VsZWN0Q29vcmRpbmF0ZXMgPSB0aGlzLm9wdGlvbnMuc2VsZWN0Q29vcmRpbmF0ZXM7XHJcblxyXG4gICAgICAgIC8vdmVydGljYWwgb3ZlcmZsb3dcclxuICAgICAgICBpZigoaCA8IHJlY3QuYm90dG9tICYmXHJcbiAgICAgICAgICAgIHNwYWNlVW5kZXIgPCBzcGFjZUFib3ZlKSB8fFxyXG4gICAgICAgICAgIChyZWN0LnRvcCA8IDAgJiZcclxuICAgICAgICAgICAgc3BhY2VBYm92ZSA8IHNwYWNlVW5kZXIpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgb3B0aW9uc0Nvb3JkaW5hdGVzID0gdGhpcy5fZmxpcFZlcnRpYWNhbChvcHRpb25zQ29vcmRpbmF0ZXMpO1xyXG4gICAgICAgICAgICBzZWxlY3RDb29yZGluYXRlcyA9IHRoaXMuX2ZsaXBWZXJ0aWFjYWwoc2VsZWN0Q29vcmRpbmF0ZXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9ob3Jpem9udGFsIG92ZXJmbG93XHJcbiAgICAgICAgaWYoKHcgPCAocmVjdC5sZWZ0ICsgcmVjdC53aWR0aCkgJiZcclxuICAgICAgICAgICAgc3BhY2VBZnRlciA8IHNwYWNlQmVmb3JlKSB8fFxyXG4gICAgICAgICAgIChyZWN0LmxlZnQgPCAwICYmXHJcbiAgICAgICAgICAgIHNwYWNlQmVmb3JlIDwgc3BhY2VBZnRlcikpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBvcHRpb25zQ29vcmRpbmF0ZXMgPSB0aGlzLl9mbGlwSG9yaXpvbnRhbChvcHRpb25zQ29vcmRpbmF0ZXMpO1xyXG4gICAgICAgICAgICBzZWxlY3RDb29yZGluYXRlcyA9IHRoaXMuX2ZsaXBIb3Jpem9udGFsKHNlbGVjdENvb3JkaW5hdGVzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBbcG9zaXRpb25zKHBvcHVwRWxlbWVudCwgb3B0aW9uc0Nvb3JkaW5hdGVzLCB0aGlzLnNlbGVjdEVsZW1lbnQsIHNlbGVjdENvb3JkaW5hdGVzKSwgb3B0aW9uc0Nvb3JkaW5hdGVzLCBzZWxlY3RDb29yZGluYXRlc107XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGbGlwcyB2ZXJ0aWNhbCBwb3NpdGlvblxyXG4gICAgICogQHBhcmFtIHBvc2l0aW9uIFBvc2l0aW9uIHRvIGJlIGZsaXBwZWQgdmVydGljYWxseVxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX2ZsaXBWZXJ0aWFjYWwocG9zaXRpb246IFBvc2l0aW9ucy5Qb3NpdGlvbnNDb29yZGluYXRlcyk6IFBvc2l0aW9ucy5Qb3NpdGlvbnNDb29yZGluYXRlc1xyXG4gICAge1xyXG4gICAgICAgIGlmKHBvc2l0aW9uLmluZGV4T2YoJ3RvcCcpID49IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb24ucmVwbGFjZSgndG9wJywgJ2JvdHRvbScpIGFzIFBvc2l0aW9ucy5Qb3NpdGlvbnNDb29yZGluYXRlcztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZihwb3NpdGlvbi5pbmRleE9mKCdib3R0b20nKSA+PSAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uLnJlcGxhY2UoJ2JvdHRvbScsICd0b3AnKSBhcyBQb3NpdGlvbnMuUG9zaXRpb25zQ29vcmRpbmF0ZXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcG9zaXRpb247XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGbGlwcyBob3Jpem9udGFsIHBvc2l0aW9uXHJcbiAgICAgKiBAcGFyYW0gcG9zaXRpb24gUG9zaXRpb24gdG8gYmUgZmxpcHBlZCBob3Jpem9udGFsbHlcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9mbGlwSG9yaXpvbnRhbChwb3NpdGlvbjogUG9zaXRpb25zLlBvc2l0aW9uc0Nvb3JkaW5hdGVzKTogUG9zaXRpb25zLlBvc2l0aW9uc0Nvb3JkaW5hdGVzXHJcbiAgICB7XHJcbiAgICAgICAgaWYocG9zaXRpb24uaW5kZXhPZigncmlnaHQnKSA+PSAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uLnJlcGxhY2UoJ3JpZ2h0JywgJ2xlZnQnKSBhcyBQb3NpdGlvbnMuUG9zaXRpb25zQ29vcmRpbmF0ZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYocG9zaXRpb24uaW5kZXhPZignbGVmdCcpID49IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb24ucmVwbGFjZSgnbGVmdCcsICdyaWdodCcpIGFzIFBvc2l0aW9ucy5Qb3NpdGlvbnNDb29yZGluYXRlcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBwb3NpdGlvbjtcclxuICAgIH1cclxufSJdfQ==