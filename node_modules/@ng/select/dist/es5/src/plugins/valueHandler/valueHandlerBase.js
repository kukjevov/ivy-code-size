/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter } from '@angular/core';
import { KEYBOARD_HANDLER } from '../keyboardHandler/types';
import { POPUP } from '../popup/types';
import { NORMAL_STATE } from '../normalState/types';
/**
 * Base class for value handlers
 * @abstract
 * @template TValue, TOptions
 */
var /**
 * Base class for value handlers
 * @abstract
 * @template TValue, TOptions
 */
ValueHandlerBase = /** @class */ (function () {
    //######################### constructor #########################
    function ValueHandlerBase(ngSelectPlugins, pluginElement) {
        var _this = this;
        this.ngSelectPlugins = ngSelectPlugins;
        this.pluginElement = pluginElement;
        /**
         * Occurs when value of NgSelect changes
         */
        this.valueChange = new EventEmitter();
        /**
         * Occurs when there is requested for change of visibility of popup using keyboard
         */
        this.popupVisibilityRequest = new EventEmitter();
        /**
         * Cancels, removes option from selected options
         * @param option Option to be canceled
         */
        this._cancelValue = (/**
         * @param {?} option
         * @return {?}
         */
        function (option) {
            if (Array.isArray(_this.selectedOptions)) {
                /** @type {?} */
                var index = _this.selectedOptions.indexOf(option);
                if (index >= 0) {
                    _this.selectedOptions.splice(index, 1);
                }
            }
            else {
                if (_this.selectedOptions == option) {
                    _this.selectedOptions = null;
                }
            }
            _this._clearSelected();
            _this._markValueAsSelected();
            _this._normalState.invalidateVisuals();
            _this.valueChange.emit();
        });
    }
    Object.defineProperty(ValueHandlerBase.prototype, "value", {
        /**
         * Current selected value of NgSelect
         */
        get: /**
         * Current selected value of NgSelect
         * @return {?}
         */
        function () {
            if (this.selectedOptions) {
                if (Array.isArray(this.selectedOptions)) {
                    return this.selectedOptions.map((/**
                     * @param {?} opt
                     * @return {?}
                     */
                    function (opt) { return opt.value; }));
                }
                else {
                    return this.selectedOptions.value;
                }
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     */
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    ValueHandlerBase.prototype.ngOnDestroy = 
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    function () {
        if (this._optionSelectSubscription) {
            this._optionSelectSubscription.unsubscribe();
            this._optionSelectSubscription = null;
        }
        if (this._optionClickSubscription) {
            this._optionClickSubscription.unsubscribe();
            this._optionClickSubscription = null;
        }
        if (this._optionsChangeSubscription) {
            this._optionsChangeSubscription.unsubscribe();
            this._optionsChangeSubscription = null;
        }
        if (this._cancelOptionSubscription) {
            this._cancelOptionSubscription.unsubscribe();
            this._cancelOptionSubscription = null;
        }
    };
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     */
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     * @return {?}
     */
    ValueHandlerBase.prototype.initialize = /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     * @return {?}
     */
    function () {
        var _this = this;
        if (this._optionsGatherer && this._optionsGatherer != this.optionsGatherer) {
            this._optionsChangeSubscription.unsubscribe();
            this._optionsChangeSubscription = null;
            this._optionsGatherer = null;
        }
        if (!this._optionsGatherer) {
            this._optionsGatherer = this.optionsGatherer;
            this._optionsChangeSubscription = this._optionsGatherer.optionsChange.subscribe((/**
             * @return {?}
             */
            function () { return _this._loadOptions(); }));
        }
        /** @type {?} */
        var keyboardHandler = (/** @type {?} */ (this.ngSelectPlugins[KEYBOARD_HANDLER]));
        if (this._keyboardHandler && this._keyboardHandler != keyboardHandler) {
            this._optionSelectSubscription.unsubscribe();
            this._optionSelectSubscription = null;
            this._keyboardHandler = null;
        }
        if (!this._keyboardHandler) {
            this._keyboardHandler = keyboardHandler;
            this._optionSelectSubscription = this._keyboardHandler.optionSelect.subscribe(this._setValue);
        }
        /** @type {?} */
        var popup = (/** @type {?} */ (this.ngSelectPlugins[POPUP]));
        if (this._popup && this._popup != popup) {
            this._optionClickSubscription.unsubscribe();
            this._optionClickSubscription = null;
            this._popup = null;
        }
        if (!this._popup) {
            this._popup = popup;
            this._optionClickSubscription = this._popup.optionClick.subscribe(this._setValue);
        }
        /** @type {?} */
        var normalState = (/** @type {?} */ (this.ngSelectPlugins[NORMAL_STATE]));
        if (this._normalState && this._normalState != normalState) {
            this._cancelOptionSubscription.unsubscribe();
            this._cancelOptionSubscription = null;
            this._normalState = null;
        }
        if (!this._normalState) {
            this._normalState = normalState;
            this._cancelOptionSubscription = this._normalState.cancelOption.subscribe(this._cancelValue);
        }
        this._loadOptions();
    };
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     */
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    ValueHandlerBase.prototype.initOptions = /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    function () {
    };
    /**
     * Explicitly runs invalidation of content (change detection)
     */
    /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    ValueHandlerBase.prototype.invalidateVisuals = /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    function () {
    };
    /**
     * Clears all selected values
     */
    /**
     * Clears all selected values
     * @protected
     * @return {?}
     */
    ValueHandlerBase.prototype._clearSelected = /**
     * Clears all selected values
     * @protected
     * @return {?}
     */
    function () {
        this._optionsGatherer.options.forEach((/**
         * @param {?} option
         * @return {?}
         */
        function (option) { return option.selected = false; }));
    };
    /**
     * Marks current value as selected
     */
    /**
     * Marks current value as selected
     * @protected
     * @return {?}
     */
    ValueHandlerBase.prototype._markValueAsSelected = /**
     * Marks current value as selected
     * @protected
     * @return {?}
     */
    function () {
        if (this.selectedOptions) {
            if (Array.isArray(this.selectedOptions)) {
                this.selectedOptions.forEach((/**
                 * @param {?} option
                 * @return {?}
                 */
                function (option) { return option.selected = true; }));
            }
            else {
                ((/** @type {?} */ (this.selectedOptions))).selected = true;
            }
        }
    };
    return ValueHandlerBase;
}());
/**
 * Base class for value handlers
 * @abstract
 * @template TValue, TOptions
 */
export { ValueHandlerBase };
if (false) {
    /**
     * Options for NgSelect plugin
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._options;
    /**
     * Keyboard handler that is used
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._keyboardHandler;
    /**
     * Popup that is used
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._popup;
    /**
     * Normal state that is used
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._normalState;
    /**
     * Subscription for option selection using keyboard
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._optionSelectSubscription;
    /**
     * Subscription for option selection using mouse
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._optionClickSubscription;
    /**
     * Subscription for changes of options in options gatherer
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._optionsChangeSubscription;
    /**
     * Subscription for canceling an option
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._cancelOptionSubscription;
    /**
     * Instance of previous options gatherer, that is used for obtaining available options
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._optionsGatherer;
    /**
     * Options for NgSelect plugin
     * @type {?}
     */
    ValueHandlerBase.prototype.options;
    /**
     * Occurs when value of NgSelect changes
     * @type {?}
     */
    ValueHandlerBase.prototype.valueChange;
    /**
     * Instance of options gatherer, that is used for obtaining available options
     * @type {?}
     */
    ValueHandlerBase.prototype.optionsGatherer;
    /**
     * Function of value comparer that is used for comparison of values
     * @type {?}
     */
    ValueHandlerBase.prototype.valueComparer;
    /**
     * Occurs when there is requested for change of visibility of popup using keyboard
     * @type {?}
     */
    ValueHandlerBase.prototype.popupVisibilityRequest;
    /**
     * Current value of NgSelect
     * @type {?}
     */
    ValueHandlerBase.prototype.selectedOptions;
    /**
     * Sets value
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._setValue;
    /**
     * Cancels, removes option from selected options
     * \@param option Option to be canceled
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._cancelValue;
    /** @type {?} */
    ValueHandlerBase.prototype.ngSelectPlugins;
    /** @type {?} */
    ValueHandlerBase.prototype.pluginElement;
    /**
     * Sets value for NgSelect
     * @abstract
     * @param {?} value Value to be set
     * @return {?}
     */
    ValueHandlerBase.prototype.setValue = function (value) { };
    /**
     * Loads options
     * @abstract
     * @protected
     * @return {?}
     */
    ValueHandlerBase.prototype._loadOptions = function () { };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsdWVIYW5kbGVyQmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9wbHVnaW5zL3ZhbHVlSGFuZGxlci92YWx1ZUhhbmRsZXJCYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWEsWUFBWSxFQUFZLE1BQU0sZUFBZSxDQUFDO0FBTWxFLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBRTFELE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUdyQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sc0JBQXNCLENBQUM7Ozs7OztBQU1sRDs7Ozs7O0lBcUdJLGlFQUFpRTtJQUNqRSwwQkFBbUIsZUFBd0MsRUFDeEMsYUFBeUI7UUFENUMsaUJBR0M7UUFIa0Isb0JBQWUsR0FBZixlQUFlLENBQXlCO1FBQ3hDLGtCQUFhLEdBQWIsYUFBYSxDQUFZOzs7O1FBNUNyQyxnQkFBVyxHQUF1QixJQUFJLFlBQVksRUFBUSxDQUFDOzs7O1FBZTNELDJCQUFzQixHQUEwQixJQUFJLFlBQVksRUFBVyxDQUFDOzs7OztRQTRLekUsaUJBQVk7Ozs7UUFBRyxVQUFDLE1BQStCO1lBRXJELElBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFJLENBQUMsZUFBZSxDQUFDLEVBQ3RDOztvQkFDUSxLQUFLLEdBQUcsS0FBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO2dCQUVoRCxJQUFHLEtBQUssSUFBSSxDQUFDLEVBQ2I7b0JBQ0ksS0FBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2lCQUN6QzthQUNKO2lCQUVEO2dCQUNJLElBQUcsS0FBSSxDQUFDLGVBQWUsSUFBSSxNQUFNLEVBQ2pDO29CQUNJLEtBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO2lCQUMvQjthQUNKO1lBRUQsS0FB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QUtsQyx1Q0FBa0U7Ozs7O0lBS2xFLDJDQUFnRDs7Ozs7SUFLaEQseUNBQStDOzs7OztJQUsvQyxrREFBbUY7Ozs7O0lBS25GLDJDQUF3RTs7Ozs7O0lBaUt4RSxxQ0FBd0U7Ozs7Ozs7SUFNeEUsd0NBd0JDOztJQXhLVywyQ0FBK0M7O0lBQy9DLHlDQUFnQzs7Ozs7OztJQTBDNUMsMkRBQXNEOzs7Ozs7O0lBNEp0RCwwREFBd0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0VsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgT25EZXN0cm95fSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtTdWJzY3JpcHRpb259IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHtOZ1NlbGVjdFBsdWdpbkdlbmVyaWMsIE9wdGlvbnNHYXRoZXJlciwgQ29tcGFyZVZhbHVlRnVuY30gZnJvbSAnLi4vLi4vbWlzYyc7XHJcbmltcG9ydCB7TmdTZWxlY3RQbHVnaW5JbnN0YW5jZXN9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvc2VsZWN0JztcclxuaW1wb3J0IHtLZXlib2FyZEhhbmRsZXJ9IGZyb20gJy4uL2tleWJvYXJkSGFuZGxlcic7XHJcbmltcG9ydCB7S0VZQk9BUkRfSEFORExFUn0gZnJvbSAnLi4va2V5Ym9hcmRIYW5kbGVyL3R5cGVzJztcclxuaW1wb3J0IHtQb3B1cH0gZnJvbSAnLi4vcG9wdXAnO1xyXG5pbXBvcnQge1BPUFVQfSBmcm9tICcuLi9wb3B1cC90eXBlcyc7XHJcbmltcG9ydCB7ybVOZ1NlbGVjdE9wdGlvbiwgTmdTZWxlY3RPcHRpb259IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvb3B0aW9uJztcclxuaW1wb3J0IHtOb3JtYWxTdGF0ZX0gZnJvbSAnLi4vbm9ybWFsU3RhdGUnO1xyXG5pbXBvcnQge05PUk1BTF9TVEFURX0gZnJvbSAnLi4vbm9ybWFsU3RhdGUvdHlwZXMnO1xyXG5pbXBvcnQge1ZhbHVlSGFuZGxlciwgVmFsdWVIYW5kbGVyT3B0aW9uc30gZnJvbSAnLi92YWx1ZUhhbmRsZXIuaW50ZXJmYWNlJztcclxuXHJcbi8qKlxyXG4gKiBCYXNlIGNsYXNzIGZvciB2YWx1ZSBoYW5kbGVyc1xyXG4gKi9cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFZhbHVlSGFuZGxlckJhc2U8VFZhbHVlLCBUT3B0aW9ucyBleHRlbmRzIFZhbHVlSGFuZGxlck9wdGlvbnM+IGltcGxlbWVudHMgVmFsdWVIYW5kbGVyPFRWYWx1ZT4sIE5nU2VsZWN0UGx1Z2luR2VuZXJpYzxUT3B0aW9ucz4sIE9uRGVzdHJveVxyXG57XHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHJvdGVjdGVkIGZpZWxkcyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBPcHRpb25zIGZvciBOZ1NlbGVjdCBwbHVnaW5cclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9vcHRpb25zOiBUT3B0aW9ucztcclxuXHJcbiAgICAvKipcclxuICAgICAqIEtleWJvYXJkIGhhbmRsZXIgdGhhdCBpcyB1c2VkXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfa2V5Ym9hcmRIYW5kbGVyOiBLZXlib2FyZEhhbmRsZXI7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQb3B1cCB0aGF0IGlzIHVzZWRcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9wb3B1cDogUG9wdXA7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBOb3JtYWwgc3RhdGUgdGhhdCBpcyB1c2VkXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfbm9ybWFsU3RhdGU6IE5vcm1hbFN0YXRlO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaXB0aW9uIGZvciBvcHRpb24gc2VsZWN0aW9uIHVzaW5nIGtleWJvYXJkXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfb3B0aW9uU2VsZWN0U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpcHRpb24gZm9yIG9wdGlvbiBzZWxlY3Rpb24gdXNpbmcgbW91c2VcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9vcHRpb25DbGlja1N1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaXB0aW9uIGZvciBjaGFuZ2VzIG9mIG9wdGlvbnMgaW4gb3B0aW9ucyBnYXRoZXJlclxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX29wdGlvbnNDaGFuZ2VTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmlwdGlvbiBmb3IgY2FuY2VsaW5nIGFuIG9wdGlvblxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX2NhbmNlbE9wdGlvblN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5zdGFuY2Ugb2YgcHJldmlvdXMgb3B0aW9ucyBnYXRoZXJlciwgdGhhdCBpcyB1c2VkIGZvciBvYnRhaW5pbmcgYXZhaWxhYmxlIG9wdGlvbnNcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9vcHRpb25zR2F0aGVyZXI6IE9wdGlvbnNHYXRoZXJlcjxUVmFsdWU+O1xyXG5cclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBwdWJsaWMgcHJvcGVydGllcyAtIGltcGxlbWVudGF0aW9uIG9mIER5bmFtaWNWYWx1ZUhhbmRsZXIgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogT3B0aW9ucyBmb3IgTmdTZWxlY3QgcGx1Z2luXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhYnN0cmFjdCBvcHRpb25zOiBUT3B0aW9ucztcclxuXHJcbiAgICAvKipcclxuICAgICAqIE9jY3VycyB3aGVuIHZhbHVlIG9mIE5nU2VsZWN0IGNoYW5nZXNcclxuICAgICAqL1xyXG4gICAgcHVibGljIHZhbHVlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbnN0YW5jZSBvZiBvcHRpb25zIGdhdGhlcmVyLCB0aGF0IGlzIHVzZWQgZm9yIG9idGFpbmluZyBhdmFpbGFibGUgb3B0aW9uc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3B0aW9uc0dhdGhlcmVyOiBPcHRpb25zR2F0aGVyZXI8VFZhbHVlPjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEZ1bmN0aW9uIG9mIHZhbHVlIGNvbXBhcmVyIHRoYXQgaXMgdXNlZCBmb3IgY29tcGFyaXNvbiBvZiB2YWx1ZXNcclxuICAgICAqL1xyXG4gICAgcHVibGljIHZhbHVlQ29tcGFyZXI6IENvbXBhcmVWYWx1ZUZ1bmM8VFZhbHVlPjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIE9jY3VycyB3aGVuIHRoZXJlIGlzIHJlcXVlc3RlZCBmb3IgY2hhbmdlIG9mIHZpc2liaWxpdHkgb2YgcG9wdXAgdXNpbmcga2V5Ym9hcmRcclxuICAgICAqL1xyXG4gICAgcHVibGljIHBvcHVwVmlzaWJpbGl0eVJlcXVlc3Q6IEV2ZW50RW1pdHRlcjxib29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEN1cnJlbnQgdmFsdWUgb2YgTmdTZWxlY3RcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNlbGVjdGVkT3B0aW9uczogTmdTZWxlY3RPcHRpb248VFZhbHVlPnxOZ1NlbGVjdE9wdGlvbjxUVmFsdWU+W107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDdXJyZW50IHNlbGVjdGVkIHZhbHVlIG9mIE5nU2VsZWN0XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXQgdmFsdWUoKTogVFZhbHVlfFRWYWx1ZVtdXHJcbiAgICB7XHJcbiAgICAgICAgaWYodGhpcy5zZWxlY3RlZE9wdGlvbnMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KHRoaXMuc2VsZWN0ZWRPcHRpb25zKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRPcHRpb25zLm1hcChvcHQgPT4gb3B0LnZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkT3B0aW9ucy52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIGNvbnN0cnVjdG9yICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBuZ1NlbGVjdFBsdWdpbnM6IE5nU2VsZWN0UGx1Z2luSW5zdGFuY2VzLFxyXG4gICAgICAgICAgICAgICAgcHVibGljIHBsdWdpbkVsZW1lbnQ6IEVsZW1lbnRSZWYpXHJcbiAgICB7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBtZXRob2RzIC0gaW1wbGVtZW50YXRpb24gb2YgT25EZXN0cm95ICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgd2hlbiBjb21wb25lbnQgaXMgZGVzdHJveWVkXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpXHJcbiAgICB7XHJcbiAgICAgICAgaWYodGhpcy5fb3B0aW9uU2VsZWN0U3Vic2NyaXB0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uU2VsZWN0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvblNlbGVjdFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLl9vcHRpb25DbGlja1N1YnNjcmlwdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbkNsaWNrU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbkNsaWNrU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX29wdGlvbnNDaGFuZ2VTdWJzY3JpcHRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnNDaGFuZ2VTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5fY2FuY2VsT3B0aW9uU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fY2FuY2VsT3B0aW9uU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbmNlbE9wdGlvblN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBwdWJsaWMgbWV0aG9kcyAtIGltcGxlbWVudGF0aW9uIG9mIER5bmFtaWNWYWx1ZUhhbmRsZXIgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU2V0cyB2YWx1ZSBmb3IgTmdTZWxlY3RcclxuICAgICAqIEBwYXJhbSB2YWx1ZSBWYWx1ZSB0byBiZSBzZXRcclxuICAgICAqL1xyXG4gICAgcHVibGljIGFic3RyYWN0IHNldFZhbHVlKHZhbHVlOlRWYWx1ZXxUVmFsdWVbXSk6IHZvaWQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbml0aWFsaXplIHBsdWdpbiwgdG8gYmUgcmVhZHkgdG8gdXNlLCBpbml0aWFsaXplIGNvbW11bmljYXRpb24gd2l0aCBvdGhlciBwbHVnaW5zXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbml0aWFsaXplKClcclxuICAgIHtcclxuICAgICAgICBpZih0aGlzLl9vcHRpb25zR2F0aGVyZXIgJiYgdGhpcy5fb3B0aW9uc0dhdGhlcmVyICE9IHRoaXMub3B0aW9uc0dhdGhlcmVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uc0NoYW5nZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zQ2hhbmdlU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnNHYXRoZXJlciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZighdGhpcy5fb3B0aW9uc0dhdGhlcmVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uc0dhdGhlcmVyID0gdGhpcy5vcHRpb25zR2F0aGVyZXI7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zQ2hhbmdlU3Vic2NyaXB0aW9uID0gdGhpcy5fb3B0aW9uc0dhdGhlcmVyLm9wdGlvbnNDaGFuZ2Uuc3Vic2NyaWJlKCgpID0+IHRoaXMuX2xvYWRPcHRpb25zKCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGtleWJvYXJkSGFuZGxlciA9IHRoaXMubmdTZWxlY3RQbHVnaW5zW0tFWUJPQVJEX0hBTkRMRVJdIGFzIEtleWJvYXJkSGFuZGxlcjtcclxuXHJcbiAgICAgICAgaWYodGhpcy5fa2V5Ym9hcmRIYW5kbGVyICYmIHRoaXMuX2tleWJvYXJkSGFuZGxlciAhPSBrZXlib2FyZEhhbmRsZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25TZWxlY3RTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uU2VsZWN0U3Vic2NyaXB0aW9uID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX2tleWJvYXJkSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZighdGhpcy5fa2V5Ym9hcmRIYW5kbGVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fa2V5Ym9hcmRIYW5kbGVyID0ga2V5Ym9hcmRIYW5kbGVyO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uU2VsZWN0U3Vic2NyaXB0aW9uID0gdGhpcy5fa2V5Ym9hcmRIYW5kbGVyLm9wdGlvblNlbGVjdC5zdWJzY3JpYmUodGhpcy5fc2V0VmFsdWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHBvcHVwID0gdGhpcy5uZ1NlbGVjdFBsdWdpbnNbUE9QVVBdIGFzIFBvcHVwO1xyXG5cclxuICAgICAgICBpZih0aGlzLl9wb3B1cCAmJiB0aGlzLl9wb3B1cCAhPSBwb3B1cClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbkNsaWNrU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbkNsaWNrU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHVwID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKCF0aGlzLl9wb3B1cClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHVwID0gcG9wdXA7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25DbGlja1N1YnNjcmlwdGlvbiA9IHRoaXMuX3BvcHVwLm9wdGlvbkNsaWNrLnN1YnNjcmliZSh0aGlzLl9zZXRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgbm9ybWFsU3RhdGUgPSB0aGlzLm5nU2VsZWN0UGx1Z2luc1tOT1JNQUxfU1RBVEVdIGFzIE5vcm1hbFN0YXRlO1xyXG5cclxuICAgICAgICBpZih0aGlzLl9ub3JtYWxTdGF0ZSAmJiB0aGlzLl9ub3JtYWxTdGF0ZSAhPSBub3JtYWxTdGF0ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbmNlbE9wdGlvblN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9jYW5jZWxPcHRpb25TdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fbm9ybWFsU3RhdGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoIXRoaXMuX25vcm1hbFN0YXRlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fbm9ybWFsU3RhdGUgPSBub3JtYWxTdGF0ZTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX2NhbmNlbE9wdGlvblN1YnNjcmlwdGlvbiA9IHRoaXMuX25vcm1hbFN0YXRlLmNhbmNlbE9wdGlvbi5zdWJzY3JpYmUodGhpcy5fY2FuY2VsVmFsdWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fbG9hZE9wdGlvbnMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEluaXRpYWxpemUgcGx1Z2luIG9wdGlvbnMsIGFsbCBvcGVyYXRpb25zIHJlcXVpcmVkIHRvIGJlIGRvbmUgd2l0aCBwbHVnaW4gb3B0aW9ucyBhcmUgaGFuZGxlZCBoZXJlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbml0T3B0aW9ucygpXHJcbiAgICB7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeHBsaWNpdGx5IHJ1bnMgaW52YWxpZGF0aW9uIG9mIGNvbnRlbnQgKGNoYW5nZSBkZXRlY3Rpb24pXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbnZhbGlkYXRlVmlzdWFscygpOiB2b2lkXHJcbiAgICB7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHByb3RlY3RlZCBtZXRob2RzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldHMgdmFsdWUgXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBhYnN0cmFjdCBfc2V0VmFsdWU6IChvcHRpb246IMm1TmdTZWxlY3RPcHRpb248VFZhbHVlPikgPT4gdm9pZDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIENhbmNlbHMsIHJlbW92ZXMgb3B0aW9uIGZyb20gc2VsZWN0ZWQgb3B0aW9uc1xyXG4gICAgICogQHBhcmFtIG9wdGlvbiBPcHRpb24gdG8gYmUgY2FuY2VsZWRcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9jYW5jZWxWYWx1ZSA9IChvcHRpb246IMm1TmdTZWxlY3RPcHRpb248VFZhbHVlPik6IHZvaWQgPT5cclxuICAgIHtcclxuICAgICAgICBpZihBcnJheS5pc0FycmF5KHRoaXMuc2VsZWN0ZWRPcHRpb25zKSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxldCBpbmRleCA9IHRoaXMuc2VsZWN0ZWRPcHRpb25zLmluZGV4T2Yob3B0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIGlmKGluZGV4ID49IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZE9wdGlvbnMgPT0gb3B0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucyA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2NsZWFyU2VsZWN0ZWQoKTtcclxuICAgICAgICB0aGlzLl9tYXJrVmFsdWVBc1NlbGVjdGVkKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX25vcm1hbFN0YXRlLmludmFsaWRhdGVWaXN1YWxzKCk7XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDbGVhcnMgYWxsIHNlbGVjdGVkIHZhbHVlc1xyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX2NsZWFyU2VsZWN0ZWQoKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX29wdGlvbnNHYXRoZXJlci5vcHRpb25zLmZvckVhY2goKG9wdGlvbjogybVOZ1NlbGVjdE9wdGlvbjxUVmFsdWU+KSA9PiBvcHRpb24uc2VsZWN0ZWQgPSBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNYXJrcyBjdXJyZW50IHZhbHVlIGFzIHNlbGVjdGVkXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfbWFya1ZhbHVlQXNTZWxlY3RlZCgpXHJcbiAgICB7XHJcbiAgICAgICAgaWYodGhpcy5zZWxlY3RlZE9wdGlvbnMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KHRoaXMuc2VsZWN0ZWRPcHRpb25zKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMuZm9yRWFjaCgob3B0aW9uOiDJtU5nU2VsZWN0T3B0aW9uPFRWYWx1ZT4pID0+IG9wdGlvbi5zZWxlY3RlZCA9IHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgKHRoaXMuc2VsZWN0ZWRPcHRpb25zIGFzIMm1TmdTZWxlY3RPcHRpb248VFZhbHVlPikuc2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTG9hZHMgb3B0aW9uc1xyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgX2xvYWRPcHRpb25zKCk6IHZvaWQ7XHJcbn0iXX0=