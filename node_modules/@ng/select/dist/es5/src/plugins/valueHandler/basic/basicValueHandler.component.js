var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ChangeDetectionStrategy, Inject, Optional, ElementRef } from '@angular/core';
import { extend, isBlank } from '@asseco/common';
import { NG_SELECT_PLUGIN_INSTANCES } from '../../../components/select/types';
import { VALUE_HANDLER_OPTIONS } from '../types';
import { ValueHandlerBase } from '../valueHandlerBase';
/**
 * Default options for value handler
 * \@internal
 * @type {?}
 */
var defaultOptions = {};
/**
 * Component used for handling current value of NgSelect
 * @template TValue
 */
var BasicValueHandlerComponent = /** @class */ (function (_super) {
    __extends(BasicValueHandlerComponent, _super);
    //######################### constructor #########################
    function BasicValueHandlerComponent(ngSelectPlugins, pluginElement, options) {
        var _this = _super.call(this, ngSelectPlugins, pluginElement) || this;
        //######################### protected methods #########################
        /**
         * Sets value
         */
        _this._setValue = (/**
         * @param {?} option
         * @return {?}
         */
        function (option) {
            //multiple values are allowed
            if (_this.options.multiple) {
                if (!Array.isArray(_this.selectedOptions)) {
                    _this.selectedOptions = [];
                }
                if (Array.isArray(_this.selectedOptions)) {
                    /** @type {?} */
                    var index = void 0;
                    //value exists, removing from list
                    if ((index = _this.selectedOptions.indexOf(option)) >= 0) {
                        _this.selectedOptions.splice(index, 1);
                    }
                    //adding value
                    else {
                        _this.selectedOptions.push(option);
                    }
                    _this.selectedOptions = _this.selectedOptions.slice();
                }
            }
            else 
            //only signle value allowed
            {
                _this.selectedOptions = option;
            }
            _this._clearSelected();
            _this._markValueAsSelected();
            _this._normalState.invalidateVisuals();
            _this.valueChange.emit();
            //close popup if not multiple
            if (!_this.options.multiple) {
                _this.popupVisibilityRequest.emit(false);
            }
            else {
                _this._popup.invalidateVisuals();
            }
        });
        _this._options = extend(true, {}, defaultOptions, options);
        return _this;
    }
    Object.defineProperty(BasicValueHandlerComponent.prototype, "options", {
        //######################### public properties - implementation of BasicValueHandler #########################
        /**
         * Options for NgSelect plugin
         */
        get: 
        //######################### public properties - implementation of BasicValueHandler #########################
        /**
         * Options for NgSelect plugin
         * @return {?}
         */
        function () {
            return this._options;
        },
        set: /**
         * @param {?} options
         * @return {?}
         */
        function (options) {
            this._options = extend(true, this._options, options);
        },
        enumerable: true,
        configurable: true
    });
    //######################### public methods - implementation of BasicValueHandler #########################
    /**
     * Sets value for NgSelect
     * @param value Value to be set
     */
    //######################### public methods - implementation of BasicValueHandler #########################
    /**
     * Sets value for NgSelect
     * @param {?} value Value to be set
     * @return {?}
     */
    BasicValueHandlerComponent.prototype.setValue = 
    //######################### public methods - implementation of BasicValueHandler #########################
    /**
     * Sets value for NgSelect
     * @param {?} value Value to be set
     * @return {?}
     */
    function (value) {
        this._useOptionsAsValue(value);
    };
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     */
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    BasicValueHandlerComponent.prototype.initOptions = /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    function () {
    };
    /**
     * Explicitly runs invalidation of content (change detection)
     */
    /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    BasicValueHandlerComponent.prototype.invalidateVisuals = /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    function () {
    };
    /**
     * Loads options
     */
    /**
     * Loads options
     * @protected
     * @return {?}
     */
    BasicValueHandlerComponent.prototype._loadOptions = /**
     * Loads options
     * @protected
     * @return {?}
     */
    function () {
        this._useOptionsAsValue(isBlank(this._unmappedValue) ? this.value : this._unmappedValue);
    };
    /**
     * Converts value to options
     * @param value Value to be changed to options
     */
    /**
     * Converts value to options
     * @protected
     * @param {?} value Value to be changed to options
     * @return {?}
     */
    BasicValueHandlerComponent.prototype._useOptionsAsValue = /**
     * Converts value to options
     * @protected
     * @param {?} value Value to be changed to options
     * @return {?}
     */
    function (value) {
        var _this = this;
        //set empty value
        if (isBlank(value) || (Array.isArray(value) && !value.length)) {
            this.selectedOptions = value;
            this._clearSelected();
            this._unmappedValue = null;
            this._normalState.invalidateVisuals();
            this.valueChange.emit();
            return;
        }
        //no options available yet
        if (!this.optionsGatherer.options || !this.optionsGatherer.options.length) {
            this._unmappedValue = value;
            return;
        }
        if (this.options.multiple) {
            if (Array.isArray(value)) {
                /** @type {?} */
                var items_1 = value;
                this.selectedOptions = this.optionsGatherer.options.filter((/**
                 * @param {?} itm
                 * @return {?}
                 */
                function (itm) { return !!items_1.find((/**
                 * @param {?} it
                 * @return {?}
                 */
                function (it) { return _this.valueComparer(it, itm.value); })); }));
            }
            else {
                throw new Error('Don`t you have redundant "multiple"?');
            }
        }
        else {
            if (Array.isArray(value)) {
                throw new Error('Are you missing attribute "multiple"?');
            }
            else {
                /** @type {?} */
                var item_1 = value;
                this.selectedOptions = this.optionsGatherer.options.find((/**
                 * @param {?} itm
                 * @return {?}
                 */
                function (itm) { return _this.valueComparer(itm.value, item_1); }));
            }
        }
        this._clearSelected();
        this._markValueAsSelected();
        this._unmappedValue = null;
        this._normalState.invalidateVisuals();
        this.valueChange.emit();
    };
    BasicValueHandlerComponent.decorators = [
        { type: Component, args: [{
                    selector: "ng-basic-value-handler",
                    template: '',
                    changeDetection: ChangeDetectionStrategy.OnPush
                }] }
    ];
    /** @nocollapse */
    BasicValueHandlerComponent.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [NG_SELECT_PLUGIN_INSTANCES,] }, { type: Optional }] },
        { type: ElementRef },
        { type: undefined, decorators: [{ type: Inject, args: [VALUE_HANDLER_OPTIONS,] }, { type: Optional }] }
    ]; };
    return BasicValueHandlerComponent;
}(ValueHandlerBase));
export { BasicValueHandlerComponent };
if (false) {
    /**
     * Backed up unmapped value that was set before options were obtained
     * @type {?}
     * @protected
     */
    BasicValueHandlerComponent.prototype._unmappedValue;
    /**
     * Sets value
     * @type {?}
     * @protected
     */
    BasicValueHandlerComponent.prototype._setValue;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzaWNWYWx1ZUhhbmRsZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3BsdWdpbnMvdmFsdWVIYW5kbGVyL2Jhc2ljL2Jhc2ljVmFsdWVIYW5kbGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDL0YsT0FBTyxFQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUkvQyxPQUFPLEVBQUMsMEJBQTBCLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQztBQUM1RSxPQUFPLEVBQUMscUJBQXFCLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFFL0MsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0scUJBQXFCLENBQUM7Ozs7OztJQU0vQyxjQUFjLEdBQ3BCLEVBQ0M7Ozs7O0FBS0Q7SUFNd0QsOENBQWtEO0lBdUJ0RyxpRUFBaUU7SUFDakUsb0NBQTRELGVBQXdDLEVBQ3hGLGFBQXlCLEVBQ2tCLE9BQWtDO1FBRnpGLFlBSUksa0JBQU0sZUFBZSxFQUFFLGFBQWEsQ0FBQyxTQUd4Qzs7Ozs7UUFnQ1MsZUFBUzs7OztRQUFHLFVBQUMsTUFBK0I7WUFFbEQsNkJBQTZCO1lBQzdCLElBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQ3hCO2dCQUNJLElBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUksQ0FBQyxlQUFlLENBQUMsRUFDdkM7b0JBQ0ksS0FBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7aUJBQzdCO2dCQUVELElBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFJLENBQUMsZUFBZSxDQUFDLEVBQ3RDOzt3QkFDUSxLQUFLLFNBQVE7b0JBRWpCLGtDQUFr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Q0FBQztRQUM1QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztRQUMzQixJQUFJLENBQUMsWUFBWSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDdEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUM1QixDQUFDOztnQkEzTEosU0FBUyxTQUNWO29CQUNJLFFBQVEsRUFBRSx3QkFBd0I7b0JBQ2xDLFFBQVEsRUFBRSxFQUFFO29CQUNaLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2lCQUNsRDs7OztnREF5QmdCLE1BQU0sU0FBQywwQkFBMEIsY0FBRyxRQUFRO2dCQW5EQyxVQUFVO2dEQXFEdkQsTUFBTSxTQUFDLHFCQUFxQixjQUFHLFFBQVE7O0lBNEp4RCxpQ0FBQztDQUFBLEFBNUxELENBTXdELGdCQUFnQixHQXNMdkU7U0F0TFksMEJBQTBCOzs7Ozs7O0lBT25DLG9EQUEwQzs7Ozs7O0lBd0QxQywrQ0FpREMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIEluamVjdCwgT3B0aW9uYWwsIEVsZW1lbnRSZWZ9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge2V4dGVuZCwgaXNCbGFua30gZnJvbSAnQGFzc2Vjby9jb21tb24nO1xyXG5cclxuaW1wb3J0IHtCYXNpY1ZhbHVlSGFuZGxlck9wdGlvbnMsIEJhc2ljVmFsdWVIYW5kbGVyfSBmcm9tICcuL2Jhc2ljVmFsdWVIYW5kbGVyLmludGVyZmFjZSc7XHJcbmltcG9ydCB7TmdTZWxlY3RQbHVnaW5JbnN0YW5jZXN9IGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudHMvc2VsZWN0JztcclxuaW1wb3J0IHtOR19TRUxFQ1RfUExVR0lOX0lOU1RBTkNFU30gZnJvbSAnLi4vLi4vLi4vY29tcG9uZW50cy9zZWxlY3QvdHlwZXMnO1xyXG5pbXBvcnQge1ZBTFVFX0hBTkRMRVJfT1BUSU9OU30gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQge8m1TmdTZWxlY3RPcHRpb24sIH0gZnJvbSAnLi4vLi4vLi4vY29tcG9uZW50cy9vcHRpb24nO1xyXG5pbXBvcnQge1ZhbHVlSGFuZGxlckJhc2V9IGZyb20gJy4uL3ZhbHVlSGFuZGxlckJhc2UnO1xyXG5cclxuLyoqXHJcbiAqIERlZmF1bHQgb3B0aW9ucyBmb3IgdmFsdWUgaGFuZGxlclxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNvbnN0IGRlZmF1bHRPcHRpb25zOiBCYXNpY1ZhbHVlSGFuZGxlck9wdGlvbnMgPVxyXG57XHJcbn07XHJcblxyXG4vKipcclxuICogQ29tcG9uZW50IHVzZWQgZm9yIGhhbmRsaW5nIGN1cnJlbnQgdmFsdWUgb2YgTmdTZWxlY3RcclxuICovXHJcbkBDb21wb25lbnQoXHJcbntcclxuICAgIHNlbGVjdG9yOiBcIm5nLWJhc2ljLXZhbHVlLWhhbmRsZXJcIixcclxuICAgIHRlbXBsYXRlOiAnJyxcclxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBCYXNpY1ZhbHVlSGFuZGxlckNvbXBvbmVudDxUVmFsdWU+IGV4dGVuZHMgVmFsdWVIYW5kbGVyQmFzZTxUVmFsdWUsIEJhc2ljVmFsdWVIYW5kbGVyT3B0aW9ucz4gaW1wbGVtZW50cyBCYXNpY1ZhbHVlSGFuZGxlcjxUVmFsdWU+XHJcbntcclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBwcm90ZWN0ZWQgZmllbGRzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIEJhY2tlZCB1cCB1bm1hcHBlZCB2YWx1ZSB0aGF0IHdhcyBzZXQgYmVmb3JlIG9wdGlvbnMgd2VyZSBvYnRhaW5lZFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX3VubWFwcGVkVmFsdWU6IFRWYWx1ZXxUVmFsdWVbXTtcclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHVibGljIHByb3BlcnRpZXMgLSBpbXBsZW1lbnRhdGlvbiBvZiBCYXNpY1ZhbHVlSGFuZGxlciAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBPcHRpb25zIGZvciBOZ1NlbGVjdCBwbHVnaW5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldCBvcHRpb25zKCk6IEJhc2ljVmFsdWVIYW5kbGVyT3B0aW9uc1xyXG4gICAge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHNldCBvcHRpb25zKG9wdGlvbnM6IEJhc2ljVmFsdWVIYW5kbGVyT3B0aW9ucylcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9vcHRpb25zID0gZXh0ZW5kKHRydWUsIHRoaXMuX29wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBjb25zdHJ1Y3RvciAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbiAgICBjb25zdHJ1Y3RvcihASW5qZWN0KE5HX1NFTEVDVF9QTFVHSU5fSU5TVEFOQ0VTKSBAT3B0aW9uYWwoKSBuZ1NlbGVjdFBsdWdpbnM6IE5nU2VsZWN0UGx1Z2luSW5zdGFuY2VzLFxyXG4gICAgICAgICAgICAgICAgcGx1Z2luRWxlbWVudDogRWxlbWVudFJlZixcclxuICAgICAgICAgICAgICAgIEBJbmplY3QoVkFMVUVfSEFORExFUl9PUFRJT05TKSBAT3B0aW9uYWwoKSBvcHRpb25zPzogQmFzaWNWYWx1ZUhhbmRsZXJPcHRpb25zKVxyXG4gICAge1xyXG4gICAgICAgIHN1cGVyKG5nU2VsZWN0UGx1Z2lucywgcGx1Z2luRWxlbWVudCk7XHJcblxyXG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBleHRlbmQodHJ1ZSwge30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHVibGljIG1ldGhvZHMgLSBpbXBsZW1lbnRhdGlvbiBvZiBCYXNpY1ZhbHVlSGFuZGxlciAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXRzIHZhbHVlIGZvciBOZ1NlbGVjdFxyXG4gICAgICogQHBhcmFtIHZhbHVlIFZhbHVlIHRvIGJlIHNldFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0VmFsdWUodmFsdWU6VFZhbHVlfFRWYWx1ZVtdKTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX3VzZU9wdGlvbnNBc1ZhbHVlKHZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEluaXRpYWxpemUgcGx1Z2luIG9wdGlvbnMsIGFsbCBvcGVyYXRpb25zIHJlcXVpcmVkIHRvIGJlIGRvbmUgd2l0aCBwbHVnaW4gb3B0aW9ucyBhcmUgaGFuZGxlZCBoZXJlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbml0T3B0aW9ucygpXHJcbiAgICB7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeHBsaWNpdGx5IHJ1bnMgaW52YWxpZGF0aW9uIG9mIGNvbnRlbnQgKGNoYW5nZSBkZXRlY3Rpb24pXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbnZhbGlkYXRlVmlzdWFscygpOiB2b2lkXHJcbiAgICB7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHByb3RlY3RlZCBtZXRob2RzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldHMgdmFsdWUgXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfc2V0VmFsdWUgPSAob3B0aW9uOiDJtU5nU2VsZWN0T3B0aW9uPFRWYWx1ZT4pID0+XHJcbiAgICB7XHJcbiAgICAgICAgLy9tdWx0aXBsZSB2YWx1ZXMgYXJlIGFsbG93ZWRcclxuICAgICAgICBpZih0aGlzLm9wdGlvbnMubXVsdGlwbGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZighQXJyYXkuaXNBcnJheSh0aGlzLnNlbGVjdGVkT3B0aW9ucykpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gW107XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkodGhpcy5zZWxlY3RlZE9wdGlvbnMpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW5kZXg6IG51bWJlcjtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3ZhbHVlIGV4aXN0cywgcmVtb3ZpbmcgZnJvbSBsaXN0XHJcbiAgICAgICAgICAgICAgICBpZigoaW5kZXggPSB0aGlzLnNlbGVjdGVkT3B0aW9ucy5pbmRleE9mKG9wdGlvbikpID49IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vYWRkaW5nIHZhbHVlXHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMucHVzaChvcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gWy4uLnRoaXMuc2VsZWN0ZWRPcHRpb25zXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgLy9vbmx5IHNpZ25sZSB2YWx1ZSBhbGxvd2VkXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucyA9IG9wdGlvbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2NsZWFyU2VsZWN0ZWQoKTtcclxuICAgICAgICB0aGlzLl9tYXJrVmFsdWVBc1NlbGVjdGVkKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX25vcm1hbFN0YXRlLmludmFsaWRhdGVWaXN1YWxzKCk7XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KCk7XHJcblxyXG4gICAgICAgIC8vY2xvc2UgcG9wdXAgaWYgbm90IG11bHRpcGxlXHJcbiAgICAgICAgaWYoIXRoaXMub3B0aW9ucy5tdWx0aXBsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMucG9wdXBWaXNpYmlsaXR5UmVxdWVzdC5lbWl0KGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fcG9wdXAuaW52YWxpZGF0ZVZpc3VhbHMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBMb2FkcyBvcHRpb25zXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfbG9hZE9wdGlvbnMoKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX3VzZU9wdGlvbnNBc1ZhbHVlKGlzQmxhbmsodGhpcy5fdW5tYXBwZWRWYWx1ZSkgPyB0aGlzLnZhbHVlIDogdGhpcy5fdW5tYXBwZWRWYWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDb252ZXJ0cyB2YWx1ZSB0byBvcHRpb25zXHJcbiAgICAgKiBAcGFyYW0gdmFsdWUgVmFsdWUgdG8gYmUgY2hhbmdlZCB0byBvcHRpb25zXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfdXNlT3B0aW9uc0FzVmFsdWUodmFsdWU6IFRWYWx1ZXxUVmFsdWVbXSlcclxuICAgIHtcclxuICAgICAgICAvL3NldCBlbXB0eSB2YWx1ZVxyXG4gICAgICAgIGlmKGlzQmxhbmsodmFsdWUpIHx8IChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiAhdmFsdWUubGVuZ3RoKSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gdmFsdWU7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9jbGVhclNlbGVjdGVkKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3VubWFwcGVkVmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLl9ub3JtYWxTdGF0ZS5pbnZhbGlkYXRlVmlzdWFscygpO1xyXG4gICAgICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vbm8gb3B0aW9ucyBhdmFpbGFibGUgeWV0XHJcbiAgICAgICAgaWYoIXRoaXMub3B0aW9uc0dhdGhlcmVyLm9wdGlvbnMgfHwgIXRoaXMub3B0aW9uc0dhdGhlcmVyLm9wdGlvbnMubGVuZ3RoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fdW5tYXBwZWRWYWx1ZSA9IHZhbHVlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5vcHRpb25zLm11bHRpcGxlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheSh2YWx1ZSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGxldCBpdGVtcyA9IHZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gdGhpcy5vcHRpb25zR2F0aGVyZXIub3B0aW9ucy5maWx0ZXIoaXRtID0+ICEhaXRlbXMuZmluZChpdCA9PiB0aGlzLnZhbHVlQ29tcGFyZXIoaXQsIGl0bS52YWx1ZSkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRG9uYHQgeW91IGhhdmUgcmVkdW5kYW50IFwibXVsdGlwbGVcIj8nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KHZhbHVlKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcmUgeW91IG1pc3NpbmcgYXR0cmlidXRlIFwibXVsdGlwbGVcIj8nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGxldCBpdGVtID0gdmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMgPSB0aGlzLm9wdGlvbnNHYXRoZXJlci5vcHRpb25zLmZpbmQoaXRtID0+IHRoaXMudmFsdWVDb21wYXJlcihpdG0udmFsdWUsIGl0ZW0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fY2xlYXJTZWxlY3RlZCgpO1xyXG4gICAgICAgIHRoaXMuX21hcmtWYWx1ZUFzU2VsZWN0ZWQoKTtcclxuICAgICAgICB0aGlzLl91bm1hcHBlZFZhbHVlID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9ub3JtYWxTdGF0ZS5pbnZhbGlkYXRlVmlzdWFscygpO1xyXG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCgpO1xyXG4gICAgfVxyXG59Il19