/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ChangeDetectionStrategy, Inject, Optional, ElementRef, EventEmitter } from '@angular/core';
import { extend } from '@asseco/common';
import { NG_SELECT_PLUGIN_INSTANCES } from '../../../components/select/types';
import { KEYBOARD_HANDLER_OPTIONS } from '../types';
import { POPUP } from '../../popup/types';
/**
 * Default options for keyboard handler
 * \@internal
 * @type {?}
 */
var defaultOptions = {};
/**
 * Component used for obtaining basic keyboard handler html element
 */
var BasicKeyboardHandlerComponent = /** @class */ (function () {
    //######################### constructor #########################
    function BasicKeyboardHandlerComponent(ngSelectPlugins, pluginElement, options) {
        var _this = this;
        this.ngSelectPlugins = ngSelectPlugins;
        this.pluginElement = pluginElement;
        /**
         * Occurs when there is requested for change of visibility of popup using keyboard
         */
        this.popupVisibilityRequest = new EventEmitter();
        /**
         * Occurs when option was selected using keyboard
         */
        this.optionSelect = new EventEmitter();
        //######################### protected methods #########################
        /**
         * Handles keyboard event
         * @param event Keyboard event that occured
         */
        this._handleKeyboard = (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (event.key == "ArrowDown" || event.key == "ArrowUp") {
                _this.popupVisibilityRequest.emit(true);
                /** @type {?} */
                var activeOption = _this.availableOptions.find((/**
                 * @param {?} itm
                 * @return {?}
                 */
                function (itm) { return itm.active; }));
                if (activeOption) {
                    /** @type {?} */
                    var index = _this.availableOptions.indexOf(activeOption);
                    activeOption.active = false;
                    //move down cursor
                    if (event.key == "ArrowDown") {
                        index += 1;
                    }
                    //move up cursor
                    else {
                        index -= 1;
                    }
                    if (index < 0) {
                        index = _this.availableOptions.length - 1;
                    }
                    index = index % _this.availableOptions.length;
                    _this.availableOptions[index].active = true;
                }
                //none active before
                else if (_this.availableOptions.length) {
                    _this.availableOptions[0].active = true;
                }
                _this._popup.invalidateVisuals();
                event.preventDefault();
            }
            if (event.key == "Enter") {
                /** @type {?} */
                var activeOption = _this.availableOptions.find((/**
                 * @param {?} itm
                 * @return {?}
                 */
                function (itm) { return itm.active; }));
                if (activeOption) {
                    _this.optionSelect.emit(activeOption);
                }
                event.preventDefault();
            }
            if (event.key == "Tab" || event.key == "Escape") {
                _this.popupVisibilityRequest.emit(false);
            }
        });
        this._options = extend(true, {}, defaultOptions, options);
    }
    Object.defineProperty(BasicKeyboardHandlerComponent.prototype, "availableOptions", {
        //######################### protected properties #########################
        /**
         * Gets currently available options
         */
        get: 
        //######################### protected properties #########################
        /**
         * Gets currently available options
         * @protected
         * @return {?}
         */
        function () {
            return this.optionsGatherer.availableOptions;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BasicKeyboardHandlerComponent.prototype, "options", {
        //######################### public properties - implementation of BasicKeyboardHandler #########################
        /**
         * Options for NgSelect plugin
         */
        get: 
        //######################### public properties - implementation of BasicKeyboardHandler #########################
        /**
         * Options for NgSelect plugin
         * @return {?}
         */
        function () {
            return this._options;
        },
        set: /**
         * @param {?} options
         * @return {?}
         */
        function (options) {
            this._options = extend(true, this._options, options);
        },
        enumerable: true,
        configurable: true
    });
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     */
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    BasicKeyboardHandlerComponent.prototype.ngOnDestroy = 
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    function () {
        if (this.selectElement) {
            this.selectElement.removeEventListener('keydown', this._handleKeyboard);
        }
    };
    //######################### public methods - implementation of BasicKeyboardHandler #########################
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     */
    //######################### public methods - implementation of BasicKeyboardHandler #########################
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     * @return {?}
     */
    BasicKeyboardHandlerComponent.prototype.initialize = 
    //######################### public methods - implementation of BasicKeyboardHandler #########################
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     * @return {?}
     */
    function () {
        if (this.selectElement) {
            this.selectElement.addEventListener('keydown', this._handleKeyboard);
        }
        /** @type {?} */
        var popup = (/** @type {?} */ (this.ngSelectPlugins[POPUP]));
        if (this._popup && this._popup != popup) {
            this._popup = null;
        }
        if (!this._popup) {
            this._popup = popup;
        }
    };
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     */
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    BasicKeyboardHandlerComponent.prototype.initOptions = /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    function () {
    };
    /**
     * Explicitly runs invalidation of content (change detection)
     */
    /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    BasicKeyboardHandlerComponent.prototype.invalidateVisuals = /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    function () {
    };
    BasicKeyboardHandlerComponent.decorators = [
        { type: Component, args: [{
                    selector: "ng-basic-keyboard-handler",
                    template: '',
                    changeDetection: ChangeDetectionStrategy.OnPush
                }] }
    ];
    /** @nocollapse */
    BasicKeyboardHandlerComponent.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [NG_SELECT_PLUGIN_INSTANCES,] }, { type: Optional }] },
        { type: ElementRef },
        { type: undefined, decorators: [{ type: Inject, args: [KEYBOARD_HANDLER_OPTIONS,] }, { type: Optional }] }
    ]; };
    return BasicKeyboardHandlerComponent;
}());
export { BasicKeyboardHandlerComponent };
if (false) {
    /**
     * Options for NgSelect plugin
     * @type {?}
     * @protected
     */
    BasicKeyboardHandlerComponent.prototype._options;
    /**
     * Popup that is displayed
     * @type {?}
     * @protected
     */
    BasicKeyboardHandlerComponent.prototype._popup;
    /**
     * HTML element that represents select itself
     * @type {?}
     */
    BasicKeyboardHandlerComponent.prototype.selectElement;
    /**
     * Instance of options gatherer, that is used for obtaining available options
     * @type {?}
     */
    BasicKeyboardHandlerComponent.prototype.optionsGatherer;
    /**
     * Occurs when there is requested for change of visibility of popup using keyboard
     * @type {?}
     */
    BasicKeyboardHandlerComponent.prototype.popupVisibilityRequest;
    /**
     * Occurs when option was selected using keyboard
     * @type {?}
     */
    BasicKeyboardHandlerComponent.prototype.optionSelect;
    /**
     * Handles keyboard event
     * \@param event Keyboard event that occured
     * @type {?}
     * @protected
     */
    BasicKeyboardHandlerComponent.prototype._handleKeyboard;
    /** @type {?} */
    BasicKeyboardHandlerComponent.prototype.ngSelectPlugins;
    /** @type {?} */
    BasicKeyboardHandlerComponent.prototype.pluginElement;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzaWNLZXlib2FyZEhhbmRsZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3BsdWdpbnMva2V5Ym9hcmRIYW5kbGVyL2Jhc2ljL2Jhc2ljS2V5Ym9hcmRIYW5kbGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSx1QkFBdUIsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBYSxZQUFZLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDeEgsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBS3RDLE9BQU8sRUFBQywwQkFBMEIsRUFBQyxNQUFNLGtDQUFrQyxDQUFDO0FBQzVFLE9BQU8sRUFBQyx3QkFBd0IsRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUdsRCxPQUFPLEVBQUMsS0FBSyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7Ozs7OztJQU1sQyxjQUFjLEdBQ3BCLEVBQ0M7Ozs7QUFLRDtJQWdFSSxpRUFBaUU7SUFDakUsdUNBQW1FLGVBQXdDLEVBQ3hGLGFBQXlCLEVBQ2MsT0FBcUM7UUFGL0YsaUJBS0M7UUFMa0Usb0JBQWUsR0FBZixlQUFlLENBQXlCO1FBQ3hGLGtCQUFhLEdBQWIsYUFBYSxDQUFZOzs7O1FBVHJDLDJCQUFzQixHQUEwQixJQUFJLFlBQVksRUFBVyxDQUFDOzs7O1FBSzVFLGlCQUFZLEdBQXNDLElBQUksWUFBWSxFQUF1QixDQUFDOzs7Ozs7UUFvRXZGLG9CQUFlOzs7O1FBQUcsVUFBQyxLQUFvQjtZQUU3QyxJQUFHLEtBQUssQ0FBQyxHQUFHLElBQUksV0FBVyxJQUFJLEtBQUssQ0FBQyxHQUFHLElBQUksU0FBUyxFQUNyRDtnQkFDSSxLQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDOztvQkFDbkMsWUFBWSxHQUFHLEtBQUksQ0FBQyxnQkFB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U3RyYXRlZ3ksIEluamVjdCwgT3B0aW9uYWwsIEVsZW1lbnRSZWYsIE9uRGVzdHJveSwgRXZlbnRFbWl0dGVyfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtleHRlbmR9IGZyb20gJ0Bhc3NlY28vY29tbW9uJztcclxuXHJcbmltcG9ydCB7QmFzaWNLZXlib2FyZEhhbmRsZXJPcHRpb25zLCBCYXNpY0tleWJvYXJkSGFuZGxlcn0gZnJvbSAnLi9iYXNpY0tleWJvYXJkSGFuZGxlci5pbnRlcmZhY2UnO1xyXG5pbXBvcnQge05nU2VsZWN0UGx1Z2luR2VuZXJpYywgT3B0aW9uc0dhdGhlcmVyfSBmcm9tICcuLi8uLi8uLi9taXNjJztcclxuaW1wb3J0IHtOZ1NlbGVjdFBsdWdpbkluc3RhbmNlc30gZnJvbSAnLi4vLi4vLi4vY29tcG9uZW50cy9zZWxlY3QnO1xyXG5pbXBvcnQge05HX1NFTEVDVF9QTFVHSU5fSU5TVEFOQ0VTfSBmcm9tICcuLi8uLi8uLi9jb21wb25lbnRzL3NlbGVjdC90eXBlcyc7XHJcbmltcG9ydCB7S0VZQk9BUkRfSEFORExFUl9PUFRJT05TfSBmcm9tICcuLi90eXBlcyc7XHJcbmltcG9ydCB7ybVOZ1NlbGVjdE9wdGlvbiwgTmdTZWxlY3RPcHRpb259IGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudHMvb3B0aW9uJztcclxuaW1wb3J0IHtQb3B1cH0gZnJvbSAnLi4vLi4vcG9wdXAnO1xyXG5pbXBvcnQge1BPUFVQfSBmcm9tICcuLi8uLi9wb3B1cC90eXBlcyc7XHJcblxyXG4vKipcclxuICogRGVmYXVsdCBvcHRpb25zIGZvciBrZXlib2FyZCBoYW5kbGVyXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuY29uc3QgZGVmYXVsdE9wdGlvbnM6IEJhc2ljS2V5Ym9hcmRIYW5kbGVyT3B0aW9ucyA9XHJcbntcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDb21wb25lbnQgdXNlZCBmb3Igb2J0YWluaW5nIGJhc2ljIGtleWJvYXJkIGhhbmRsZXIgaHRtbCBlbGVtZW50XHJcbiAqL1xyXG5AQ29tcG9uZW50KFxyXG57XHJcbiAgICBzZWxlY3RvcjogXCJuZy1iYXNpYy1rZXlib2FyZC1oYW5kbGVyXCIsXHJcbiAgICB0ZW1wbGF0ZTogJycsXHJcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQmFzaWNLZXlib2FyZEhhbmRsZXJDb21wb25lbnQgaW1wbGVtZW50cyBCYXNpY0tleWJvYXJkSGFuZGxlciwgTmdTZWxlY3RQbHVnaW5HZW5lcmljPEJhc2ljS2V5Ym9hcmRIYW5kbGVyT3B0aW9ucz4sIE9uRGVzdHJveVxyXG57XHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHJvdGVjdGVkIGZpZWxkcyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBPcHRpb25zIGZvciBOZ1NlbGVjdCBwbHVnaW5cclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9vcHRpb25zOiBCYXNpY0tleWJvYXJkSGFuZGxlck9wdGlvbnM7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQb3B1cCB0aGF0IGlzIGRpc3BsYXllZFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX3BvcHVwOiBQb3B1cDtcclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHJvdGVjdGVkIHByb3BlcnRpZXMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBjdXJyZW50bHkgYXZhaWxhYmxlIG9wdGlvbnNcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGdldCBhdmFpbGFibGVPcHRpb25zKCk6IMm1TmdTZWxlY3RPcHRpb248YW55PltdXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9uc0dhdGhlcmVyLmF2YWlsYWJsZU9wdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBwcm9wZXJ0aWVzIC0gaW1wbGVtZW50YXRpb24gb2YgQmFzaWNLZXlib2FyZEhhbmRsZXIgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogT3B0aW9ucyBmb3IgTmdTZWxlY3QgcGx1Z2luXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXQgb3B0aW9ucygpOiBCYXNpY0tleWJvYXJkSGFuZGxlck9wdGlvbnNcclxuICAgIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb3B0aW9ucztcclxuICAgIH1cclxuICAgIHB1YmxpYyBzZXQgb3B0aW9ucyhvcHRpb25zOiBCYXNpY0tleWJvYXJkSGFuZGxlck9wdGlvbnMpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IGV4dGVuZCh0cnVlLCB0aGlzLl9vcHRpb25zLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhUTUwgZWxlbWVudCB0aGF0IHJlcHJlc2VudHMgc2VsZWN0IGl0c2VsZlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2VsZWN0RWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbnN0YW5jZSBvZiBvcHRpb25zIGdhdGhlcmVyLCB0aGF0IGlzIHVzZWQgZm9yIG9idGFpbmluZyBhdmFpbGFibGUgb3B0aW9uc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3B0aW9uc0dhdGhlcmVyOiBPcHRpb25zR2F0aGVyZXI8YW55PjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIE9jY3VycyB3aGVuIHRoZXJlIGlzIHJlcXVlc3RlZCBmb3IgY2hhbmdlIG9mIHZpc2liaWxpdHkgb2YgcG9wdXAgdXNpbmcga2V5Ym9hcmRcclxuICAgICAqL1xyXG4gICAgcHVibGljIHBvcHVwVmlzaWJpbGl0eVJlcXVlc3Q6IEV2ZW50RW1pdHRlcjxib29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIE9jY3VycyB3aGVuIG9wdGlvbiB3YXMgc2VsZWN0ZWQgdXNpbmcga2V5Ym9hcmRcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9wdGlvblNlbGVjdDogRXZlbnRFbWl0dGVyPE5nU2VsZWN0T3B0aW9uPGFueT4+ID0gbmV3IEV2ZW50RW1pdHRlcjxOZ1NlbGVjdE9wdGlvbjxhbnk+PigpO1xyXG5cclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBjb25zdHJ1Y3RvciAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbiAgICBjb25zdHJ1Y3RvcihASW5qZWN0KE5HX1NFTEVDVF9QTFVHSU5fSU5TVEFOQ0VTKSBAT3B0aW9uYWwoKSBwdWJsaWMgbmdTZWxlY3RQbHVnaW5zOiBOZ1NlbGVjdFBsdWdpbkluc3RhbmNlcyxcclxuICAgICAgICAgICAgICAgIHB1YmxpYyBwbHVnaW5FbGVtZW50OiBFbGVtZW50UmVmLFxyXG4gICAgICAgICAgICAgICAgQEluamVjdChLRVlCT0FSRF9IQU5ETEVSX09QVElPTlMpIEBPcHRpb25hbCgpIG9wdGlvbnM/OiBCYXNpY0tleWJvYXJkSGFuZGxlck9wdGlvbnMpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IGV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBwdWJsaWMgbWV0aG9kcyAtIGltcGxlbWVudGF0aW9uIG9mIE9uRGVzdHJveSAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICogQ2FsbGVkIHdoZW4gY29tcG9uZW50IGlzIGRlc3Ryb3llZFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgbmdPbkRlc3Ryb3koKVxyXG4gICAge1xyXG4gICAgICAgIGlmKHRoaXMuc2VsZWN0RWxlbWVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0RWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5faGFuZGxlS2V5Ym9hcmQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHVibGljIG1ldGhvZHMgLSBpbXBsZW1lbnRhdGlvbiBvZiBCYXNpY0tleWJvYXJkSGFuZGxlciAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbml0aWFsaXplIHBsdWdpbiwgdG8gYmUgcmVhZHkgdG8gdXNlLCBpbml0aWFsaXplIGNvbW11bmljYXRpb24gd2l0aCBvdGhlciBwbHVnaW5zXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbml0aWFsaXplKClcclxuICAgIHtcclxuICAgICAgICBpZih0aGlzLnNlbGVjdEVsZW1lbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUtleWJvYXJkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBwb3B1cCA9IHRoaXMubmdTZWxlY3RQbHVnaW5zW1BPUFVQXSBhcyBQb3B1cDtcclxuXHJcbiAgICAgICAgaWYodGhpcy5fcG9wdXAgJiYgdGhpcy5fcG9wdXAgIT0gcG9wdXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKCF0aGlzLl9wb3B1cClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHVwID0gcG9wdXA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGl6ZSBwbHVnaW4gb3B0aW9ucywgYWxsIG9wZXJhdGlvbnMgcmVxdWlyZWQgdG8gYmUgZG9uZSB3aXRoIHBsdWdpbiBvcHRpb25zIGFyZSBoYW5kbGVkIGhlcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluaXRPcHRpb25zKClcclxuICAgIHtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEV4cGxpY2l0bHkgcnVucyBpbnZhbGlkYXRpb24gb2YgY29udGVudCAoY2hhbmdlIGRldGVjdGlvbilcclxuICAgICAqL1xyXG4gICAgcHVibGljIGludmFsaWRhdGVWaXN1YWxzKCk6IHZvaWRcclxuICAgIHtcclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHJvdGVjdGVkIG1ldGhvZHMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSGFuZGxlcyBrZXlib2FyZCBldmVudFxyXG4gICAgICogQHBhcmFtIGV2ZW50IEtleWJvYXJkIGV2ZW50IHRoYXQgb2NjdXJlZFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX2hhbmRsZUtleWJvYXJkID0gKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PlxyXG4gICAge1xyXG4gICAgICAgIGlmKGV2ZW50LmtleSA9PSBcIkFycm93RG93blwiIHx8IGV2ZW50LmtleSA9PSBcIkFycm93VXBcIilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMucG9wdXBWaXNpYmlsaXR5UmVxdWVzdC5lbWl0KHRydWUpO1xyXG4gICAgICAgICAgICBsZXQgYWN0aXZlT3B0aW9uID0gdGhpcy5hdmFpbGFibGVPcHRpb25zLmZpbmQoaXRtID0+IGl0bS5hY3RpdmUpO1xyXG5cclxuICAgICAgICAgICAgaWYoYWN0aXZlT3B0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSB0aGlzLmF2YWlsYWJsZU9wdGlvbnMuaW5kZXhPZihhY3RpdmVPcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgYWN0aXZlT3B0aW9uLmFjdGl2ZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vbW92ZSBkb3duIGN1cnNvclxyXG4gICAgICAgICAgICAgICAgaWYoZXZlbnQua2V5ID09IFwiQXJyb3dEb3duXCIpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggKz0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vbW92ZSB1cCBjdXJzb3JcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmKGluZGV4IDwgMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IHRoaXMuYXZhaWxhYmxlT3B0aW9ucy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGluZGV4ID0gaW5kZXggJSB0aGlzLmF2YWlsYWJsZU9wdGlvbnMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlT3B0aW9uc1tpbmRleF0uYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL25vbmUgYWN0aXZlIGJlZm9yZVxyXG4gICAgICAgICAgICBlbHNlIGlmKHRoaXMuYXZhaWxhYmxlT3B0aW9ucy5sZW5ndGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlT3B0aW9uc1swXS5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cC5pbnZhbGlkYXRlVmlzdWFscygpO1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoZXZlbnQua2V5ID09IFwiRW50ZXJcIilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxldCBhY3RpdmVPcHRpb24gPSB0aGlzLmF2YWlsYWJsZU9wdGlvbnMuZmluZChpdG0gPT4gaXRtLmFjdGl2ZSk7XHJcblxyXG4gICAgICAgICAgICBpZihhY3RpdmVPcHRpb24pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uU2VsZWN0LmVtaXQoYWN0aXZlT3B0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKGV2ZW50LmtleSA9PSBcIlRhYlwiIHx8IGV2ZW50LmtleSA9PSBcIkVzY2FwZVwiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5wb3B1cFZpc2liaWxpdHlSZXF1ZXN0LmVtaXQoZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdfQ==