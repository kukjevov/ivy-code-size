/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ChangeDetectionStrategy, ChangeDetectorRef, Inject, Optional, ElementRef, ViewChild, EventEmitter } from '@angular/core';
import { extend } from '@asseco/common';
import { NG_SELECT_PLUGIN_INSTANCES } from '../../../components/select/types';
import { LIVE_SEARCH_OPTIONS } from '../types';
import { TEXTS_LOCATOR } from '../../textsLocator/types';
import { POPUP } from '../../popup/types';
/**
 * Default options for live search
 * \@internal
 * @type {?}
 */
const defaultOptions = {
    cssClasses: {
        wrapperDiv: 'wrapper-div',
        input: 'form-control'
    },
    texts: {
        inputPlaceholder: 'Filter options'
    },
    keepSearchValue: false
};
/**
 * Component used for obtaining basic live search html element
 */
export class BasicLiveSearchComponent {
    //######################### constructor #########################
    /**
     * @param {?} ngSelectPlugins
     * @param {?} pluginElement
     * @param {?} _changeDetector
     * @param {?=} options
     */
    constructor(ngSelectPlugins, pluginElement, _changeDetector, options) {
        this.ngSelectPlugins = ngSelectPlugins;
        this.pluginElement = pluginElement;
        this._changeDetector = _changeDetector;
        /**
         * Current value of live search
         */
        this.searchValue = null;
        /**
         * Occurs when current value of live search changes
         */
        this.searchValueChange = new EventEmitter();
        //######################### public properties - template bindings #########################
        /**
         * Object containing available texts
         * \@internal
         */
        this.texts = {};
        this._options = extend(true, {}, defaultOptions, options);
    }
    //######################### public properties - implementation of BasicLiveSearch #########################
    /**
     * Options for NgSelect plugin
     * @return {?}
     */
    get options() {
        return this._options;
    }
    /**
     * @param {?} options
     * @return {?}
     */
    set options(options) {
        this._options = extend(true, this._options, options);
    }
    /**
     * HTML element that represents live search
     * @return {?}
     */
    get liveSearchElement() {
        return this.liveSearchElementChild.nativeElement;
    }
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    ngOnDestroy() {
        if (this._visibilityChangeSubscription) {
            this._visibilityChangeSubscription.unsubscribe();
            this._visibilityChangeSubscription = null;
        }
        if (this._textsChangedSubscription) {
            this._textsChangedSubscription.unsubscribe();
            this._textsChangedSubscription = null;
        }
    }
    //######################### public methods - implementation of BasicLiveSearch #########################
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     * @return {?}
     */
    initialize() {
        /** @type {?} */
        let textsLocator = (/** @type {?} */ (this.ngSelectPlugins[TEXTS_LOCATOR]));
        if (this._textsLocator && this._textsLocator != textsLocator) {
            this._textsChangedSubscription.unsubscribe();
            this._textsChangedSubscription = null;
            this._textsLocator = null;
        }
        if (!this._textsLocator) {
            this._textsLocator = textsLocator;
            this._textsChangedSubscription = this._textsLocator.textsChange.subscribe((/**
             * @return {?}
             */
            () => this._initTexts()));
        }
        /** @type {?} */
        let popup = (/** @type {?} */ (this.ngSelectPlugins[POPUP]));
        if (this._popup && this._popup != popup) {
            this._visibilityChangeSubscription.unsubscribe();
            this._visibilityChangeSubscription = null;
            this._popup = null;
        }
        if (!this._popup) {
            this._popup = popup;
            this._visibilityChangeSubscription = this._popup.visibilityChange.subscribe((/**
             * @return {?}
             */
            () => {
                if (!this.options.keepSearchValue) {
                    this.searchValue = '';
                    this.searchValueChange.emit();
                    this._changeDetector.detectChanges();
                }
            }));
        }
        this._initTexts();
    }
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    initOptions() {
    }
    /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    invalidateVisuals() {
        this._changeDetector.detectChanges();
    }
    //######################### public methods - template bindings #########################
    /**
     * Handle input value
     * \@internal
     * @param {?} value Value of input
     * @return {?}
     */
    handleInput(value) {
        this.searchValue = value;
        this.searchValueChange.emit();
    }
    //######################### protected methods #########################
    /**
     * Initialize texts
     * @protected
     * @return {?}
     */
    _initTexts() {
        Object.keys(this.options.texts).forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            this.texts[key] = this._textsLocator.getText(this.options.texts[key]);
        }));
        this._changeDetector.detectChanges();
    }
}
BasicLiveSearchComponent.decorators = [
    { type: Component, args: [{
                selector: "ng-basic-live-search",
                template: "<div style=\"display: none;\">\r\n    <div #liveSearchElement [ngClass]=\"options?.cssClasses?.wrapperDiv\">\r\n        <input [ngClass]=\"options?.cssClasses?.input\" type=\"text\" (input)=\"handleInput($event.target.value)\" [value]=\"searchValue\" placeholder=\"{{texts?.inputPlaceholder}}\">\r\n    </div>\r\n</div>",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [`.wrapper-div
        {
            padding: 4px;
            border-bottom: 1px solid #666;
            margin-bottom: 2px;
        }
        
        .form-control
        {
            width: 100%;
        }`]
            }] }
];
/** @nocollapse */
BasicLiveSearchComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [NG_SELECT_PLUGIN_INSTANCES,] }, { type: Optional }] },
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: undefined, decorators: [{ type: Inject, args: [LIVE_SEARCH_OPTIONS,] }, { type: Optional }] }
];
BasicLiveSearchComponent.propDecorators = {
    liveSearchElementChild: [{ type: ViewChild, args: ['liveSearchElement',] }]
};
if (false) {
    /**
     * Texts locator used for handling texts
     * @type {?}
     * @protected
     */
    BasicLiveSearchComponent.prototype._textsLocator;
    /**
     * Popup used in NgSelect
     * @type {?}
     * @protected
     */
    BasicLiveSearchComponent.prototype._popup;
    /**
     * Subscription for changes in texts
     * @type {?}
     * @protected
     */
    BasicLiveSearchComponent.prototype._textsChangedSubscription;
    /**
     * Subscription for changes of popup visibility
     * @type {?}
     * @protected
     */
    BasicLiveSearchComponent.prototype._visibilityChangeSubscription;
    /**
     * Options for NgSelect plugin
     * @type {?}
     * @protected
     */
    BasicLiveSearchComponent.prototype._options;
    /**
     * Current value of live search
     * @type {?}
     */
    BasicLiveSearchComponent.prototype.searchValue;
    /**
     * Occurs when current value of live search changes
     * @type {?}
     */
    BasicLiveSearchComponent.prototype.searchValueChange;
    /**
     * Object containing available texts
     * \@internal
     * @type {?}
     */
    BasicLiveSearchComponent.prototype.texts;
    /**
     * View child that represents live search element
     * \@internal
     * @type {?}
     */
    BasicLiveSearchComponent.prototype.liveSearchElementChild;
    /** @type {?} */
    BasicLiveSearchComponent.prototype.ngSelectPlugins;
    /** @type {?} */
    BasicLiveSearchComponent.prototype.pluginElement;
    /**
     * @type {?}
     * @protected
     */
    BasicLiveSearchComponent.prototype._changeDetector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzaWNMaXZlU2VhcmNoLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9wbHVnaW5zL2xpdmVTZWFyY2gvYmFzaWMvYmFzaWNMaXZlU2VhcmNoLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSx1QkFBdUIsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFZLE1BQU0sZUFBZSxDQUFDO0FBQ3RKLE9BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQU10QyxPQUFPLEVBQUMsMEJBQTBCLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQztBQUU1RSxPQUFPLEVBQUMsbUJBQW1CLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFFN0MsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBRXZELE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQzs7Ozs7O01BTWxDLGNBQWMsR0FDcEI7SUFDSSxVQUFVLEVBQ1Y7UUFDSSxVQUFVLEVBQUUsYUFBYTtRQUN6QixLQUFLLEVBQUUsY0FBYztLQUN4QjtJQUNELEtBQUssRUFDTDtRQUNJLGdCQUFnQixFQUFFLGdCQUFnQjtLQUNyQztJQUNELGVBQWUsRUFBRSxLQUFLO0NBQ3pCOzs7O0FBeUJELE1BQU0sT0FBTyx3QkFBd0I7Ozs7Ozs7O0lBK0VqQyxZQUFtRSxlQUF3QyxFQUN4RixhQUF5QixFQUN0QixlQUFrQyxFQUNILE9BQWdDO1FBSGxCLG9CQUFlLEdBQWYsZUFBZSxDQUF5QjtRQUN4RixrQkFBYSxHQUFiLGFBQWEsQ0FBWTtRQUN0QixvQkFBZSxHQUFmLGVBQWUsQ0FBbUI7Ozs7UUEzQmpELGdCQUFXLEdBQVcsSUFBSSxDQUFDOzs7O1FBSzNCLHNCQUFpQixHQUF1QixJQUFJLFlB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QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEluamVjdCwgT3B0aW9uYWwsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgRXZlbnRFbWl0dGVyLCBPbkRlc3Ryb3l9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge2V4dGVuZH0gZnJvbSAnQGFzc2Vjby9jb21tb24nO1xyXG5pbXBvcnQge1N1YnNjcmlwdGlvbn0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQge0Jhc2ljTGl2ZVNlYXJjaE9wdGlvbnMsIEJhc2ljTGl2ZVNlYXJjaH0gZnJvbSAnLi9iYXNpY0xpdmVTZWFyY2guaW50ZXJmYWNlJztcclxuaW1wb3J0IHtOZ1NlbGVjdFBsdWdpbkdlbmVyaWN9IGZyb20gJy4uLy4uLy4uL21pc2MnO1xyXG5pbXBvcnQge05nU2VsZWN0UGx1Z2luSW5zdGFuY2VzfSBmcm9tICcuLi8uLi8uLi9jb21wb25lbnRzL3NlbGVjdCc7XHJcbmltcG9ydCB7TkdfU0VMRUNUX1BMVUdJTl9JTlNUQU5DRVN9IGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudHMvc2VsZWN0L3R5cGVzJztcclxuaW1wb3J0IHtMaXZlU2VhcmNoVGV4dHN9IGZyb20gJy4uL2xpdmVTZWFyY2guaW50ZXJmYWNlJztcclxuaW1wb3J0IHtMSVZFX1NFQVJDSF9PUFRJT05TfSBmcm9tICcuLi90eXBlcyc7XHJcbmltcG9ydCB7VGV4dHNMb2NhdG9yfSBmcm9tICcuLi8uLi90ZXh0c0xvY2F0b3InO1xyXG5pbXBvcnQge1RFWFRTX0xPQ0FUT1J9IGZyb20gJy4uLy4uL3RleHRzTG9jYXRvci90eXBlcyc7XHJcbmltcG9ydCB7UG9wdXB9IGZyb20gJy4uLy4uL3BvcHVwJztcclxuaW1wb3J0IHtQT1BVUH0gZnJvbSAnLi4vLi4vcG9wdXAvdHlwZXMnO1xyXG5cclxuLyoqXHJcbiAqIERlZmF1bHQgb3B0aW9ucyBmb3IgbGl2ZSBzZWFyY2hcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5jb25zdCBkZWZhdWx0T3B0aW9uczogQmFzaWNMaXZlU2VhcmNoT3B0aW9ucyA9XHJcbntcclxuICAgIGNzc0NsYXNzZXM6XHJcbiAgICB7XHJcbiAgICAgICAgd3JhcHBlckRpdjogJ3dyYXBwZXItZGl2JyxcclxuICAgICAgICBpbnB1dDogJ2Zvcm0tY29udHJvbCdcclxuICAgIH0sXHJcbiAgICB0ZXh0czpcclxuICAgIHtcclxuICAgICAgICBpbnB1dFBsYWNlaG9sZGVyOiAnRmlsdGVyIG9wdGlvbnMnXHJcbiAgICB9LFxyXG4gICAga2VlcFNlYXJjaFZhbHVlOiBmYWxzZVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIENvbXBvbmVudCB1c2VkIGZvciBvYnRhaW5pbmcgYmFzaWMgbGl2ZSBzZWFyY2ggaHRtbCBlbGVtZW50XHJcbiAqL1xyXG5AQ29tcG9uZW50KFxyXG57XHJcbiAgICBzZWxlY3RvcjogXCJuZy1iYXNpYy1saXZlLXNlYXJjaFwiLFxyXG4gICAgdGVtcGxhdGVVcmw6ICdiYXNpY0xpdmVTZWFyY2guY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXHJcbiAgICBzdHlsZXM6XHJcbiAgICBbXHJcbiAgICAgICAgYC53cmFwcGVyLWRpdlxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcGFkZGluZzogNHB4O1xyXG4gICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzY2NjtcclxuICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMnB4O1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAuZm9ybS1jb250cm9sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB3aWR0aDogMTAwJTtcclxuICAgICAgICB9YFxyXG4gICAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQmFzaWNMaXZlU2VhcmNoQ29tcG9uZW50IGltcGxlbWVudHMgQmFzaWNMaXZlU2VhcmNoLCBOZ1NlbGVjdFBsdWdpbkdlbmVyaWM8QmFzaWNMaXZlU2VhcmNoT3B0aW9ucz4sIE9uRGVzdHJveVxyXG57XHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHJvdGVjdGVkIGZpZWxkcyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBUZXh0cyBsb2NhdG9yIHVzZWQgZm9yIGhhbmRsaW5nIHRleHRzXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfdGV4dHNMb2NhdG9yOiBUZXh0c0xvY2F0b3I7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQb3B1cCB1c2VkIGluIE5nU2VsZWN0XHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfcG9wdXA6IFBvcHVwO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaXB0aW9uIGZvciBjaGFuZ2VzIGluIHRleHRzXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfdGV4dHNDaGFuZ2VkU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpcHRpb24gZm9yIGNoYW5nZXMgb2YgcG9wdXAgdmlzaWJpbGl0eVxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX3Zpc2liaWxpdHlDaGFuZ2VTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wdGlvbnMgZm9yIE5nU2VsZWN0IHBsdWdpblxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX29wdGlvbnM6IEJhc2ljTGl2ZVNlYXJjaE9wdGlvbnM7XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBwcm9wZXJ0aWVzIC0gaW1wbGVtZW50YXRpb24gb2YgQmFzaWNMaXZlU2VhcmNoICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wdGlvbnMgZm9yIE5nU2VsZWN0IHBsdWdpblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0IG9wdGlvbnMoKTogQmFzaWNMaXZlU2VhcmNoT3B0aW9uc1xyXG4gICAge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHNldCBvcHRpb25zKG9wdGlvbnM6IEJhc2ljTGl2ZVNlYXJjaE9wdGlvbnMpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IGV4dGVuZCh0cnVlLCB0aGlzLl9vcHRpb25zLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhUTUwgZWxlbWVudCB0aGF0IHJlcHJlc2VudHMgbGl2ZSBzZWFyY2hcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldCBsaXZlU2VhcmNoRWxlbWVudCgpOiBIVE1MRWxlbWVudFxyXG4gICAge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxpdmVTZWFyY2hFbGVtZW50Q2hpbGQubmF0aXZlRWxlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEN1cnJlbnQgdmFsdWUgb2YgbGl2ZSBzZWFyY2hcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNlYXJjaFZhbHVlOiBzdHJpbmcgPSBudWxsO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogT2NjdXJzIHdoZW4gY3VycmVudCB2YWx1ZSBvZiBsaXZlIHNlYXJjaCBjaGFuZ2VzXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZWFyY2hWYWx1ZUNoYW5nZTogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG5cclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBwdWJsaWMgcHJvcGVydGllcyAtIHRlbXBsYXRlIGJpbmRpbmdzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIE9iamVjdCBjb250YWluaW5nIGF2YWlsYWJsZSB0ZXh0c1xyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB0ZXh0czogTGl2ZVNlYXJjaFRleHRzID0ge307XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBwcm9wZXJ0aWVzIC0gY2hpbGRyZW4gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVmlldyBjaGlsZCB0aGF0IHJlcHJlc2VudHMgbGl2ZSBzZWFyY2ggZWxlbWVudFxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIEBWaWV3Q2hpbGQoJ2xpdmVTZWFyY2hFbGVtZW50JylcclxuICAgIHB1YmxpYyBsaXZlU2VhcmNoRWxlbWVudENoaWxkOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PjtcclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgY29uc3RydWN0b3IgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4gICAgY29uc3RydWN0b3IoQEluamVjdChOR19TRUxFQ1RfUExVR0lOX0lOU1RBTkNFUykgQE9wdGlvbmFsKCkgcHVibGljIG5nU2VsZWN0UGx1Z2luczogTmdTZWxlY3RQbHVnaW5JbnN0YW5jZXMsXHJcbiAgICAgICAgICAgICAgICBwdWJsaWMgcGx1Z2luRWxlbWVudDogRWxlbWVudFJlZixcclxuICAgICAgICAgICAgICAgIHByb3RlY3RlZCBfY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgICAgICAgICAgICAgQEluamVjdChMSVZFX1NFQVJDSF9PUFRJT05TKSBAT3B0aW9uYWwoKSBvcHRpb25zPzogQmFzaWNMaXZlU2VhcmNoT3B0aW9ucylcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9vcHRpb25zID0gZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBtZXRob2RzIC0gaW1wbGVtZW50YXRpb24gb2YgT25EZXN0cm95ICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgd2hlbiBjb21wb25lbnQgaXMgZGVzdHJveWVkXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpXHJcbiAgICB7XHJcbiAgICAgICAgaWYodGhpcy5fdmlzaWJpbGl0eUNoYW5nZVN1YnNjcmlwdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Zpc2liaWxpdHlDaGFuZ2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlzaWJpbGl0eUNoYW5nZVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLl90ZXh0c0NoYW5nZWRTdWJzY3JpcHRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl90ZXh0c0NoYW5nZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fdGV4dHNDaGFuZ2VkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBtZXRob2RzIC0gaW1wbGVtZW50YXRpb24gb2YgQmFzaWNMaXZlU2VhcmNoICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIEluaXRpYWxpemUgcGx1Z2luLCB0byBiZSByZWFkeSB0byB1c2UsIGluaXRpYWxpemUgY29tbXVuaWNhdGlvbiB3aXRoIG90aGVyIHBsdWdpbnNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluaXRpYWxpemUoKVxyXG4gICAge1xyXG4gICAgICAgIGxldCB0ZXh0c0xvY2F0b3IgPSB0aGlzLm5nU2VsZWN0UGx1Z2luc1tURVhUU19MT0NBVE9SXSBhcyBUZXh0c0xvY2F0b3I7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX3RleHRzTG9jYXRvciAmJiB0aGlzLl90ZXh0c0xvY2F0b3IgIT0gdGV4dHNMb2NhdG9yKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fdGV4dHNDaGFuZ2VkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3RleHRzQ2hhbmdlZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl90ZXh0c0xvY2F0b3IgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoIXRoaXMuX3RleHRzTG9jYXRvcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3RleHRzTG9jYXRvciA9IHRleHRzTG9jYXRvcjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3RleHRzQ2hhbmdlZFN1YnNjcmlwdGlvbiA9IHRoaXMuX3RleHRzTG9jYXRvci50ZXh0c0NoYW5nZS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5faW5pdFRleHRzKCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHBvcHVwID0gdGhpcy5uZ1NlbGVjdFBsdWdpbnNbUE9QVVBdIGFzIFBvcHVwO1xyXG5cclxuICAgICAgICBpZih0aGlzLl9wb3B1cCAmJiB0aGlzLl9wb3B1cCAhPSBwb3B1cClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Zpc2liaWxpdHlDaGFuZ2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlzaWJpbGl0eUNoYW5nZVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZighdGhpcy5fcG9wdXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cCA9IHBvcHVwO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fdmlzaWJpbGl0eUNoYW5nZVN1YnNjcmlwdGlvbiA9IHRoaXMuX3BvcHVwLnZpc2liaWxpdHlDaGFuZ2Uuc3Vic2NyaWJlKCgpID0+XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmKCF0aGlzLm9wdGlvbnMua2VlcFNlYXJjaFZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoVmFsdWUgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFZhbHVlQ2hhbmdlLmVtaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5faW5pdFRleHRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbml0aWFsaXplIHBsdWdpbiBvcHRpb25zLCBhbGwgb3BlcmF0aW9ucyByZXF1aXJlZCB0byBiZSBkb25lIHdpdGggcGx1Z2luIG9wdGlvbnMgYXJlIGhhbmRsZWQgaGVyZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaW5pdE9wdGlvbnMoKVxyXG4gICAge1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRXhwbGljaXRseSBydW5zIGludmFsaWRhdGlvbiBvZiBjb250ZW50IChjaGFuZ2UgZGV0ZWN0aW9uKVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaW52YWxpZGF0ZVZpc3VhbHMoKTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX2NoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHVibGljIG1ldGhvZHMgLSB0ZW1wbGF0ZSBiaW5kaW5ncyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBIYW5kbGUgaW5wdXQgdmFsdWVcclxuICAgICAqIEBwYXJhbSB2YWx1ZSBWYWx1ZSBvZiBpbnB1dFxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBoYW5kbGVJbnB1dCh2YWx1ZTogc3RyaW5nKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuc2VhcmNoVmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLnNlYXJjaFZhbHVlQ2hhbmdlLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHJvdGVjdGVkIG1ldGhvZHMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGl6ZSB0ZXh0c1xyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX2luaXRUZXh0cygpXHJcbiAgICB7XHJcbiAgICAgICAgT2JqZWN0LmtleXModGhpcy5vcHRpb25zLnRleHRzKS5mb3JFYWNoKGtleSA9PlxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy50ZXh0c1trZXldID0gdGhpcy5fdGV4dHNMb2NhdG9yLmdldFRleHQodGhpcy5vcHRpb25zLnRleHRzW2tleV0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLl9jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcbn0iXX0=