/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter } from '@angular/core';
import { KEYBOARD_HANDLER } from '../keyboardHandler/types';
import { POPUP } from '../popup/types';
import { NORMAL_STATE } from '../normalState/types';
/**
 * Base class for value handlers
 * @abstract
 * @template TValue, TOptions
 */
export class ValueHandlerBase {
    //######################### constructor #########################
    /**
     * @param {?} ngSelectPlugins
     * @param {?} pluginElement
     */
    constructor(ngSelectPlugins, pluginElement) {
        this.ngSelectPlugins = ngSelectPlugins;
        this.pluginElement = pluginElement;
        /**
         * Occurs when value of NgSelect changes
         */
        this.valueChange = new EventEmitter();
        /**
         * Occurs when there is requested for change of visibility of popup using keyboard
         */
        this.popupVisibilityRequest = new EventEmitter();
        /**
         * Cancels, removes option from selected options
         * @param option Option to be canceled
         */
        this._cancelValue = (/**
         * @param {?} option
         * @return {?}
         */
        (option) => {
            if (Array.isArray(this.selectedOptions)) {
                /** @type {?} */
                let index = this.selectedOptions.indexOf(option);
                if (index >= 0) {
                    this.selectedOptions.splice(index, 1);
                }
            }
            else {
                if (this.selectedOptions == option) {
                    this.selectedOptions = null;
                }
            }
            this._clearSelected();
            this._markValueAsSelected();
            this._normalState.invalidateVisuals();
            this.valueChange.emit();
        });
    }
    /**
     * Current selected value of NgSelect
     * @return {?}
     */
    get value() {
        if (this.selectedOptions) {
            if (Array.isArray(this.selectedOptions)) {
                return this.selectedOptions.map((/**
                 * @param {?} opt
                 * @return {?}
                 */
                opt => opt.value));
            }
            else {
                return this.selectedOptions.value;
            }
        }
        return null;
    }
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    ngOnDestroy() {
        if (this._optionSelectSubscription) {
            this._optionSelectSubscription.unsubscribe();
            this._optionSelectSubscription = null;
        }
        if (this._optionClickSubscription) {
            this._optionClickSubscription.unsubscribe();
            this._optionClickSubscription = null;
        }
        if (this._optionsChangeSubscription) {
            this._optionsChangeSubscription.unsubscribe();
            this._optionsChangeSubscription = null;
        }
        if (this._cancelOptionSubscription) {
            this._cancelOptionSubscription.unsubscribe();
            this._cancelOptionSubscription = null;
        }
    }
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     * @return {?}
     */
    initialize() {
        if (this._optionsGatherer && this._optionsGatherer != this.optionsGatherer) {
            this._optionsChangeSubscription.unsubscribe();
            this._optionsChangeSubscription = null;
            this._optionsGatherer = null;
        }
        if (!this._optionsGatherer) {
            this._optionsGatherer = this.optionsGatherer;
            this._optionsChangeSubscription = this._optionsGatherer.optionsChange.subscribe((/**
             * @return {?}
             */
            () => this._loadOptions()));
        }
        /** @type {?} */
        let keyboardHandler = (/** @type {?} */ (this.ngSelectPlugins[KEYBOARD_HANDLER]));
        if (this._keyboardHandler && this._keyboardHandler != keyboardHandler) {
            this._optionSelectSubscription.unsubscribe();
            this._optionSelectSubscription = null;
            this._keyboardHandler = null;
        }
        if (!this._keyboardHandler) {
            this._keyboardHandler = keyboardHandler;
            this._optionSelectSubscription = this._keyboardHandler.optionSelect.subscribe(this._setValue);
        }
        /** @type {?} */
        let popup = (/** @type {?} */ (this.ngSelectPlugins[POPUP]));
        if (this._popup && this._popup != popup) {
            this._optionClickSubscription.unsubscribe();
            this._optionClickSubscription = null;
            this._popup = null;
        }
        if (!this._popup) {
            this._popup = popup;
            this._optionClickSubscription = this._popup.optionClick.subscribe(this._setValue);
        }
        /** @type {?} */
        let normalState = (/** @type {?} */ (this.ngSelectPlugins[NORMAL_STATE]));
        if (this._normalState && this._normalState != normalState) {
            this._cancelOptionSubscription.unsubscribe();
            this._cancelOptionSubscription = null;
            this._normalState = null;
        }
        if (!this._normalState) {
            this._normalState = normalState;
            this._cancelOptionSubscription = this._normalState.cancelOption.subscribe(this._cancelValue);
        }
        this._loadOptions();
    }
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    initOptions() {
    }
    /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    invalidateVisuals() {
    }
    /**
     * Clears all selected values
     * @protected
     * @return {?}
     */
    _clearSelected() {
        this._optionsGatherer.options.forEach((/**
         * @param {?} option
         * @return {?}
         */
        (option) => option.selected = false));
    }
    /**
     * Marks current value as selected
     * @protected
     * @return {?}
     */
    _markValueAsSelected() {
        if (this.selectedOptions) {
            if (Array.isArray(this.selectedOptions)) {
                this.selectedOptions.forEach((/**
                 * @param {?} option
                 * @return {?}
                 */
                (option) => option.selected = true));
            }
            else {
                ((/** @type {?} */ (this.selectedOptions))).selected = true;
            }
        }
    }
}
if (false) {
    /**
     * Options for NgSelect plugin
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._options;
    /**
     * Keyboard handler that is used
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._keyboardHandler;
    /**
     * Popup that is used
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._popup;
    /**
     * Normal state that is used
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._normalState;
    /**
     * Subscription for option selection using keyboard
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._optionSelectSubscription;
    /**
     * Subscription for option selection using mouse
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._optionClickSubscription;
    /**
     * Subscription for changes of options in options gatherer
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._optionsChangeSubscription;
    /**
     * Subscription for canceling an option
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._cancelOptionSubscription;
    /**
     * Instance of previous options gatherer, that is used for obtaining available options
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._optionsGatherer;
    /**
     * Options for NgSelect plugin
     * @type {?}
     */
    ValueHandlerBase.prototype.options;
    /**
     * Occurs when value of NgSelect changes
     * @type {?}
     */
    ValueHandlerBase.prototype.valueChange;
    /**
     * Instance of options gatherer, that is used for obtaining available options
     * @type {?}
     */
    ValueHandlerBase.prototype.optionsGatherer;
    /**
     * Function of value comparer that is used for comparison of values
     * @type {?}
     */
    ValueHandlerBase.prototype.valueComparer;
    /**
     * Occurs when there is requested for change of visibility of popup using keyboard
     * @type {?}
     */
    ValueHandlerBase.prototype.popupVisibilityRequest;
    /**
     * Current value of NgSelect
     * @type {?}
     */
    ValueHandlerBase.prototype.selectedOptions;
    /**
     * Sets value
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._setValue;
    /**
     * Cancels, removes option from selected options
     * \@param option Option to be canceled
     * @type {?}
     * @protected
     */
    ValueHandlerBase.prototype._cancelValue;
    /** @type {?} */
    ValueHandlerBase.prototype.ngSelectPlugins;
    /** @type {?} */
    ValueHandlerBase.prototype.pluginElement;
    /**
     * Sets value for NgSelect
     * @abstract
     * @param {?} value Value to be set
     * @return {?}
     */
    ValueHandlerBase.prototype.setValue = function (value) { };
    /**
     * Loads options
     * @abstract
     * @protected
     * @return {?}
     */
    ValueHandlerBase.prototype._loadOptions = function () { };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsdWVIYW5kbGVyQmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9wbHVnaW5zL3ZhbHVlSGFuZGxlci92YWx1ZUhhbmRsZXJCYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWEsWUFBWSxFQUFZLE1BQU0sZUFBZSxDQUFDO0FBTWxFLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBRTFELE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUdyQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sc0JBQXNCLENBQUM7Ozs7OztBQU1sRCxNQUFNLE9BQWdCLGdCQUFnQjs7Ozs7O0lBc0dsQyxZQUFtQixlQUF3QyxFQUN4QyxhQUF5QjtRQUR6QixvQkFBZSxHQUFmLGVBQWUsQ0FBeUI7UUFDeEMsa0JBQWEsR0FBYixhQUFhLENBQVk7Ozs7UUE1Q3JDLGdCQUFXLEdBQXVCLElBQUksWUFBWSxFQUFRLENBQUM7Ozs7UUFlM0QsMkJBQXNCLEdBQTBCLElBQUksWUFBWSxFQUFXLENBQUM7Ozs7O1FBNEt6RSxpQkFBWTs7OztRQUFHLENBQUMsTUFBK0IsRUFBUSxFQUFFO1lBRS9ELElBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLEVBQ3RDOztvQkFDUSxLQUFLLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO2dCQUVoRCxJQUFHLEtBQUssSUFBSSxDQUFDLEVBQ2I7b0JBQ0ksSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2lCQUN6QzthQUNKO2lCQUVEO2dCQUNJLElBQUcsSUFBSSxDQUFDLGVBQWUsSUFBSSxNQUFNLEVBQ2pDO29CQUNJLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO2lCQUMvQjthQUNKO1lBRUQs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bkRlc3Ryb3l9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1N1YnNjcmlwdGlvbn0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQge05nU2VsZWN0UGx1Z2luR2VuZXJpYywgT3B0aW9uc0dhdGhlcmVyLCBDb21wYXJlVmFsdWVGdW5jfSBmcm9tICcuLi8uLi9taXNjJztcclxuaW1wb3J0IHtOZ1NlbGVjdFBsdWdpbkluc3RhbmNlc30gZnJvbSAnLi4vLi4vY29tcG9uZW50cy9zZWxlY3QnO1xyXG5pbXBvcnQge0tleWJvYXJkSGFuZGxlcn0gZnJvbSAnLi4va2V5Ym9hcmRIYW5kbGVyJztcclxuaW1wb3J0IHtLRVlCT0FSRF9IQU5ETEVSfSBmcm9tICcuLi9rZXlib2FyZEhhbmRsZXIvdHlwZXMnO1xyXG5pbXBvcnQge1BvcHVwfSBmcm9tICcuLi9wb3B1cCc7XHJcbmltcG9ydCB7UE9QVVB9IGZyb20gJy4uL3BvcHVwL3R5cGVzJztcclxuaW1wb3J0IHvJtU5nU2VsZWN0T3B0aW9uLCBOZ1NlbGVjdE9wdGlvbn0gZnJvbSAnLi4vLi4vY29tcG9uZW50cy9vcHRpb24nO1xyXG5pbXBvcnQge05vcm1hbFN0YXRlfSBmcm9tICcuLi9ub3JtYWxTdGF0ZSc7XHJcbmltcG9ydCB7Tk9STUFMX1NUQVRFfSBmcm9tICcuLi9ub3JtYWxTdGF0ZS90eXBlcyc7XHJcbmltcG9ydCB7VmFsdWVIYW5kbGVyLCBWYWx1ZUhhbmRsZXJPcHRpb25zfSBmcm9tICcuL3ZhbHVlSGFuZGxlci5pbnRlcmZhY2UnO1xyXG5cclxuLyoqXHJcbiAqIEJhc2UgY2xhc3MgZm9yIHZhbHVlIGhhbmRsZXJzXHJcbiAqL1xyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgVmFsdWVIYW5kbGVyQmFzZTxUVmFsdWUsIFRPcHRpb25zIGV4dGVuZHMgVmFsdWVIYW5kbGVyT3B0aW9ucz4gaW1wbGVtZW50cyBWYWx1ZUhhbmRsZXI8VFZhbHVlPiwgTmdTZWxlY3RQbHVnaW5HZW5lcmljPFRPcHRpb25zPiwgT25EZXN0cm95XHJcbntcclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBwcm90ZWN0ZWQgZmllbGRzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wdGlvbnMgZm9yIE5nU2VsZWN0IHBsdWdpblxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX29wdGlvbnM6IFRPcHRpb25zO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogS2V5Ym9hcmQgaGFuZGxlciB0aGF0IGlzIHVzZWRcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9rZXlib2FyZEhhbmRsZXI6IEtleWJvYXJkSGFuZGxlcjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFBvcHVwIHRoYXQgaXMgdXNlZFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX3BvcHVwOiBQb3B1cDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIE5vcm1hbCBzdGF0ZSB0aGF0IGlzIHVzZWRcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9ub3JtYWxTdGF0ZTogTm9ybWFsU3RhdGU7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpcHRpb24gZm9yIG9wdGlvbiBzZWxlY3Rpb24gdXNpbmcga2V5Ym9hcmRcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9vcHRpb25TZWxlY3RTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmlwdGlvbiBmb3Igb3B0aW9uIHNlbGVjdGlvbiB1c2luZyBtb3VzZVxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX29wdGlvbkNsaWNrU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpcHRpb24gZm9yIGNoYW5nZXMgb2Ygb3B0aW9ucyBpbiBvcHRpb25zIGdhdGhlcmVyXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfb3B0aW9uc0NoYW5nZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaXB0aW9uIGZvciBjYW5jZWxpbmcgYW4gb3B0aW9uXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfY2FuY2VsT3B0aW9uU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbnN0YW5jZSBvZiBwcmV2aW91cyBvcHRpb25zIGdhdGhlcmVyLCB0aGF0IGlzIHVzZWQgZm9yIG9idGFpbmluZyBhdmFpbGFibGUgb3B0aW9uc1xyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX29wdGlvbnNHYXRoZXJlcjogT3B0aW9uc0dhdGhlcmVyPFRWYWx1ZT47XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBwcm9wZXJ0aWVzIC0gaW1wbGVtZW50YXRpb24gb2YgRHluYW1pY1ZhbHVlSGFuZGxlciAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBPcHRpb25zIGZvciBOZ1NlbGVjdCBwbHVnaW5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGFic3RyYWN0IG9wdGlvbnM6IFRPcHRpb25zO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogT2NjdXJzIHdoZW4gdmFsdWUgb2YgTmdTZWxlY3QgY2hhbmdlc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdmFsdWVDaGFuZ2U6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEluc3RhbmNlIG9mIG9wdGlvbnMgZ2F0aGVyZXIsIHRoYXQgaXMgdXNlZCBmb3Igb2J0YWluaW5nIGF2YWlsYWJsZSBvcHRpb25zXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcHRpb25zR2F0aGVyZXI6IE9wdGlvbnNHYXRoZXJlcjxUVmFsdWU+O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogRnVuY3Rpb24gb2YgdmFsdWUgY29tcGFyZXIgdGhhdCBpcyB1c2VkIGZvciBjb21wYXJpc29uIG9mIHZhbHVlc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdmFsdWVDb21wYXJlcjogQ29tcGFyZVZhbHVlRnVuYzxUVmFsdWU+O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogT2NjdXJzIHdoZW4gdGhlcmUgaXMgcmVxdWVzdGVkIGZvciBjaGFuZ2Ugb2YgdmlzaWJpbGl0eSBvZiBwb3B1cCB1c2luZyBrZXlib2FyZFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcG9wdXBWaXNpYmlsaXR5UmVxdWVzdDogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3VycmVudCB2YWx1ZSBvZiBOZ1NlbGVjdFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2VsZWN0ZWRPcHRpb25zOiBOZ1NlbGVjdE9wdGlvbjxUVmFsdWU+fE5nU2VsZWN0T3B0aW9uPFRWYWx1ZT5bXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEN1cnJlbnQgc2VsZWN0ZWQgdmFsdWUgb2YgTmdTZWxlY3RcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldCB2YWx1ZSgpOiBUVmFsdWV8VFZhbHVlW11cclxuICAgIHtcclxuICAgICAgICBpZih0aGlzLnNlbGVjdGVkT3B0aW9ucylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkodGhpcy5zZWxlY3RlZE9wdGlvbnMpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZE9wdGlvbnMubWFwKG9wdCA9PiBvcHQudmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRPcHRpb25zLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgY29uc3RydWN0b3IgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4gICAgY29uc3RydWN0b3IocHVibGljIG5nU2VsZWN0UGx1Z2luczogTmdTZWxlY3RQbHVnaW5JbnN0YW5jZXMsXHJcbiAgICAgICAgICAgICAgICBwdWJsaWMgcGx1Z2luRWxlbWVudDogRWxlbWVudFJlZilcclxuICAgIHtcclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHVibGljIG1ldGhvZHMgLSBpbXBsZW1lbnRhdGlvbiBvZiBPbkRlc3Ryb3kgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIENhbGxlZCB3aGVuIGNvbXBvbmVudCBpcyBkZXN0cm95ZWRcclxuICAgICAqL1xyXG4gICAgcHVibGljIG5nT25EZXN0cm95KClcclxuICAgIHtcclxuICAgICAgICBpZih0aGlzLl9vcHRpb25TZWxlY3RTdWJzY3JpcHRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25TZWxlY3RTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uU2VsZWN0U3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX29wdGlvbkNsaWNrU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uQ2xpY2tTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uQ2xpY2tTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5fb3B0aW9uc0NoYW5nZVN1YnNjcmlwdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnNDaGFuZ2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uc0NoYW5nZVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLl9jYW5jZWxPcHRpb25TdWJzY3JpcHRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9jYW5jZWxPcHRpb25TdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fY2FuY2VsT3B0aW9uU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBtZXRob2RzIC0gaW1wbGVtZW50YXRpb24gb2YgRHluYW1pY1ZhbHVlSGFuZGxlciAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXRzIHZhbHVlIGZvciBOZ1NlbGVjdFxyXG4gICAgICogQHBhcmFtIHZhbHVlIFZhbHVlIHRvIGJlIHNldFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWJzdHJhY3Qgc2V0VmFsdWUodmFsdWU6VFZhbHVlfFRWYWx1ZVtdKTogdm9pZDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEluaXRpYWxpemUgcGx1Z2luLCB0byBiZSByZWFkeSB0byB1c2UsIGluaXRpYWxpemUgY29tbXVuaWNhdGlvbiB3aXRoIG90aGVyIHBsdWdpbnNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluaXRpYWxpemUoKVxyXG4gICAge1xyXG4gICAgICAgIGlmKHRoaXMuX29wdGlvbnNHYXRoZXJlciAmJiB0aGlzLl9vcHRpb25zR2F0aGVyZXIgIT0gdGhpcy5vcHRpb25zR2F0aGVyZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnNDaGFuZ2VTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uc0dhdGhlcmVyID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKCF0aGlzLl9vcHRpb25zR2F0aGVyZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zR2F0aGVyZXIgPSB0aGlzLm9wdGlvbnNHYXRoZXJlcjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnNDaGFuZ2VTdWJzY3JpcHRpb24gPSB0aGlzLl9vcHRpb25zR2F0aGVyZXIub3B0aW9uc0NoYW5nZS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5fbG9hZE9wdGlvbnMoKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQga2V5Ym9hcmRIYW5kbGVyID0gdGhpcy5uZ1NlbGVjdFBsdWdpbnNbS0VZQk9BUkRfSEFORExFUl0gYXMgS2V5Ym9hcmRIYW5kbGVyO1xyXG5cclxuICAgICAgICBpZih0aGlzLl9rZXlib2FyZEhhbmRsZXIgJiYgdGhpcy5fa2V5Ym9hcmRIYW5kbGVyICE9IGtleWJvYXJkSGFuZGxlcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvblNlbGVjdFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25TZWxlY3RTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fa2V5Ym9hcmRIYW5kbGVyID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKCF0aGlzLl9rZXlib2FyZEhhbmRsZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9rZXlib2FyZEhhbmRsZXIgPSBrZXlib2FyZEhhbmRsZXI7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25TZWxlY3RTdWJzY3JpcHRpb24gPSB0aGlzLl9rZXlib2FyZEhhbmRsZXIub3B0aW9uU2VsZWN0LnN1YnNjcmliZSh0aGlzLl9zZXRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgcG9wdXAgPSB0aGlzLm5nU2VsZWN0UGx1Z2luc1tQT1BVUF0gYXMgUG9wdXA7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX3BvcHVwICYmIHRoaXMuX3BvcHVwICE9IHBvcHVwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uQ2xpY2tTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fb3B0aW9uQ2xpY2tTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fcG9wdXAgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoIXRoaXMuX3BvcHVwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fcG9wdXAgPSBwb3B1cDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbkNsaWNrU3Vic2NyaXB0aW9uID0gdGhpcy5fcG9wdXAub3B0aW9uQ2xpY2suc3Vic2NyaWJlKHRoaXMuX3NldFZhbHVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBub3JtYWxTdGF0ZSA9IHRoaXMubmdTZWxlY3RQbHVnaW5zW05PUk1BTF9TVEFURV0gYXMgTm9ybWFsU3RhdGU7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX25vcm1hbFN0YXRlICYmIHRoaXMuX25vcm1hbFN0YXRlICE9IG5vcm1hbFN0YXRlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fY2FuY2VsT3B0aW9uU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbmNlbE9wdGlvblN1YnNjcmlwdGlvbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9ub3JtYWxTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZighdGhpcy5fbm9ybWFsU3RhdGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9ub3JtYWxTdGF0ZSA9IG5vcm1hbFN0YXRlO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fY2FuY2VsT3B0aW9uU3Vic2NyaXB0aW9uID0gdGhpcy5fbm9ybWFsU3RhdGUuY2FuY2VsT3B0aW9uLnN1YnNjcmliZSh0aGlzLl9jYW5jZWxWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9sb2FkT3B0aW9ucygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGl6ZSBwbHVnaW4gb3B0aW9ucywgYWxsIG9wZXJhdGlvbnMgcmVxdWlyZWQgdG8gYmUgZG9uZSB3aXRoIHBsdWdpbiBvcHRpb25zIGFyZSBoYW5kbGVkIGhlcmVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluaXRPcHRpb25zKClcclxuICAgIHtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEV4cGxpY2l0bHkgcnVucyBpbnZhbGlkYXRpb24gb2YgY29udGVudCAoY2hhbmdlIGRldGVjdGlvbilcclxuICAgICAqL1xyXG4gICAgcHVibGljIGludmFsaWRhdGVWaXN1YWxzKCk6IHZvaWRcclxuICAgIHtcclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHJvdGVjdGVkIG1ldGhvZHMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU2V0cyB2YWx1ZSBcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IF9zZXRWYWx1ZTogKG9wdGlvbjogybVOZ1NlbGVjdE9wdGlvbjxUVmFsdWU+KSA9PiB2b2lkO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2FuY2VscywgcmVtb3ZlcyBvcHRpb24gZnJvbSBzZWxlY3RlZCBvcHRpb25zXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9uIE9wdGlvbiB0byBiZSBjYW5jZWxlZFxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgX2NhbmNlbFZhbHVlID0gKG9wdGlvbjogybVOZ1NlbGVjdE9wdGlvbjxUVmFsdWU+KTogdm9pZCA9PlxyXG4gICAge1xyXG4gICAgICAgIGlmKEFycmF5LmlzQXJyYXkodGhpcy5zZWxlY3RlZE9wdGlvbnMpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5zZWxlY3RlZE9wdGlvbnMuaW5kZXhPZihvcHRpb24pO1xyXG5cclxuICAgICAgICAgICAgaWYoaW5kZXggPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkT3B0aW9ucyA9PSBvcHRpb24pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fY2xlYXJTZWxlY3RlZCgpO1xyXG4gICAgICAgIHRoaXMuX21hcmtWYWx1ZUFzU2VsZWN0ZWQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5fbm9ybWFsU3RhdGUuaW52YWxpZGF0ZVZpc3VhbHMoKTtcclxuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENsZWFycyBhbGwgc2VsZWN0ZWQgdmFsdWVzXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfY2xlYXJTZWxlY3RlZCgpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5fb3B0aW9uc0dhdGhlcmVyLm9wdGlvbnMuZm9yRWFjaCgob3B0aW9uOiDJtU5nU2VsZWN0T3B0aW9uPFRWYWx1ZT4pID0+IG9wdGlvbi5zZWxlY3RlZCA9IGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE1hcmtzIGN1cnJlbnQgdmFsdWUgYXMgc2VsZWN0ZWRcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9tYXJrVmFsdWVBc1NlbGVjdGVkKClcclxuICAgIHtcclxuICAgICAgICBpZih0aGlzLnNlbGVjdGVkT3B0aW9ucylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkodGhpcy5zZWxlY3RlZE9wdGlvbnMpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5mb3JFYWNoKChvcHRpb246IMm1TmdTZWxlY3RPcHRpb248VFZhbHVlPikgPT4gb3B0aW9uLnNlbGVjdGVkID0gdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAodGhpcy5zZWxlY3RlZE9wdGlvbnMgYXMgybVOZ1NlbGVjdE9wdGlvbjxUVmFsdWU+KS5zZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBMb2FkcyBvcHRpb25zXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBhYnN0cmFjdCBfbG9hZE9wdGlvbnMoKTogdm9pZDtcclxufSJdfQ==