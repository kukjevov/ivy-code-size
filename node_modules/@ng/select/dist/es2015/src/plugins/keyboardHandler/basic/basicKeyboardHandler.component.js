/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ChangeDetectionStrategy, Inject, Optional, ElementRef, EventEmitter } from '@angular/core';
import { extend } from '@asseco/common';
import { NG_SELECT_PLUGIN_INSTANCES } from '../../../components/select/types';
import { KEYBOARD_HANDLER_OPTIONS } from '../types';
import { POPUP } from '../../popup/types';
/**
 * Default options for keyboard handler
 * \@internal
 * @type {?}
 */
const defaultOptions = {};
/**
 * Component used for obtaining basic keyboard handler html element
 */
export class BasicKeyboardHandlerComponent {
    //######################### constructor #########################
    /**
     * @param {?} ngSelectPlugins
     * @param {?} pluginElement
     * @param {?=} options
     */
    constructor(ngSelectPlugins, pluginElement, options) {
        this.ngSelectPlugins = ngSelectPlugins;
        this.pluginElement = pluginElement;
        /**
         * Occurs when there is requested for change of visibility of popup using keyboard
         */
        this.popupVisibilityRequest = new EventEmitter();
        /**
         * Occurs when option was selected using keyboard
         */
        this.optionSelect = new EventEmitter();
        //######################### protected methods #########################
        /**
         * Handles keyboard event
         * @param event Keyboard event that occured
         */
        this._handleKeyboard = (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            if (event.key == "ArrowDown" || event.key == "ArrowUp") {
                this.popupVisibilityRequest.emit(true);
                /** @type {?} */
                let activeOption = this.availableOptions.find((/**
                 * @param {?} itm
                 * @return {?}
                 */
                itm => itm.active));
                if (activeOption) {
                    /** @type {?} */
                    let index = this.availableOptions.indexOf(activeOption);
                    activeOption.active = false;
                    //move down cursor
                    if (event.key == "ArrowDown") {
                        index += 1;
                    }
                    //move up cursor
                    else {
                        index -= 1;
                    }
                    if (index < 0) {
                        index = this.availableOptions.length - 1;
                    }
                    index = index % this.availableOptions.length;
                    this.availableOptions[index].active = true;
                }
                //none active before
                else if (this.availableOptions.length) {
                    this.availableOptions[0].active = true;
                }
                this._popup.invalidateVisuals();
                event.preventDefault();
            }
            if (event.key == "Enter") {
                /** @type {?} */
                let activeOption = this.availableOptions.find((/**
                 * @param {?} itm
                 * @return {?}
                 */
                itm => itm.active));
                if (activeOption) {
                    this.optionSelect.emit(activeOption);
                }
                event.preventDefault();
            }
            if (event.key == "Tab" || event.key == "Escape") {
                this.popupVisibilityRequest.emit(false);
            }
        });
        this._options = extend(true, {}, defaultOptions, options);
    }
    //######################### protected properties #########################
    /**
     * Gets currently available options
     * @protected
     * @return {?}
     */
    get availableOptions() {
        return this.optionsGatherer.availableOptions;
    }
    //######################### public properties - implementation of BasicKeyboardHandler #########################
    /**
     * Options for NgSelect plugin
     * @return {?}
     */
    get options() {
        return this._options;
    }
    /**
     * @param {?} options
     * @return {?}
     */
    set options(options) {
        this._options = extend(true, this._options, options);
    }
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    ngOnDestroy() {
        if (this.selectElement) {
            this.selectElement.removeEventListener('keydown', this._handleKeyboard);
        }
    }
    //######################### public methods - implementation of BasicKeyboardHandler #########################
    /**
     * Initialize plugin, to be ready to use, initialize communication with other plugins
     * @return {?}
     */
    initialize() {
        if (this.selectElement) {
            this.selectElement.addEventListener('keydown', this._handleKeyboard);
        }
        /** @type {?} */
        let popup = (/** @type {?} */ (this.ngSelectPlugins[POPUP]));
        if (this._popup && this._popup != popup) {
            this._popup = null;
        }
        if (!this._popup) {
            this._popup = popup;
        }
    }
    /**
     * Initialize plugin options, all operations required to be done with plugin options are handled here
     * @return {?}
     */
    initOptions() {
    }
    /**
     * Explicitly runs invalidation of content (change detection)
     * @return {?}
     */
    invalidateVisuals() {
    }
}
BasicKeyboardHandlerComponent.decorators = [
    { type: Component, args: [{
                selector: "ng-basic-keyboard-handler",
                template: '',
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
BasicKeyboardHandlerComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [NG_SELECT_PLUGIN_INSTANCES,] }, { type: Optional }] },
    { type: ElementRef },
    { type: undefined, decorators: [{ type: Inject, args: [KEYBOARD_HANDLER_OPTIONS,] }, { type: Optional }] }
];
if (false) {
    /**
     * Options for NgSelect plugin
     * @type {?}
     * @protected
     */
    BasicKeyboardHandlerComponent.prototype._options;
    /**
     * Popup that is displayed
     * @type {?}
     * @protected
     */
    BasicKeyboardHandlerComponent.prototype._popup;
    /**
     * HTML element that represents select itself
     * @type {?}
     */
    BasicKeyboardHandlerComponent.prototype.selectElement;
    /**
     * Instance of options gatherer, that is used for obtaining available options
     * @type {?}
     */
    BasicKeyboardHandlerComponent.prototype.optionsGatherer;
    /**
     * Occurs when there is requested for change of visibility of popup using keyboard
     * @type {?}
     */
    BasicKeyboardHandlerComponent.prototype.popupVisibilityRequest;
    /**
     * Occurs when option was selected using keyboard
     * @type {?}
     */
    BasicKeyboardHandlerComponent.prototype.optionSelect;
    /**
     * Handles keyboard event
     * \@param event Keyboard event that occured
     * @type {?}
     * @protected
     */
    BasicKeyboardHandlerComponent.prototype._handleKeyboard;
    /** @type {?} */
    BasicKeyboardHandlerComponent.prototype.ngSelectPlugins;
    /** @type {?} */
    BasicKeyboardHandlerComponent.prototype.pluginElement;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzaWNLZXlib2FyZEhhbmRsZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3BsdWdpbnMva2V5Ym9hcmRIYW5kbGVyL2Jhc2ljL2Jhc2ljS2V5Ym9hcmRIYW5kbGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSx1QkFBdUIsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBYSxZQUFZLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDeEgsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBS3RDLE9BQU8sRUFBQywwQkFBMEIsRUFBQyxNQUFNLGtDQUFrQyxDQUFDO0FBQzVFLE9BQU8sRUFBQyx3QkFBd0IsRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUdsRCxPQUFPLEVBQUMsS0FBSyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7Ozs7OztNQU1sQyxjQUFjLEdBQ3BCLEVBQ0M7Ozs7QUFXRCxNQUFNLE9BQU8sNkJBQTZCOzs7Ozs7O0lBMkR0QyxZQUFtRSxlQUF3QyxFQUN4RixhQUF5QixFQUNjLE9BQXFDO1FBRjVCLG9CQUFlLEdBQWYsZUFBZSxDQUF5QjtRQUN4RixrQkFBYSxHQUFiLGFBQWEsQ0FBWTs7OztRQVRyQywyQkFBc0IsR0FBMEIsSUFBSSxZQUFZLEVBQVcsQ0FBQzs7OztRQUs1RSxpQkFBWSxHQUFzQyxJQUFJLFlBQVksRUFBdUIsQ0FBQzs7Ozs7O1FBb0V2RixvQkFBZTs7OztRQUFHLENBQUMsS0FBb0IsRUFBRSxFQUFFO1lBRWpELElBQUcsS0FBSyxDQUFDLEdBQUcsSUFBSSxXQUFXLElBQUksS0FBSyxDQUFDLEdBQUcsSUFBSSxTQUFTLEVBQ3JEO2dCQUNJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7O29CQUNuQyxZQUFZLEdBQUcsSUFBSSxD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QyxlQUFlLENBQUMsS0FBSyxDQUFDLEVBQVM7UUFFaEQsSUFBRyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksS0FBSyxFQUN0QztZQUNJLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQ3RCO1FBRUQsSUFBRyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQ2Y7WUFDSSxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztTQUN2QjtJQUNMLENBQUM7Ozs7O0lBS00sV0FBVztJQUVsQixDQUFDOzs7OztJQUtNLGlCQUFpQjtJQUV4QixDQUFDOzs7WUExSEosU0FBUyxTQUNWO2dCQUNJLFFBQVEsRUFBRSwyQkFBMkI7Z0JBQ3JDLFFBQVEsRUFBRSxFQUFFO2dCQUNaLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2FBQ2xEOzs7OzRDQTREZ0IsTUFBTSxTQUFDLDBCQUEwQixjQUFHLFFBQVE7WUF4RkMsVUFBVTs0Q0EwRnZELE1BQU0sU0FBQyx3QkFBd0IsY0FBRyxRQUFROzs7Ozs7OztJQXREdkQsaURBQWdEOzs7Ozs7SUFLaEQsK0NBQXdCOzs7OztJQTZCeEIsc0RBQWtDOzs7OztJQUtsQyx3REFBNkM7Ozs7O0lBSzdDLCtEQUFtRjs7Ozs7SUFLbkYscURBQWlHOzs7Ozs7O0lBb0VqRyx3REEwREM7O0lBM0hXLHdEQUErRjs7SUFDL0Ysc0RBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBJbmplY3QsIE9wdGlvbmFsLCBFbGVtZW50UmVmLCBPbkRlc3Ryb3ksIEV2ZW50RW1pdHRlcn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7ZXh0ZW5kfSBmcm9tICdAYXNzZWNvL2NvbW1vbic7XHJcblxyXG5pbXBvcnQge0Jhc2ljS2V5Ym9hcmRIYW5kbGVyT3B0aW9ucywgQmFzaWNLZXlib2FyZEhhbmRsZXJ9IGZyb20gJy4vYmFzaWNLZXlib2FyZEhhbmRsZXIuaW50ZXJmYWNlJztcclxuaW1wb3J0IHtOZ1NlbGVjdFBsdWdpbkdlbmVyaWMsIE9wdGlvbnNHYXRoZXJlcn0gZnJvbSAnLi4vLi4vLi4vbWlzYyc7XHJcbmltcG9ydCB7TmdTZWxlY3RQbHVnaW5JbnN0YW5jZXN9IGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudHMvc2VsZWN0JztcclxuaW1wb3J0IHtOR19TRUxFQ1RfUExVR0lOX0lOU1RBTkNFU30gZnJvbSAnLi4vLi4vLi4vY29tcG9uZW50cy9zZWxlY3QvdHlwZXMnO1xyXG5pbXBvcnQge0tFWUJPQVJEX0hBTkRMRVJfT1BUSU9OU30gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQge8m1TmdTZWxlY3RPcHRpb24sIE5nU2VsZWN0T3B0aW9ufSBmcm9tICcuLi8uLi8uLi9jb21wb25lbnRzL29wdGlvbic7XHJcbmltcG9ydCB7UG9wdXB9IGZyb20gJy4uLy4uL3BvcHVwJztcclxuaW1wb3J0IHtQT1BVUH0gZnJvbSAnLi4vLi4vcG9wdXAvdHlwZXMnO1xyXG5cclxuLyoqXHJcbiAqIERlZmF1bHQgb3B0aW9ucyBmb3Iga2V5Ym9hcmQgaGFuZGxlclxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNvbnN0IGRlZmF1bHRPcHRpb25zOiBCYXNpY0tleWJvYXJkSGFuZGxlck9wdGlvbnMgPVxyXG57XHJcbn07XHJcblxyXG4vKipcclxuICogQ29tcG9uZW50IHVzZWQgZm9yIG9idGFpbmluZyBiYXNpYyBrZXlib2FyZCBoYW5kbGVyIGh0bWwgZWxlbWVudFxyXG4gKi9cclxuQENvbXBvbmVudChcclxue1xyXG4gICAgc2VsZWN0b3I6IFwibmctYmFzaWMta2V5Ym9hcmQtaGFuZGxlclwiLFxyXG4gICAgdGVtcGxhdGU6ICcnLFxyXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIEJhc2ljS2V5Ym9hcmRIYW5kbGVyQ29tcG9uZW50IGltcGxlbWVudHMgQmFzaWNLZXlib2FyZEhhbmRsZXIsIE5nU2VsZWN0UGx1Z2luR2VuZXJpYzxCYXNpY0tleWJvYXJkSGFuZGxlck9wdGlvbnM+LCBPbkRlc3Ryb3lcclxue1xyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHByb3RlY3RlZCBmaWVsZHMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogT3B0aW9ucyBmb3IgTmdTZWxlY3QgcGx1Z2luXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBfb3B0aW9uczogQmFzaWNLZXlib2FyZEhhbmRsZXJPcHRpb25zO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUG9wdXAgdGhhdCBpcyBkaXNwbGF5ZWRcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9wb3B1cDogUG9wdXA7XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHByb3RlY3RlZCBwcm9wZXJ0aWVzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIEdldHMgY3VycmVudGx5IGF2YWlsYWJsZSBvcHRpb25zXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBnZXQgYXZhaWxhYmxlT3B0aW9ucygpOiDJtU5nU2VsZWN0T3B0aW9uPGFueT5bXVxyXG4gICAge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnNHYXRoZXJlci5hdmFpbGFibGVPcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBwdWJsaWMgcHJvcGVydGllcyAtIGltcGxlbWVudGF0aW9uIG9mIEJhc2ljS2V5Ym9hcmRIYW5kbGVyICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wdGlvbnMgZm9yIE5nU2VsZWN0IHBsdWdpblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0IG9wdGlvbnMoKTogQmFzaWNLZXlib2FyZEhhbmRsZXJPcHRpb25zXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc2V0IG9wdGlvbnMob3B0aW9uczogQmFzaWNLZXlib2FyZEhhbmRsZXJPcHRpb25zKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBleHRlbmQodHJ1ZSwgdGhpcy5fb3B0aW9ucywgb3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBIVE1MIGVsZW1lbnQgdGhhdCByZXByZXNlbnRzIHNlbGVjdCBpdHNlbGZcclxuICAgICAqL1xyXG4gICAgcHVibGljIHNlbGVjdEVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5zdGFuY2Ugb2Ygb3B0aW9ucyBnYXRoZXJlciwgdGhhdCBpcyB1c2VkIGZvciBvYnRhaW5pbmcgYXZhaWxhYmxlIG9wdGlvbnNcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9wdGlvbnNHYXRoZXJlcjogT3B0aW9uc0dhdGhlcmVyPGFueT47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBPY2N1cnMgd2hlbiB0aGVyZSBpcyByZXF1ZXN0ZWQgZm9yIGNoYW5nZSBvZiB2aXNpYmlsaXR5IG9mIHBvcHVwIHVzaW5nIGtleWJvYXJkXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBwb3B1cFZpc2liaWxpdHlSZXF1ZXN0OiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBPY2N1cnMgd2hlbiBvcHRpb24gd2FzIHNlbGVjdGVkIHVzaW5nIGtleWJvYXJkXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcHRpb25TZWxlY3Q6IEV2ZW50RW1pdHRlcjxOZ1NlbGVjdE9wdGlvbjxhbnk+PiA9IG5ldyBFdmVudEVtaXR0ZXI8TmdTZWxlY3RPcHRpb248YW55Pj4oKTtcclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgY29uc3RydWN0b3IgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4gICAgY29uc3RydWN0b3IoQEluamVjdChOR19TRUxFQ1RfUExVR0lOX0lOU1RBTkNFUykgQE9wdGlvbmFsKCkgcHVibGljIG5nU2VsZWN0UGx1Z2luczogTmdTZWxlY3RQbHVnaW5JbnN0YW5jZXMsXHJcbiAgICAgICAgICAgICAgICBwdWJsaWMgcGx1Z2luRWxlbWVudDogRWxlbWVudFJlZixcclxuICAgICAgICAgICAgICAgIEBJbmplY3QoS0VZQk9BUkRfSEFORExFUl9PUFRJT05TKSBAT3B0aW9uYWwoKSBvcHRpb25zPzogQmFzaWNLZXlib2FyZEhhbmRsZXJPcHRpb25zKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBleHRlbmQodHJ1ZSwge30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHVibGljIG1ldGhvZHMgLSBpbXBsZW1lbnRhdGlvbiBvZiBPbkRlc3Ryb3kgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIENhbGxlZCB3aGVuIGNvbXBvbmVudCBpcyBkZXN0cm95ZWRcclxuICAgICAqL1xyXG4gICAgcHVibGljIG5nT25EZXN0cm95KClcclxuICAgIHtcclxuICAgICAgICBpZih0aGlzLnNlbGVjdEVsZW1lbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUtleWJvYXJkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBtZXRob2RzIC0gaW1wbGVtZW50YXRpb24gb2YgQmFzaWNLZXlib2FyZEhhbmRsZXIgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGl6ZSBwbHVnaW4sIHRvIGJlIHJlYWR5IHRvIHVzZSwgaW5pdGlhbGl6ZSBjb21tdW5pY2F0aW9uIHdpdGggb3RoZXIgcGx1Z2luc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaW5pdGlhbGl6ZSgpXHJcbiAgICB7XHJcbiAgICAgICAgaWYodGhpcy5zZWxlY3RFbGVtZW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9oYW5kbGVLZXlib2FyZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgcG9wdXAgPSB0aGlzLm5nU2VsZWN0UGx1Z2luc1tQT1BVUF0gYXMgUG9wdXA7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX3BvcHVwICYmIHRoaXMuX3BvcHVwICE9IHBvcHVwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fcG9wdXAgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZighdGhpcy5fcG9wdXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cCA9IHBvcHVwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEluaXRpYWxpemUgcGx1Z2luIG9wdGlvbnMsIGFsbCBvcGVyYXRpb25zIHJlcXVpcmVkIHRvIGJlIGRvbmUgd2l0aCBwbHVnaW4gb3B0aW9ucyBhcmUgaGFuZGxlZCBoZXJlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbml0T3B0aW9ucygpXHJcbiAgICB7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeHBsaWNpdGx5IHJ1bnMgaW52YWxpZGF0aW9uIG9mIGNvbnRlbnQgKGNoYW5nZSBkZXRlY3Rpb24pXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbnZhbGlkYXRlVmlzdWFscygpOiB2b2lkXHJcbiAgICB7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHByb3RlY3RlZCBtZXRob2RzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICAvKipcclxuICAgICAqIEhhbmRsZXMga2V5Ym9hcmQgZXZlbnRcclxuICAgICAqIEBwYXJhbSBldmVudCBLZXlib2FyZCBldmVudCB0aGF0IG9jY3VyZWRcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIF9oYW5kbGVLZXlib2FyZCA9IChldmVudDogS2V5Ym9hcmRFdmVudCkgPT5cclxuICAgIHtcclxuICAgICAgICBpZihldmVudC5rZXkgPT0gXCJBcnJvd0Rvd25cIiB8fCBldmVudC5rZXkgPT0gXCJBcnJvd1VwXCIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnBvcHVwVmlzaWJpbGl0eVJlcXVlc3QuZW1pdCh0cnVlKTtcclxuICAgICAgICAgICAgbGV0IGFjdGl2ZU9wdGlvbiA9IHRoaXMuYXZhaWxhYmxlT3B0aW9ucy5maW5kKGl0bSA9PiBpdG0uYWN0aXZlKTtcclxuXHJcbiAgICAgICAgICAgIGlmKGFjdGl2ZU9wdGlvbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5hdmFpbGFibGVPcHRpb25zLmluZGV4T2YoYWN0aXZlT3B0aW9uKTtcclxuICAgICAgICAgICAgICAgIGFjdGl2ZU9wdGlvbi5hY3RpdmUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL21vdmUgZG93biBjdXJzb3JcclxuICAgICAgICAgICAgICAgIGlmKGV2ZW50LmtleSA9PSBcIkFycm93RG93blwiKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL21vdmUgdXAgY3Vyc29yXHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggLT0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZihpbmRleCA8IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLmF2YWlsYWJsZU9wdGlvbnMubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpbmRleCA9IGluZGV4ICUgdGhpcy5hdmFpbGFibGVPcHRpb25zLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmF2YWlsYWJsZU9wdGlvbnNbaW5kZXhdLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9ub25lIGFjdGl2ZSBiZWZvcmVcclxuICAgICAgICAgICAgZWxzZSBpZih0aGlzLmF2YWlsYWJsZU9wdGlvbnMubGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF2YWlsYWJsZU9wdGlvbnNbMF0uYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5fcG9wdXAuaW52YWxpZGF0ZVZpc3VhbHMoKTtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKGV2ZW50LmtleSA9PSBcIkVudGVyXCIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBsZXQgYWN0aXZlT3B0aW9uID0gdGhpcy5hdmFpbGFibGVPcHRpb25zLmZpbmQoaXRtID0+IGl0bS5hY3RpdmUpO1xyXG5cclxuICAgICAgICAgICAgaWYoYWN0aXZlT3B0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvblNlbGVjdC5lbWl0KGFjdGl2ZU9wdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZihldmVudC5rZXkgPT0gXCJUYWJcIiB8fCBldmVudC5rZXkgPT0gXCJFc2NhcGVcIilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMucG9wdXBWaXNpYmlsaXR5UmVxdWVzdC5lbWl0KGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=