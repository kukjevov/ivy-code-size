/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { forwardRef, Directive } from '@angular/core';
import { NgSelectComponent } from '../components/select/select.component';
import { valueChange, setValue, onFocus, setReadonly, getValue } from '../extensions';
/**
 * Provider for control value accessor
 * \@internal
 * @type {?}
 */
export const NG_SELECT_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    () => NgSelectControlValueAccessor)),
    multi: true
};
/**
 * Control value accessor for NgSelectComponent
 * @template TValue
 */
export class NgSelectControlValueAccessor {
    //######################### constructor #########################
    /**
     * @param {?} _select
     */
    constructor(_select) {
        this._select = _select;
        /**
         * Subscription that looks for changes of select
         */
        this._changeSubscription = null;
        /**
         * Subscription that looks for changes of select
         */
        this._focusSubscription = null;
    }
    //######################### public methods - implementation of ControlValueAccessor #########################
    /**
     * Sets value to select
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        this._value = value;
        if (this._select.isInitialized) {
            this._select.execute(setValue(value));
            return;
        }
        if (this._initializedSubscription) {
            this._initializedSubscription.unsubscribe();
            this._initializedSubscription = null;
        }
        this._initializedSubscription = this._select.initialized.subscribe((/**
         * @param {?} initialized
         * @return {?}
         */
        initialized => {
            if (initialized) {
                this._initializedSubscription.unsubscribe();
                this._initializedSubscription = null;
                this._select.execute(setValue(value));
            }
        }));
    }
    /**
     * Registers callback that is called when value of select changes
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this._changeInitializedSubscription = this._select.initialized.subscribe((/**
         * @param {?} initialized
         * @return {?}
         */
        initialized => {
            if (initialized) {
                if (this._changeSubscription) {
                    this._changeSubscription.unsubscribe();
                    this._changeSubscription = null;
                }
                this._changeSubscription = this._select.executeAndReturn(valueChange(fn));
                /** @type {?} */
                let value = this._select.executeAndReturn(getValue());
                if (this._value != value) {
                    this._value = value;
                    fn(value);
                }
            }
        }));
    }
    /**
     * Registers callback that is called when select is closed
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this._touchInitializedSubscription = this._select.initialized.subscribe((/**
         * @param {?} initialized
         * @return {?}
         */
        initialized => {
            if (initialized) {
                if (this._focusSubscription) {
                    this._focusSubscription.unsubscribe();
                    this._focusSubscription = null;
                }
                this._focusSubscription = this._select.executeAndReturn(onFocus(fn));
            }
        }));
    }
    /**
     * Sets NgSelect as disabled/readonly
     * @param {?} isDisabled Indication whether is control disabled or not
     * @return {?}
     */
    setDisabledState(isDisabled) {
        if (this._select.isInitialized) {
            this._select.execute(setReadonly(isDisabled));
            return;
        }
        if (this._disabledInitializedSubscription) {
            this._disabledInitializedSubscription.unsubscribe();
            this._disabledInitializedSubscription = null;
        }
        this._disabledInitializedSubscription = this._select.initialized.subscribe((/**
         * @param {?} initialized
         * @return {?}
         */
        initialized => {
            if (initialized) {
                this._disabledInitializedSubscription.unsubscribe();
                this._disabledInitializedSubscription = null;
                this._select.execute(setReadonly(isDisabled));
            }
        }));
    }
    //######################### public methods - implementation of OnDestroy #########################
    /**
     * Called when component is destroyed
     * @return {?}
     */
    ngOnDestroy() {
        if (this._changeSubscription) {
            this._changeSubscription.unsubscribe();
            this._changeSubscription = null;
        }
        if (this._initializedSubscription) {
            this._initializedSubscription.unsubscribe();
            this._initializedSubscription = null;
        }
        if (this._changeInitializedSubscription) {
            this._changeInitializedSubscription.unsubscribe();
            this._changeInitializedSubscription = null;
        }
        if (this._touchInitializedSubscription) {
            this._touchInitializedSubscription.unsubscribe();
            this._touchInitializedSubscription = null;
        }
        if (this._focusSubscription) {
            this._focusSubscription.unsubscribe();
            this._focusSubscription = null;
        }
        if (this._disabledInitializedSubscription) {
            this._disabledInitializedSubscription.unsubscribe();
            this._disabledInitializedSubscription = null;
        }
    }
}
NgSelectControlValueAccessor.decorators = [
    { type: Directive, args: [{
                selector: 'ng-select[formControlName],ng-select[formControl],ng-select[ngModel]',
                providers: [NG_SELECT_VALUE_ACCESSOR]
            },] }
];
/** @nocollapse */
NgSelectControlValueAccessor.ctorParameters = () => [
    { type: NgSelectComponent }
];
if (false) {
    /**
     * Subscription for initialized status of NgSelect, used for writeValue
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._initializedSubscription;
    /**
     * Subscription for initialized status of NgSelect, used for registerOnChange
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._changeInitializedSubscription;
    /**
     * Subscription for initialized status of NgSelect, used for registerOnTouched
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._touchInitializedSubscription;
    /**
     * Subscription for initialized status of NgSelect, used for setDisabledState
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._disabledInitializedSubscription;
    /**
     * Subscription that looks for changes of select
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._changeSubscription;
    /**
     * Subscription that looks for changes of select
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._focusSubscription;
    /**
     * Last set value to this control
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._value;
    /**
     * @type {?}
     * @private
     */
    NgSelectControlValueAccessor.prototype._select;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmdTZWxlY3RDb250cm9sVmFsdWVBY2Nlc3Nvci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbWlzYy9uZ1NlbGVjdENvbnRyb2xWYWx1ZUFjY2Vzc29yLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLGlCQUFpQixFQUF1QixNQUFNLGdCQUFnQixDQUFDO0FBQ3ZFLE9BQU8sRUFBQyxVQUFVLEVBQW9CLFNBQVMsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUdqRixPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSx1Q0FBdUMsQ0FBQztBQUN4RSxPQUFPLEVBQUMsV0FBVyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBQyxNQUFNLGVBQWUsQ0FBQzs7Ozs7O0FBTXBGLE1BQU0sT0FBTyx3QkFBd0IsR0FDckM7SUFDSSxPQUFPLEVBQUUsaUJBQWlCO0lBQzFCLFdBQVcsRUFBRSxVQUFVOzs7SUFBQyxHQUFHLEVBQUUsQ0FBQyw0QkFBNEIsRUFBQztJQUMzRCxLQUFLLEVBQUUsSUFBSTtDQUNkOzs7OztBQVVELE1BQU0sT0FBTyw0QkFBNEI7Ozs7O0lBd0NyQyxZQUFvQixPQUFrQztRQUFsQyxZQUFPLEdBQVAsT0FBTyxDQUEyQjs7OztRQWI5Qyx3QkFBbUIsR0FBaUIsSUFBSSxDQUFDOzs7O1FBS3pDLHVCQUFrQixHQUFpQixJQUFJLENBQUM7SUFVaEQsQ0FBQzs7Ozs7OztJQU9NLFVBQVUsQ0FBQyxLQUEyQjtRQUV6QyxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUVwQixJQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUM3QjtZQUNJLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBRXRDLE9BQU87U0FDVjtRQUVELElBQUcsSUFBSSxDQUFD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Qyx3QkFBd0IsQ0FBQzthQUN4Qzs7OztZQXJCTyxpQkFBaUI7Ozs7Ozs7O0lBNkJyQixnRUFBK0M7Ozs7OztJQUsvQyxzRUFBcUQ7Ozs7OztJQUtyRCxxRUFBb0Q7Ozs7OztJQUtwRCx3RUFBdUQ7Ozs7OztJQUt2RCwyREFBaUQ7Ozs7OztJQUtqRCwwREFBZ0Q7Ozs7OztJQUtoRCw4Q0FBZ0M7Ozs7O0lBR3BCLCtDQUEwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7TkdfVkFMVUVfQUNDRVNTT1IsIENvbnRyb2xWYWx1ZUFjY2Vzc29yfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7Zm9yd2FyZFJlZiwgRXhpc3RpbmdQcm92aWRlciwgRGlyZWN0aXZlLCBPbkRlc3Ryb3l9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1N1YnNjcmlwdGlvbn0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQge05nU2VsZWN0Q29tcG9uZW50fSBmcm9tICcuLi9jb21wb25lbnRzL3NlbGVjdC9zZWxlY3QuY29tcG9uZW50JztcclxuaW1wb3J0IHt2YWx1ZUNoYW5nZSwgc2V0VmFsdWUsIG9uRm9jdXMsIHNldFJlYWRvbmx5LCBnZXRWYWx1ZX0gZnJvbSAnLi4vZXh0ZW5zaW9ucyc7XHJcblxyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGNvbnRyb2wgdmFsdWUgYWNjZXNzb3JcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgTkdfU0VMRUNUX1ZBTFVFX0FDQ0VTU09SOiBFeGlzdGluZ1Byb3ZpZGVyID1cclxue1xyXG4gICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBOZ1NlbGVjdENvbnRyb2xWYWx1ZUFjY2Vzc29yKSxcclxuICAgIG11bHRpOiB0cnVlXHJcbn07XHJcblxyXG4vKipcclxuICogQ29udHJvbCB2YWx1ZSBhY2Nlc3NvciBmb3IgTmdTZWxlY3RDb21wb25lbnRcclxuICovXHJcbkBEaXJlY3RpdmUoXHJcbntcclxuICAgIHNlbGVjdG9yOiAnbmctc2VsZWN0W2Zvcm1Db250cm9sTmFtZV0sbmctc2VsZWN0W2Zvcm1Db250cm9sXSxuZy1zZWxlY3RbbmdNb2RlbF0nLFxyXG4gICAgcHJvdmlkZXJzOiBbTkdfU0VMRUNUX1ZBTFVFX0FDQ0VTU09SXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgTmdTZWxlY3RDb250cm9sVmFsdWVBY2Nlc3NvcjxUVmFsdWU+IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uRGVzdHJveVxyXG57XHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHJpdmF0ZSBmaWVsZHMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaXB0aW9uIGZvciBpbml0aWFsaXplZCBzdGF0dXMgb2YgTmdTZWxlY3QsIHVzZWQgZm9yIHdyaXRlVmFsdWVcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfaW5pdGlhbGl6ZWRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmlwdGlvbiBmb3IgaW5pdGlhbGl6ZWQgc3RhdHVzIG9mIE5nU2VsZWN0LCB1c2VkIGZvciByZWdpc3Rlck9uQ2hhbmdlXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX2NoYW5nZUluaXRpYWxpemVkU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpcHRpb24gZm9yIGluaXRpYWxpemVkIHN0YXR1cyBvZiBOZ1NlbGVjdCwgdXNlZCBmb3IgcmVnaXN0ZXJPblRvdWNoZWRcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfdG91Y2hJbml0aWFsaXplZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaXB0aW9uIGZvciBpbml0aWFsaXplZCBzdGF0dXMgb2YgTmdTZWxlY3QsIHVzZWQgZm9yIHNldERpc2FibGVkU3RhdGVcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfZGlzYWJsZWRJbml0aWFsaXplZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaXB0aW9uIHRoYXQgbG9va3MgZm9yIGNoYW5nZXMgb2Ygc2VsZWN0XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX2NoYW5nZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmlwdGlvbiB0aGF0IGxvb2tzIGZvciBjaGFuZ2VzIG9mIHNlbGVjdFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9mb2N1c1N1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIExhc3Qgc2V0IHZhbHVlIHRvIHRoaXMgY29udHJvbFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF92YWx1ZTogVFZhbHVlfFRWYWx1ZVtdO1xyXG5cclxuICAgIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBjb25zdHJ1Y3RvciAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9zZWxlY3Q6IE5nU2VsZWN0Q29tcG9uZW50PFRWYWx1ZT4pXHJcbiAgICB7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIHB1YmxpYyBtZXRob2RzIC0gaW1wbGVtZW50YXRpb24gb2YgQ29udHJvbFZhbHVlQWNjZXNzb3IgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU2V0cyB2YWx1ZSB0byBzZWxlY3RcclxuICAgICAqL1xyXG4gICAgcHVibGljIHdyaXRlVmFsdWUodmFsdWU6IFRWYWx1ZXxBcnJheTxUVmFsdWU+KTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX3NlbGVjdC5pc0luaXRpYWxpemVkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fc2VsZWN0LmV4ZWN1dGUoc2V0VmFsdWUodmFsdWUpKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX2luaXRpYWxpemVkU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24gPSB0aGlzLl9zZWxlY3QuaW5pdGlhbGl6ZWQuc3Vic2NyaWJlKGluaXRpYWxpemVkID0+XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZihpbml0aWFsaXplZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0LmV4ZWN1dGUoc2V0VmFsdWUodmFsdWUpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVnaXN0ZXJzIGNhbGxiYWNrIHRoYXQgaXMgY2FsbGVkIHdoZW4gdmFsdWUgb2Ygc2VsZWN0IGNoYW5nZXNcclxuICAgICAqL1xyXG4gICAgcHVibGljIHJlZ2lzdGVyT25DaGFuZ2UoZm46IChkYXRhOiBUVmFsdWV8QXJyYXk8VFZhbHVlPikgPT4gdm9pZCk6IHZvaWRcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9jaGFuZ2VJbml0aWFsaXplZFN1YnNjcmlwdGlvbiA9IHRoaXMuX3NlbGVjdC5pbml0aWFsaXplZC5zdWJzY3JpYmUoaW5pdGlhbGl6ZWQgPT5cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmKGluaXRpYWxpemVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLl9jaGFuZ2VTdWJzY3JpcHRpb24pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VTdWJzY3JpcHRpb24gPSB0aGlzLl9zZWxlY3QuZXhlY3V0ZUFuZFJldHVybih2YWx1ZUNoYW5nZShmbikpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5fc2VsZWN0LmV4ZWN1dGVBbmRSZXR1cm4oZ2V0VmFsdWUoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5fdmFsdWUgIT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBmbih2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVycyBjYWxsYmFjayB0aGF0IGlzIGNhbGxlZCB3aGVuIHNlbGVjdCBpcyBjbG9zZWRcclxuICAgICAqL1xyXG4gICAgcHVibGljIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB2b2lkKTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX3RvdWNoSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24gPSB0aGlzLl9zZWxlY3QuaW5pdGlhbGl6ZWQuc3Vic2NyaWJlKGluaXRpYWxpemVkID0+XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZihpbml0aWFsaXplZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5fZm9jdXNTdWJzY3JpcHRpb24pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9mb2N1c1N1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5fZm9jdXNTdWJzY3JpcHRpb24gPSB0aGlzLl9zZWxlY3QuZXhlY3V0ZUFuZFJldHVybihvbkZvY3VzKGZuKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldHMgTmdTZWxlY3QgYXMgZGlzYWJsZWQvcmVhZG9ubHlcclxuICAgICAqIEBwYXJhbSBpc0Rpc2FibGVkIEluZGljYXRpb24gd2hldGhlciBpcyBjb250cm9sIGRpc2FibGVkIG9yIG5vdFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCBcclxuICAgIHtcclxuICAgICAgICBpZih0aGlzLl9zZWxlY3QuaXNJbml0aWFsaXplZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdC5leGVjdXRlKHNldFJlYWRvbmx5KGlzRGlzYWJsZWQpKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX2Rpc2FibGVkSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9kaXNhYmxlZEluaXRpYWxpemVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVkSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fZGlzYWJsZWRJbml0aWFsaXplZFN1YnNjcmlwdGlvbiA9IHRoaXMuX3NlbGVjdC5pbml0aWFsaXplZC5zdWJzY3JpYmUoaW5pdGlhbGl6ZWQgPT5cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmKGluaXRpYWxpemVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXNhYmxlZEluaXRpYWxpemVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXNhYmxlZEluaXRpYWxpemVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QuZXhlY3V0ZShzZXRSZWFkb25seShpc0Rpc2FibGVkKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgcHVibGljIG1ldGhvZHMgLSBpbXBsZW1lbnRhdGlvbiBvZiBPbkRlc3Ryb3kgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2FsbGVkIHdoZW4gY29tcG9uZW50IGlzIGRlc3Ryb3llZFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgbmdPbkRlc3Ryb3koKVxyXG4gICAge1xyXG4gICAgICAgIGlmKHRoaXMuX2NoYW5nZVN1YnNjcmlwdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NoYW5nZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9jaGFuZ2VTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5faW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLl9jaGFuZ2VJbml0aWFsaXplZFN1YnNjcmlwdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NoYW5nZUluaXRpYWxpemVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2NoYW5nZUluaXRpYWxpemVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHRoaXMuX3RvdWNoSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl90b3VjaEluaXRpYWxpemVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3RvdWNoSW5pdGlhbGl6ZWRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5fZm9jdXNTdWJzY3JpcHRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl9mb2N1c1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9mb2N1c1N1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLl9kaXNhYmxlZEluaXRpYWxpemVkU3Vic2NyaXB0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fZGlzYWJsZWRJbml0aWFsaXplZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9kaXNhYmxlZEluaXRpYWxpemVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=